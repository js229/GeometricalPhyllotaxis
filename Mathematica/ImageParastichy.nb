(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    138903,       3529]
NotebookOptionsPosition[    133927,       3443]
NotebookOutlinePosition[    134589,       3465]
CellTagsIndexPosition[    134546,       3462]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"makePackage", " ", "=", " ", "False"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{"makePackage", ",", "\n", "    ", 
     RowBox[{
      RowBox[{"BeginPackage", "[", "\"\<ImageParastichy`\>\"", "]"}], ";", 
      "\n", "    ", 
      RowBox[{
       RowBox[{"locateParastichyOptions", "::", "usage"}], " ", "=", " ", 
       "\"\<Global options for heuristics\>\""}], ";", "\n", "    ", 
      RowBox[{
       RowBox[{"makeTidyMesh", "::", "usage"}], " ", "=", " ", 
       "\"\<Delete duplicate points and remove over-large cells\>\""}], ";", 
      "\n", "    ", 
      RowBox[{
       RowBox[{"makeSunGraph", "::", "usage"}], " ", "=", " ", 
       "\"\<Delete duplicate points and remove over-large cells\>\""}], ";", 
      "\n", "    ", 
      RowBox[{
       RowBox[{"meshExtendParastichy", "::", "usage"}], " ", "=", " ", 
       "\"\<Extend a line without large kinks\>\""}]}]}], "\n", "]"}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{"makePackage", ",", "\n", "    ", 
     RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]}], "\n", "]"}], ";"}], 
  "\n", "  ", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Options", "[", 
     RowBox[{
      RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
      RowBox[{"AutoGeneratedPackage", "\[Rule]", "Automatic"}]}], "]"}], 
    ";"}], "\n", "*)"}]}], "\n"}], "Code",
 CellLabel->
  "2/16/21 16:14:25 (Local) \
In[1]:=",ExpressionUUID->"c6c4cce2-bc28-4439-ae0d-6afb0daf69fe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"resetOptions", " ", ":=", " ", 
    RowBox[{"locateParastichyOptions", " ", "=", " ", 
     RowBox[{"<|", "\n", 
      RowBox[{
       RowBox[{"\"\<Renumber\>\"", "->", " ", "True"}], ",", "\n", 
       RowBox[{"\"\<DuplicateNearness\>\"", " ", "->", "5.1"}], ",", "\n", 
       RowBox[{"\"\<LargePolygonLength\>\"", " ", "->", "42"}], ",", "\n", 
       RowBox[{"\"\<InitialPeel\>\"", " ", "->", " ", "0"}], ",", "\n", 
       RowBox[{"\"\<StraightnessWhenAdjacent\>\"", " ", "->", "25"}], ",", 
       "\n", 
       RowBox[{"\"\<StraightnessWhenUnadjacent\>\"", "->", " ", "30"}], ",", 
       "\n", 
       RowBox[{"\"\<InitialParastichyLength\>\"", "->", "  ", "10"}], ",", 
       "\n", 
       RowBox[{"\"\<ParastichyExtensionLength\>\"", "->", "  ", "10"}], ",", 
       " ", 
       RowBox[{"(*", " ", 
        RowBox[{"each", " ", "way"}], " ", "*)"}], "\n", 
       RowBox[{"\"\<MinimumThreadLength\>\"", "->", " ", "3"}], ",", "\n", 
       RowBox[{"\"\<FamilyGrowthSize\>\"", " ", "->", " ", "90"}]}], "\n", 
      "|>"}]}]}], ";"}], " "}], "\n", 
 RowBox[{
  RowBox[{"resetOptions", ";"}], "\n", "\n", "\t"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeSunGraph", "[", "seedCentres_", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "g", ",", "dMeshRaw", ",", " ", "lineLength", ",", " ", "lengths", ",",
         " ", "pointsToDrop", ",", " ", "x", ",", " ", "meshxy", ",", " ", 
        "toDrop", ",", " ", "dMesh", ",", " ", "res", ",", " ", "boundary"}], 
       "}"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"dMeshRaw", " ", "=", " ", 
        RowBox[{"DelaunayMesh", "[", "seedCentres", "]"}]}], ";", "\n", "\t", 
       "\n", "\t", 
       RowBox[{"lengths", " ", "=", " ", 
        RowBox[{"AssociationThread", "[", 
         RowBox[{
          RowBox[{"MeshCells", "[", 
           RowBox[{"dMeshRaw", ",", " ", "1"}], "]"}], ",", " ", 
          RowBox[{"Map", "[", 
           RowBox[{"lineToLength", ",", " ", 
            RowBox[{"MeshPrimitives", "[", 
             RowBox[{"dMeshRaw", ",", " ", "1"}], "]"}]}], "]"}]}], "]"}]}], 
       ";", "\n", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{
        "find", " ", "the", " ", "short", " ", "line", " ", "pairs", " ", 
         "and", " ", "take", " ", "the", " ", "first", " ", "cell", " ", 
         "index"}], " ", "*)"}], " ", "\n", "\t", 
       RowBox[{"pointsToDrop", " ", "=", "\n", "\t", 
        RowBox[{"(", "\n", "\t", 
         RowBox[{
          RowBox[{"Keys", " ", "@", " ", 
           RowBox[{"Select", "[", 
            RowBox[{"lengths", ",", " ", 
             RowBox[{
              RowBox[{"#", " ", "<", " ", 
               RowBox[{
               "locateParastichyOptions", "[", "\"\<DuplicateNearness\>\"", 
                "]"}]}], "&"}]}], "]"}]}], " ", "/.", " ", 
          RowBox[{
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{"x_", ",", " ", "y_"}], "}"}], "]"}], " ", "->", " ", 
           "x"}]}], "\n", "\t", ")"}]}], ";", "\n", "\t", 
       RowBox[{"toDrop", " ", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"First", " ", "@", " ", 
            RowBox[{"Position", "[", 
             RowBox[{"seedCentres", ",", " ", 
              RowBox[{"meshCoordinates", "[", 
               RowBox[{"dMeshRaw", ",", "#"}], "]"}]}], "]"}]}], "&"}], ",", 
          " ", "pointsToDrop"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{
        "should", " ", "be", " ", "in", " ", "point", " ", "order", " ", 
         "anyway"}], " ", "*)"}], "\n", "\t", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Dropping \>\"", ",", " ", 
         RowBox[{"Length", "[", "toDrop", "]"}], ",", " ", 
         "\"\< points as duplicates\>\""}], "]"}], ";", "\n", "\t", 
       RowBox[{"dMesh", " ", "=", " ", 
        RowBox[{"DelaunayMesh", "[", 
         RowBox[{"Delete", "[", 
          RowBox[{"seedCentres", ",", " ", "toDrop"}], "]"}], "]"}]}], ";", 
       "\n", "\t", 
       RowBox[{"dMesh", " ", "=", " ", 
        RowBox[{"meshDeletePolygons", "[", 
         RowBox[{"dMesh", ",", " ", 
          RowBox[{"meshLongCells", "[", 
           RowBox[{"dMesh", ",", " ", 
            RowBox[{
            "locateParastichyOptions", "[", "\"\<LargePolygonLength\>\"", 
             "]"}]}], "]"}]}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"dMesh", " ", "=", " ", 
        RowBox[{"meshPeel", "[", 
         RowBox[{"dMesh", ",", " ", 
          RowBox[{
          "locateParastichyOptions", "[", "\"\<InitialPeel\>\"", "]"}]}], 
         "]"}]}], ";", "\n", "\t", 
       RowBox[{"boundary", " ", "=", " ", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"ConnectedMeshComponents", " ", "@", " ", 
           RowBox[{"RegionBoundary", "[", "dMesh", "]"}]}], ",", " ", 
          RowBox[{"Length", "[", 
           RowBox[{
            RowBox[{"MeshCells", "[", 
             RowBox[{"#", ",", " ", "0"}], "]"}], "&"}], "]"}]}], "]"}]}], 
       ";", "\n", "\t", "\n", "\t", 
       RowBox[{"g", " ", "=", " ", 
        RowBox[{"meshToGraph", "[", "dMesh", "]"}]}], ";", "\n", "\t", "\n", 
       "\t", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"<|", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"\"\<Graph\>\"", " ", "->", " ", "g"}], "\n", "\t\t\t", ",", 
          RowBox[{"\"\<Mesh\>\"", "\[Rule]", " ", "dMesh"}], " ", 
          RowBox[{"(*", " ", 
           RowBox[{"only", " ", "used", " ", "for", " ", 
            RowBox[{"debug", "/", "plotting"}], " ", "after", " ", "this", 
            " ", "point"}], " ", "*)"}], "\n", "\t\t\t", ",", " ", 
          RowBox[{"\"\<InnerBoundary\>\"", " ", "->", " ", 
           RowBox[{"meshCellsOfMesh1InMesh2", "[", 
            RowBox[{
             RowBox[{"boundary", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dMesh"}], "]"}]}], 
          "\n", "\t\t\t", ",", " ", 
          RowBox[{"\"\<OuterBoundary\>\"", " ", "->", " ", 
           RowBox[{"meshCellsOfMesh1InMesh2", "[", 
            RowBox[{
             RowBox[{"boundary", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", " ", "dMesh"}], "]"}]}], 
          "\n", "\t", 
          RowBox[{"(*", "\t\t", 
           RowBox[{",", " ", 
            RowBox[{"\"\<Adjacency\>\"", " ", "->", " ", 
             RowBox[{"meshAdjacencyAssociation", "[", "dMesh", "]"}]}]}], 
           "\n", "*)"}], "\t\t\t", ",", " ", 
          RowBox[{"\"\<Centroid\>\"", " ", "->", " ", 
           RowBox[{"RegionCentroid", "[", "dMesh", "]"}]}]}], "\n", "\t\t", 
         "|>"}]}], ";", "\n", "\t\t", "res"}]}], "\n", "\t", "]"}]}], ";"}], 
  "\t"}], "\n"}], "Code",
 CellLabel->
  "2/16/21 16:14:25 (Local) \
In[4]:=",ExpressionUUID->"545f80d8-56e3-47b6-8060-3a2155b76023"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"private", " ", "functions"}], " ", "*)"}]], "Code",
 CellLabel->
  "2/16/21 16:14:25 (Local) \
In[7]:=",ExpressionUUID->"5cb0906a-7fd6-41ca-bd93-01a456c28bc8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"lineToLength", "[", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"p1_", ",", " ", "p2_"}], "}"}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"Norm", "[", 
    RowBox[{"p1", " ", "-", " ", "p2"}], "]"}]}], ";"}]], "Code",
 CellLabel->
  "2/16/21 16:14:25 (Local) \
In[8]:=",ExpressionUUID->"266cd5b1-2123-4b41-8621-e7480adb92fc"],

Cell[CellGroupData[{

Cell["Initial mesh manipulation", "Subsection",ExpressionUUID->"f0d4dbc7-8000-477d-a6d2-41c86a995399"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"meshCoordinates", "[", 
    RowBox[{"mesh_MeshRegion", ",", "ix_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "x", "}"}], ",", 
     RowBox[{
      RowBox[{"MeshPrimitives", "[", 
       RowBox[{"mesh", ",", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", " ", "ix"}], "}"}]}], "]"}], " ", "/.", " ", 
      RowBox[{
       RowBox[{"Point", "[", "x_", "]"}], " ", "->", " ", "x"}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshCoordinates", "[", "mesh_", "]"}], " ", ":=", " ", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "x", "}"}], ",", 
     RowBox[{
      RowBox[{"MeshPrimitives", "[", 
       RowBox[{"mesh", ",", " ", "0"}], "]"}], " ", "/.", " ", 
      RowBox[{
       RowBox[{"Point", "[", "x_", "]"}], " ", "->", " ", "x"}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshCellCellDistance", "[", 
     RowBox[{"mesh_", ",", 
      RowBox[{"{", 
       RowBox[{"v1_", ",", "v2_"}], "}"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Norm", "[", 
     RowBox[{
      RowBox[{"meshCoordinates", "[", 
       RowBox[{"mesh", ",", "v1"}], "]"}], "-", 
      RowBox[{"meshCoordinates", "[", 
       RowBox[{"mesh", ",", "v2"}], "]"}]}], "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshDeletePolygons", "[", 
     RowBox[{"mesh_", ",", "deletedpolys_"}], "]"}], " ", ":=", "   ", "\n", 
    "\t", 
    RowBox[{"MeshRegion", "[", 
     RowBox[{
      RowBox[{"meshCoordinates", "[", "mesh", "]"}], ",", 
      RowBox[{"Complement", "[", " ", 
       RowBox[{
        RowBox[{"MeshCells", "[", 
         RowBox[{"mesh", ",", "2"}], "]"}], ",", "deletedpolys"}], "]"}]}], 
     "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshLinesWithLength", "[", "mesh_MeshRegion", "]"}], " ", ":=", 
   " ", 
   RowBox[{"AssociationThread", "[", 
    RowBox[{
     RowBox[{"MeshCells", "[", 
      RowBox[{"mesh", ",", "1"}], "]"}], ",", 
     RowBox[{"Map", "[", 
      RowBox[{"lineToLength", ",", 
       RowBox[{"MeshPrimitives", "[", 
        RowBox[{"mesh", ",", "1"}], "]"}]}], "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshLinesWithLength", "[", "mesh_Association", "]"}], " ", ":=", 
    " ", 
    RowBox[{"meshLinesWithLength", "[", 
     RowBox[{"mesh", "[", "\"\<Mesh\>\"", "]"}], "]"}]}], ";"}], "\n", "\n", 
  RowBox[{"(*", " ", 
   RowBox[{"for", " ", "tidying", " ", "the", " ", "initial", " ", "mesh"}], 
   " ", "*)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshLongCells", "::", "usage"}], " ", "=", " ", 
   "\"\<Find cells in which one of the sides has length> length \>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshLongCells", "[", 
     RowBox[{"mesh_", ",", "length_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "polys", ",", "x", ",", "lengths", ",", "polyMembers", ",", 
        "longLinePairs", ",", "polyHasLinePair", ",", "polyHasAnyPairs"}], 
       "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"longLinePairs", " ", "=", " ", 
        RowBox[{
         RowBox[{"Keys", "@", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"meshLinesWithLength", "[", "mesh", "]"}], ",", " ", 
            RowBox[{
             RowBox[{"#", " ", ">", " ", "length"}], "&"}]}], "]"}]}], " ", "/.",
          " ", 
         RowBox[{
          RowBox[{"Line", "[", "x_", "]"}], "->", "x"}]}]}], ";", "\n", "\t", 
       RowBox[{"polys", " ", "=", " ", 
        RowBox[{"MeshCells", "[", 
         RowBox[{"mesh", ",", "2"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"polyMembers", "  ", "=", 
        RowBox[{"AssociationThread", "[", 
         RowBox[{"polys", ",", 
          RowBox[{"polys", "/.", " ", 
           RowBox[{
            RowBox[{"Polygon", "[", "x_", "]"}], "->", "x"}]}]}], "]"}]}], 
       ";", "\n", "\t", 
       RowBox[{
        RowBox[{"polyHasLinePair", "[", 
         RowBox[{
          RowBox[{"Polygon", "[", "x_", "]"}], ",", "pair_"}], "]"}], " ", ":=",
         " ", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Intersection", "[", 
           RowBox[{"x", ",", "pair"}], "]"}], "]"}], ">=", " ", "2"}]}], ";", 
       "\n", "\t", 
       RowBox[{
        RowBox[{"polyHasAnyPairs", "[", "p_", "]"}], " ", ":=", 
        RowBox[{"Or", "@@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"polyHasLinePair", "[", 
             RowBox[{"p", ",", "#"}], "]"}], "&"}], ",", "longLinePairs"}], 
          "]"}]}]}], ";", "\n", "\t", 
       RowBox[{"Keys", "@", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"Association", "@", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "->", 
               RowBox[{"polyHasAnyPairs", "[", "#", "]"}]}], "&"}], ",", 
             "polys"}], "]"}]}], ",", 
          RowBox[{"#", "&"}]}], "]"}]}]}]}], "\n", "]"}]}], ";"}], "\n", "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
   "peel", " ", "the", " ", "outer", " ", "boundary", " ", "of", " ", "cells",
     " ", "off", " ", "n", " ", "times"}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshPeel", "[", 
    RowBox[{"mesh_", ",", "n_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "doapeel", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"doapeel", "[", "meshp_", "]"}], " ", ":=", " ", 
       RowBox[{"MeshRegion", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"MeshPrimitives", "[", 
           RowBox[{"meshp", ",", "0"}], "]"}], "/.", " ", 
          RowBox[{
           RowBox[{"Point", "[", "x_", "]"}], "->", "x"}]}], ",", 
         RowBox[{"meshPolygonsNotFormingBoundary", "[", "meshp", "]"}]}], 
        "]"}]}], ";", "\n", "\t", 
      RowBox[{"Nest", "[", 
       RowBox[{"doapeel", ",", "mesh", ",", "n"}], "]"}]}]}], "\n", "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshPolygonsNotFormingBoundary", "[", "mesh_", "]"}], " ", ":=", 
    " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "boundaryNodes", ",", "meshPolygons", ",", "polyFormsBoundary"}], 
       "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"boundaryNodes", " ", "=", " ", 
        RowBox[{"boundaryPointIndexes", "[", "mesh", "]"}]}], ";", "\n", "\t", 
       RowBox[{"meshPolygons", " ", "=", " ", 
        RowBox[{"MeshCells", "[", 
         RowBox[{"mesh", ",", "2"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{
        RowBox[{"polyFormsBoundary", "[", 
         RowBox[{"Polygon", "[", "threeNodeList_", "]"}], "]"}], " ", ":=", 
        " ", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Intersection", "[", 
           RowBox[{"threeNodeList", ",", "boundaryNodes"}], "]"}], "]"}], ">=",
          " ", "2"}]}], ";", "\n", "\t", 
       RowBox[{"Select", "[", 
        RowBox[{"meshPolygons", ",", 
         RowBox[{"Not", " ", "@*", " ", "polyFormsBoundary"}]}], "]"}]}]}], 
     "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"boundaryPointIndexes", "[", "mesh_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"boundaryNodesXY", ",", "meshXY"}], "}"}], ",", "\n", 
      RowBox[{"(*", " ", 
       RowBox[{"replace", " ", "by", " ", 
        RowBox[{"cellsOfMesh1InMesh2", "[", 
         RowBox[{
          RowBox[{"RegionBoundary", "[", "mesh", "]"}], ",", " ", "mesh"}], 
         "]"}], " ", "just", " ", "for", " ", "clarity"}], " ", "*)"}], "\n", 
      "\t", 
      RowBox[{
       RowBox[{"boundaryNodesXY", " ", "=", " ", 
        RowBox[{"MeshPrimitives", "[", 
         RowBox[{
          RowBox[{"RegionBoundary", "[", "mesh", "]"}], ",", "0"}], "]"}]}], 
       ";", "\n", "\t", 
       RowBox[{"meshXY", " ", "=", " ", 
        RowBox[{"MeshPrimitives", "[", 
         RowBox[{"mesh", ",", "0"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"First", "@", 
           RowBox[{"FirstPosition", "[", 
            RowBox[{"meshXY", ",", "#"}], "]"}]}], "&"}], ",", 
         "boundaryNodesXY"}], "]"}]}]}], "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshCellsOfMesh1InMesh2", "[", 
     RowBox[{"mesh1_", ",", " ", "mesh2_"}], "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "pointxy", "}"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"pointxy", " ", "=", " ", 
        RowBox[{"MeshPrimitives", "[", 
         RowBox[{"mesh1", ",", " ", "0"}], "]"}]}], ";", "\n", "\t\t", 
       RowBox[{"Flatten", " ", "@", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"FirstPosition", "[", 
            RowBox[{
             RowBox[{"MeshPrimitives", "[", 
              RowBox[{"mesh2", ",", " ", "0"}], "]"}], ",", " ", "#"}], "]"}],
            "&"}], ",", " ", "pointxy"}], "]"}]}]}]}], "\n", "\t", "]"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshAdjacencyAssociation", "[", "mesh_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "paraPossibles", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"paraPossibles", " ", "=", "  ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Apply", "[", 
           RowBox[{"List", ",", 
            RowBox[{"MeshCells", "[", 
             RowBox[{"mesh", ",", "1"}], "]"}], ",", 
            RowBox[{"{", "1", "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", "\n", 
       "\t", 
       RowBox[{"paraPossibles", " ", "=", " ", 
        RowBox[{"DeleteDuplicates", "@", 
         RowBox[{"Join", "[", 
          RowBox[{"paraPossibles", ",", 
           RowBox[{"Map", "[", 
            RowBox[{"Reverse", ",", "paraPossibles"}], "]"}]}], "]"}]}]}], 
       ";", "\n", "\t", 
       RowBox[{"GroupBy", "[", 
        RowBox[{"paraPossibles", ",", "First", ",", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{"Last", ",", "#"}], "]"}], "&"}]}], "]"}]}]}], "\n", 
     "]"}]}], ";"}], "\n", "\n", 
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"meshLineAngle", "[", 
      RowBox[{"meshAssociation_", ",", " ", 
       RowBox[{"{", 
        RowBox[{"ix1_", ",", " ", "ix2_"}], "}"}]}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"p1p2", ",", " ", "pAngle", ",", " ", "res"}], "}"}], ",", 
       "\n", "   ", 
       RowBox[{"(*", " ", 
        RowBox[{"in", " ", "[", 
         RowBox[{
          RowBox[{"-", "180"}], ",", "180"}], " "}], "*)"}], "\n", "   ", 
       RowBox[{
        RowBox[{"p1p2", " ", "=", " ", 
         RowBox[{"MeshPrimitives", "[", 
          RowBox[{
           RowBox[{"meshAssociation", "[", "\"\<Mesh\>\"", "]"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", " ", 
             RowBox[{"{", 
              RowBox[{"ix1", ",", " ", "ix2"}], "}"}]}], "}"}]}], "]"}]}], 
        ";", "\n", "   ", 
        RowBox[{
         RowBox[{"pAngle", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Point", "[", 
             RowBox[{"{", 
              RowBox[{"x1_", ",", " ", "y1_"}], "}"}], "]"}], ",", " ", 
            RowBox[{"Point", "[", 
             RowBox[{"{", 
              RowBox[{"x2_", ",", " ", "y2_"}], "}"}], "]"}]}], "}"}], "]"}], 
         " ", ":=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"360", "/", 
            RowBox[{"(", 
             RowBox[{"2", " ", "\[Pi]"}], ")"}]}], ")"}], " ", 
          RowBox[{"ArcTan", "[", 
           RowBox[{
            RowBox[{"x2", " ", "-", " ", "x1"}], ",", " ", 
            RowBox[{"y2", " ", "-", " ", "y1"}]}], "]"}]}]}], ";", "\n", 
        "   ", 
        RowBox[{"pAngle", "[", "p1p2", "]"}]}]}], "\n", "   ", "]"}]}], ";"}],
    "\n", "*)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshCellCellDistance", "[", 
     RowBox[{"mesh_", ",", 
      RowBox[{"{", 
       RowBox[{"v1_", ",", "v2_"}], "}"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Norm", "[", 
     RowBox[{
      RowBox[{"meshCoordinates", "[", 
       RowBox[{"mesh", ",", "v1"}], "]"}], "-", 
      RowBox[{"meshCoordinates", "[", 
       RowBox[{"mesh", ",", "v2"}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshToGraph", "[", "mesh_MeshRegion", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"g", ",", "vertexList", ",", "edgeList", ",", "edgeWeights"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"vertexList", " ", "=", " ", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", "x", "}"}], ",", 
         RowBox[{
          RowBox[{"MeshCells", "[", 
           RowBox[{"mesh", ",", "0"}], "]"}], " ", "/.", " ", 
          RowBox[{
           RowBox[{"Point", "[", "x_", "]"}], "\[Rule]", "x"}]}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"edgeList", "  ", "=", " ", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"v1", ",", "v2"}], "}"}], ",", 
         RowBox[{
          RowBox[{"MeshCells", "[", 
           RowBox[{"mesh", ",", "1"}], "]"}], " ", "/.", " ", 
          RowBox[{
           RowBox[{"Line", "[", " ", 
            RowBox[{"{", 
             RowBox[{"v1_", ",", "v2_"}], "}"}], "]"}], "\[Rule]", " ", 
           RowBox[{"UndirectedEdge", "[", 
            RowBox[{"v1", ",", "v2"}], "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"edgeWeights", " ", "=", " ", 
       RowBox[{
        RowBox[{"MeshCells", "[", 
         RowBox[{"mesh", ",", "1"}], "]"}], " ", "/.", " ", 
        RowBox[{
         RowBox[{"Line", "[", " ", 
          RowBox[{"{", 
           RowBox[{"v1_", ",", "v2_"}], "}"}], "]"}], "\[RuleDelayed]", "  ", 
         RowBox[{"meshCellCellDistance", "[", 
          RowBox[{"mesh", ",", 
           RowBox[{"{", 
            RowBox[{"v1", ",", "v2"}], "}"}]}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"g", " ", "=", " ", 
       RowBox[{"Graph", "[", 
        RowBox[{
        "vertexList", "\[IndentingNewLine]", ",", "edgeList", 
         "\[IndentingNewLine]", ",", 
         RowBox[{"EdgeWeight", "\[Rule]", "edgeWeights"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"VertexCoordinates", "\[Rule]", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", "x", "}"}], ",", 
            RowBox[{
             RowBox[{"MeshPrimitives", "[", 
              RowBox[{"mesh", ",", "0"}], "]"}], "/.", " ", 
             RowBox[{
              RowBox[{"Point", "[", "x_", "]"}], "\[Rule]", "x"}]}]}], 
           "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", "g"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshToGraph", "[", "m_", "]"}], " ", ":=", " ", 
    RowBox[{"Print", "[", 
     RowBox[{"\"\<mG called with head :\>\"", ",", " ", 
      RowBox[{"Head", "[", "m", "]"}], ",", "\"\<:\>\""}], "]"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{"makePackage", ",", 
     RowBox[{"End", "[", "]"}]}], "]"}], ";"}], " ", 
  RowBox[{"(*", " ", "Private", " ", "*)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{"makePackage", ",", 
     RowBox[{"EndPackage", "[", "]"}]}], "]"}], ";"}], "\n", 
  "\n"}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:25 (Local) \
In[9]:=",ExpressionUUID->"7d3ee17a-750e-48b8-9523-9ce516590beb"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Graph based functions", "Subsection",ExpressionUUID->"217b4cfc-7091-426b-b4ac-8966b4ce8f0c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"meshCoordinates", "[", 
    RowBox[{"meshAssociation_Association", ",", "ix_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"graphCoordinates", "[", 
    RowBox[{
     RowBox[{"meshAssociation", "[", "\"\<Graph\>\"", "]"}], ",", "ix"}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"graphCoordinates", "[", 
    RowBox[{"meshAssociation_Association", ",", "ix_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"graphCoordinates", "[", 
    RowBox[{
     RowBox[{"meshAssociation", "[", "\"\<Graph\>\"", "]"}], ",", "ix"}], 
    "]"}]}], "\n", "\n", " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"graphCoordinates", "[", 
    RowBox[{"g_Graph", ",", "ix_"}], "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{"AnnotationValue", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"g", ",", "ix"}], "}"}], ",", "VertexCoordinates"}], "]"}], 
    ")"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"graphCoordinates", "[", 
     RowBox[{"g_", ",", "ix_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Print", "[", 
     RowBox[{"\"\<gC called with head :\>\"", ",", 
      RowBox[{"Head", "[", "g", "]"}], ",", "\"\<:\>\""}], "]"}]}], ";"}], 
  "\n"}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:25 (Local) \
In[27]:=",ExpressionUUID->"37db2415-c424-4b7f-be64-7d290b7571fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"createParastichyFamily", "[", 
    RowBox[{"meshAssociation_", ",", "starter_", ",", 
     RowBox[{"family_", ":", "1"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"nextpara", ",", "paraList", ",", "mpf", ",", "pstart"}], "}"}],
      ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pstart", " ", "=", " ", 
       RowBox[{"parastichyStarter", "[", 
        RowBox[{"meshAssociation", ",", "starter"}], "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "pstart", "]"}], "<", "2"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"Missing", "[", 
          RowBox[{"\"\<Can't make starter from \>\"", ",", " ", "starter"}], 
          "]"}], "]"}]}], "]"}], ";", 
      RowBox[{"mpf", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"mpf", " ", "=", " ", 
       RowBox[{"addToParastichyFamily", "[", 
        RowBox[{"mpf", ",", "pstart", ",", "family"}], "]"}]}], ";", 
      RowBox[{"mpf", " ", "=", " ", 
       RowBox[{"Nest", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"findAdjacentThreads", "[", 
           RowBox[{"meshAssociation", ",", "#"}], "]"}], "&"}], ",", "mpf", 
         ",", 
         RowBox[{
         "locateParastichyOptions", "[", "\"\<FamilyGrowthSize\>\"", "]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mpf", " ", "=", " ", 
       RowBox[{"mergeParastichyFamilyOverlaps", "[", 
        RowBox[{"meshAssociation", ",", "mpf"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mpf", " ", "=", " ", 
       RowBox[{"joinParastichyFamilyAdjacents", "[", 
        RowBox[{"meshAssociation", ",", "mpf"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"locateParastichyOptions", "[", "\"\<Renumber\>\"", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"mpf", " ", "=", " ", 
          RowBox[{"renumberParastichyFamily", "[", 
           RowBox[{"meshAssociation", ",", "mpf"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "mpf"}]}], 
    "\n", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 20:44:09 (Local) \
In[178]:=",ExpressionUUID->"d3f2d60d-4435-48a4-be52-8b86c3b6f85d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"findAnOverlap", "[", 
     RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], " ", ":=",
     " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ix", ",", "jx", ",", "overlap"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"ix", "=", "1"}], ",", 
         RowBox[{"ix", "<", 
          RowBox[{"Length", "[", "parastichyFamily", "]"}]}], ",", 
         RowBox[{"ix", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"jx", " ", "=", " ", 
            RowBox[{"ix", "+", "1"}]}], ",", " ", 
           RowBox[{"jx", "<=", 
            RowBox[{"Length", "[", "parastichyFamily", "]"}]}], ",", 
           RowBox[{"jx", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"overlap", "  ", "=", " ", 
             RowBox[{"Intersection", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"parastichyFamily", "[", 
                 RowBox[{"[", "ix", "]"}], "]"}], "[", "\"\<Members\>\"", 
                "]"}], ",", 
               RowBox[{
                RowBox[{"parastichyFamily", "[", 
                 RowBox[{"[", "jx", "]"}], "]"}], "[", "\"\<Members\>\"", 
                "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "overlap", "]"}], ">", "0"}], " ", 
              "\[IndentingNewLine]", ",", " ", 
              RowBox[{"Return", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "parastichyFamily", "\[LeftDoubleBracket]", "ix", 
                   "\[RightDoubleBracket]"}], "[", "\"\<Index\>\"", "]"}], 
                 ",", 
                 RowBox[{
                  RowBox[{
                  "parastichyFamily", "\[LeftDoubleBracket]", "jx", 
                   "\[RightDoubleBracket]"}], "[", "\"\<Index\>\"", "]"}]}], 
                "}"}], "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", "\"\<No overlap\>\"", "]"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"adjacencyFunction", "[", "meshAssociation_", "]"}], " ", ":=", 
    " ", 
    RowBox[{"Function", "[", 
     RowBox[{
      RowBox[{"{", "ix", "}"}], ",", 
      RowBox[{"AdjacencyList", "[", 
       RowBox[{
        RowBox[{"meshAssociation", "[", "\"\<Graph\>\"", "]"}], ",", "ix"}], 
       "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"findTailHeadAdjacents", "[", 
     RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], " ", ":=",
     " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ix", ",", "jx", ",", "adjacents"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"adjacents", " ", "=", " ", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"ix", "=", "1"}], ",", 
         RowBox[{"ix", "<", 
          RowBox[{"Length", "[", "parastichyFamily", "]"}]}], ",", 
         RowBox[{"ix", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"jx", " ", "=", " ", 
            RowBox[{"ix", "+", "1"}]}], ",", " ", 
           RowBox[{"jx", "<=", 
            RowBox[{"Length", "[", "parastichyFamily", "]"}]}], ",", 
           RowBox[{"jx", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"tailHeadAdjacentQ", "[", 
               RowBox[{"meshAssociation", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                 "parastichyFamily", "\[LeftDoubleBracket]", "ix", 
                  "\[RightDoubleBracket]"}], "[", "\"\<Members\>\"", "]"}], 
                ",", 
                RowBox[{
                 RowBox[{
                 "parastichyFamily", "\[LeftDoubleBracket]", "jx", 
                  "\[RightDoubleBracket]"}], "[", "\"\<Members\>\"", "]"}]}], 
               "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"adjacents", " ", "=", " ", 
               RowBox[{"Append", "[", 
                RowBox[{"adjacents", ",", "\[IndentingNewLine]", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    "parastichyFamily", "\[LeftDoubleBracket]", "ix", 
                    "\[RightDoubleBracket]"}], "[", "\"\<Index\>\"", "]"}], 
                   ",", 
                   RowBox[{
                    RowBox[{
                    "parastichyFamily", "\[LeftDoubleBracket]", "jx", 
                    "\[RightDoubleBracket]"}], "[", "\"\<Index\>\"", "]"}]}], 
                  "}"}]}], "\[IndentingNewLine]", "]"}]}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "adjacents", "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"tailHeadAdjacentQ", "[", 
     RowBox[{"meshAssociation_", ",", "parastichy1_", ",", "parastichy2_"}], 
     "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"firstTail", ",", "secondHead", ",", "adjacents"}], "}"}], ",",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"firstTail", " ", "=", " ", 
        RowBox[{"Last", "[", "parastichy1", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"secondHead", " ", "=", "  ", 
        RowBox[{"First", "[", "parastichy2", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"adjacencyFunction", "[", "meshAssociation", "]"}], "[", 
            "firstTail", "]"}], ",", "secondHead"}], "]"}], 
         "\[IndentingNewLine]", ",", " ", 
         RowBox[{"Return", "[", "True", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"firstTail", " ", "=", " ", 
        RowBox[{"Last", "[", "parastichy2", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"secondHead", " ", "=", "  ", 
        RowBox[{"First", "[", "parastichy1", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"adjacencyFunction", "[", "meshAssociation", "]"}], "[", 
            "firstTail", "]"}], ",", "secondHead"}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"Return", "[", "True", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "False", "]"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->
  True,ExpressionUUID->"d27eb31f-9685-4b44-b6ca-9d98105f73e6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mergeParastichyFamilyOverlaps", "[", 
    RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ijx", ",", "n", ",", "mPF", ",", "tailHeadAdjacents"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mPF", " ", "=", " ", "parastichyFamily"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"n", "=", "0"}], ",", 
        RowBox[{"n", "<", "100"}], ",", 
        RowBox[{"n", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ijx", " ", "=", " ", 
          RowBox[{"findAnOverlap", "[", 
           RowBox[{"meshAssociation", ",", "mPF"}], "]"}]}], " ", ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MissingQ", "[", "ijx", "]"}], ",", 
           RowBox[{"Break", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"n", ",", " ", "\"\< Overlap\>\"", ",", " ", "ijx"}], "]"}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"mPF", " ", "=", " ", 
          RowBox[{"mergeParastichySibs", "[", 
           RowBox[{"meshAssociation", ",", "mPF", ",", "ijx"}], "]"}]}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "mPF"}]}], "\n", "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"joinParastichyFamilyAdjacents", "[", 
    RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ijx", ",", "n", ",", "mPF", ",", "tailHeadAdjacents"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mPF", " ", "=", " ", "parastichyFamily"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"tailHeadAdjacents", " ", "=", " ", 
       RowBox[{"findTailHeadAdjacents", "[", 
        RowBox[{"meshAssociation", ",", "mPF"}], "]"}]}], " ", ";", 
      "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "tailHeadAdjacents", "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ijx", " ", "=", " ", 
          RowBox[{"First", "[", "tailHeadAdjacents", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tailHeadAdjacents", " ", "=", " ", 
          RowBox[{"Drop", "[", 
           RowBox[{"tailHeadAdjacents", ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"mPF", " ", "=", " ", 
          RowBox[{"mergeParastichySibs", "[", 
           RowBox[{"meshAssociation", ",", "mPF", ",", "ijx"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tailHeadAdjacents", " ", "=", " ", 
          RowBox[{"Cases", "[", 
           RowBox[{"tailHeadAdjacents", ",", 
            RowBox[{"Except", "[", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
               "ijx", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ",", "_"}], "}"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tailHeadAdjacents", " ", "=", " ", 
          RowBox[{"Cases", "[", 
           RowBox[{"tailHeadAdjacents", ",", 
            RowBox[{"Except", "[", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
               "ijx", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               ",", "_"}], "}"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tailHeadAdjacents", " ", "=", " ", 
          RowBox[{"Cases", "[", 
           RowBox[{"tailHeadAdjacents", ",", 
            RowBox[{"Except", "[", " ", 
             RowBox[{"{", 
              RowBox[{"_", ",", 
               RowBox[{
               "ijx", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}], "}"}], "]"}]}], "]"}]}], ";"}]}],
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "mPF"}]}], "\n", "]"}]}], ";"}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 20:47:24 (Local) \
In[222]:=",ExpressionUUID->"6f079890-0c30-49f9-a923-bceb2e315ea5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"parastichyAdjacencyTable", " ", "[", 
     RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "g", ",", "path", ",", "paraAdjacency", ",", "paraAdjacencyCount", ",",
         "paraAdjacencies", ",", "paraAdjacencyTable"}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"paraAdjacency", "[", "parastichyFamilyMember_", "]"}], " ", ":=",
         " ", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Union", "@@", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{"adjacencyFunction", "[", "meshAssociation", "]"}], ",", 
            RowBox[{"parastichyFamilyMember", "[", "\"\<Members\>\"", "]"}]}],
            "]"}]}], "]"}]}], ";", "\n", "\t", 
       RowBox[{
        RowBox[{"paraAdjacencyCount", "[", 
         RowBox[{"ix_", ",", "ix_"}], "]"}], " ", ":=", " ", "0"}], ";", "\n",
        "\t", 
       RowBox[{
        RowBox[{"paraAdjacencyCount", "[", 
         RowBox[{"ix_", ",", "jx_"}], "]"}], " ", ":=", " ", 
        RowBox[{"Length", "@", 
         RowBox[{"Intersection", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"paraAdjacency", "[", 
            RowBox[{"parastichyFamily", "[", 
             RowBox[{"[", "ix", "]"}], "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"parastichyFamily", "[", 
             RowBox[{"[", "jx", "]"}], "]"}], "[", "\"\<Members\>\"", "]"}]}],
           "\n", "\t", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"paraAdjacencies", "[", "ix_", "]"}], " ", ":=", " ", 
        RowBox[{"Keys", "@", 
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"Reverse", "@", 
            RowBox[{"Sort", "@", 
             RowBox[{"Association", "@", 
              RowBox[{"Table", "[", " ", "\n", "\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"parastichyFamily", "[", 
                    RowBox[{"[", "ix", "]"}], "]"}], "[", "\"\<Index\>\"", 
                   "]"}], " ", "\[UndirectedEdge]", 
                  RowBox[{
                   RowBox[{"parastichyFamily", "[", 
                    RowBox[{"[", "jx", "]"}], "]"}], "[", "\"\<Index\>\"", 
                   "]"}]}], "\n", "\t\t", "->", " ", 
                 RowBox[{"paraAdjacencyCount", "[", 
                  RowBox[{"ix", ",", "jx"}], "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"jx", ",", 
                  RowBox[{"Length", "[", "parastichyFamily", "]"}]}], "}"}]}],
                "]"}]}]}]}], ",", "2"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"paraAdjacencyTable", " ", "=", " ", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"paraAdjacencies", "[", "ix", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"ix", ",", 
             RowBox[{"Length", "[", "parastichyFamily", "]"}]}], "}"}]}], 
          "]"}]}]}], ";", " ", "\n", "\t", "paraAdjacencyTable"}]}], "\n", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[36]:=",ExpressionUUID->"756f00cc-3755-454d-a208-247637ce9458"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"renumberParastichyFamily", "[", 
    RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "g", ",", "familyOrder", ",", "paraAdjacencyTable", ",", "res", ",", 
       "family", ",", "para", ",", "i"}], "}"}], ",", 
     RowBox[{
      RowBox[{"paraAdjacencyTable", " ", "=", 
       RowBox[{"parastichyAdjacencyTable", "[", 
        RowBox[{"meshAssociation", ",", "parastichyFamily"}], "]"}]}], ";", 
      " ", 
      RowBox[{"g", " ", "=", " ", 
       RowBox[{"Graph", "[", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "&"}], ",", 
           "parastichyFamily"}], "]"}], ",", "paraAdjacencyTable", ",", 
         RowBox[{"VertexLabels", "->", "\"\<Name\>\""}]}], "]"}]}], ";", 
      RowBox[{"familyOrder", " ", "=", " ", 
       RowBox[{"topologicalSortByLongestPaths", "[", "g", "]"}]}], ";", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"family", " ", "=", " ", 
       RowBox[{
        RowBox[{"First", "[", "parastichyFamily", "]"}], "[", 
        "\"\<Family\>\"", "]"}]}], ";", 
      RowBox[{"family", "=", 
       RowBox[{
        RowBox[{"ToString", "[", "family", "]"}], "~~", "\"\<A\>\""}]}], ";", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "<=", " ", 
         RowBox[{"Length", "[", "familyOrder", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", 
        RowBox[{
         RowBox[{"para", " ", "=", " ", 
          RowBox[{
           RowBox[{"Query", "[", 
            RowBox[{"SelectFirst", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "==", 
               RowBox[{"familyOrder", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "&"}], "]"}], "]"}], "@", 
           "parastichyFamily"}]}], ";", 
         RowBox[{"res", " ", "=", " ", 
          RowBox[{"addToParastichyFamily", "[", 
           RowBox[{"res", ",", 
            RowBox[{"para", "[", "\"\<Members\>\"", "]"}], ",", "family"}], 
           "]"}]}], ";"}]}], "\n", "\t", "]"}], ";", "\[IndentingNewLine]", 
      "res"}]}], "\n", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[37]:=",ExpressionUUID->"1d014996-9baf-42c8-a2cc-89ac1bc48b8e"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"mergeParastichySibs", "[", 
     RowBox[{"meshAssociation_", ",", "parastichyFamily_", ",", 
      RowBox[{"{", 
       RowBox[{"ix_", ",", "jx_"}], "}"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"mPF", ",", "newParastichy", ",", "decho"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
        RowBox[{"If", "[", 
         RowBox[{"True", ",", 
          RowBox[{"Echo", "[", 
           RowBox[{"x", ",", "\"\<mPS\>\""}], "]"}], ",", "x"}], "]"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"mPF", " ", "=", " ", "parastichyFamily"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"newParastichy", " ", "=", " ", 
        RowBox[{"Union", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"getParastichyByIndex", "[", 
            RowBox[{"mPF", ",", "ix"}], "]"}], "[", "\"\<Members\>\"", "]"}], 
          ",", 
          RowBox[{
           RowBox[{"getParastichyByIndex", "[", 
            RowBox[{"mPF", ",", "jx"}], "]"}], "[", "\"\<Members\>\"", 
           "]"}]}], "]"}]}], ";", 
       RowBox[{"newParastichy", " ", "=", " ", 
        RowBox[{"makeDirectedParastichy", "[", 
         RowBox[{"meshAssociation", ",", "newParastichy"}], "]"}]}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MissingQ", "[", "newParastichy", "]"}], ",", 
         RowBox[{"Return", "[", "mPF", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", 
       RowBox[{"mPF", " ", "=", " ", 
        RowBox[{"deleteFromParastichyFamily", "[", 
         RowBox[{"mPF", ",", 
          RowBox[{"{", 
           RowBox[{"ix", ",", "jx"}], "}"}]}], "]"}]}], ";", "\t", 
       "\[IndentingNewLine]", 
       RowBox[{"mPF", " ", "=", " ", 
        RowBox[{"addToParastichyFamily", "[", 
         RowBox[{"mPF", ",", "newParastichy"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "mPF"}]}], "\n", "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 20:47:57 (Local) \
In[232]:=",ExpressionUUID->"aa52782f-2f77-4f6d-b567-77af59b4375b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"deleteFromParastichyFamily", "[", 
    RowBox[{"mpf_", ",", "indices_"}], "]"}], " ", ":=", "  ", 
   RowBox[{
    RowBox[{"Query", "[", 
     RowBox[{"Select", "[", " ", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"indices", ",", 
          RowBox[{"#", "[", "\"\<Index\>\"", "]"}]}], "]"}]}], "&"}], "]"}], 
     "]"}], "@", "mpf"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getParastichyByIndex", "[", 
     RowBox[{"mpf_", ",", "index_"}], "]"}], " ", ":=", " ", 
    RowBox[{"First", "@", 
     RowBox[{"Select", "[", 
      RowBox[{"mpf", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "==", "index"}], "&"}]}], 
      "]"}]}]}], ";"}], "\n", "\n"}], "\n"}], "Code",
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[39]:=",ExpressionUUID->"dbb63815-f69a-4a96-bfec-9b2f1f193c64"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"combineInParastichyFamily", "[", 
    RowBox[{"mpf_", ",", 
     RowBox[{"{", 
      RowBox[{"ix1_", ",", "ix2_"}], "}"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"para", ",", "para1", ",", "para2", ",", "res"}], "}"}], ",", 
     "\n", 
     RowBox[{
      RowBox[{"para1", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"First", "@", 
          RowBox[{
           RowBox[{"Query", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "==", "ix1"}], "&"}],
              "]"}], "]"}], "@", "mpf"}]}], ")"}], "[", "\"\<Members\>\"", 
        "]"}]}], ";", "\n", 
      RowBox[{"para2", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"First", "@", 
          RowBox[{
           RowBox[{"Query", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "==", "ix2"}], "&"}],
              "]"}], "]"}], "@", "mpf"}]}], ")"}], "[", "\"\<Members\>\"", 
        "]"}]}], ";", "\n", 
      RowBox[{"para", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"para1", ",", "para2"}], "]"}]}], ";", "\n", 
      RowBox[{"res", " ", "=", " ", "mpf"}], ";", "\n", "\n", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"deleteFromParastichyFamily", "[", 
        RowBox[{"mpf", ",", 
         RowBox[{"{", 
          RowBox[{"ix1", ",", "ix2"}], "}"}]}], "]"}]}], ";", "\n", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"addToParastichyFamily", "[", 
        RowBox[{"res", ",", "para"}], "]"}]}], ";", "\n", "res"}]}], "\n", 
    "]"}]}], ";"}]], "Code",
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[41]:=",ExpressionUUID->"c85247cb-971b-4af8-acc6-d28716b5ddbf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"addToParastichyFamily", "[", 
     RowBox[{"mpf_", ",", "parastichy_"}], "]"}], " ", ":=", " ", 
    RowBox[{"addToParastichyFamily", "[", 
     RowBox[{"mpf", ",", "parastichy", ",", 
      RowBox[{
       RowBox[{"First", "[", "mpf", "]"}], "[", "\"\<Family\>\"", "]"}]}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"addToParastichyFamily", "[", 
     RowBox[{"mpf_", ",", "parastichy_", ",", "family_"}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"sib", ",", "maxIndex"}], "}"}], ",", 
      RowBox[{
       RowBox[{"maxIndex", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "mpf", "]"}], "==", "0"}], ",", "0", ",", 
          RowBox[{"Max", "[", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "&"}], ",", "mpf"}], 
            "]"}], "]"}]}], "]"}]}], ";", 
       RowBox[{"sib", " ", "=", " ", 
        RowBox[{"<|", " ", 
         RowBox[{
          RowBox[{"\"\<Family\>\"", "->", "family"}], ",", 
          RowBox[{"\"\<Index\>\"", "->", " ", 
           RowBox[{"maxIndex", "+", "1"}]}], ",", 
          RowBox[{"\"\<Members\>\"", "->", "parastichy"}]}], " ", "|>"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Append", "[", 
        RowBox[{"mpf", ",", "sib"}], "]"}]}]}], "\n", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"dropParastichyElement", "[", 
     RowBox[{"mpf_", ",", "ix_", ",", "dix_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", ",", "para", ",", "pix"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"res", " ", "=", " ", "mpf"}], ";", "\n", 
       RowBox[{"pix", " ", "=", " ", 
        RowBox[{"First", "@", 
         RowBox[{"FirstPosition", "[", 
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "&"}], ",", "res"}], 
            "]"}], ",", "ix"}], "]"}]}]}], ";", "\n", 
       RowBox[{"para", " ", "=", " ", 
        RowBox[{"res", "[", 
         RowBox[{"[", "pix", "]"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"para", "[", "\"\<Members\>\"", "]"}], " ", "=", " ", 
        RowBox[{"Drop", "[", 
         RowBox[{
          RowBox[{"para", "[", "\"\<Members\>\"", "]"}], ",", "dix"}], 
         "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"res", "[", 
         RowBox[{"[", "pix", "]"}], "]"}], "=", "para"}], ";", "\n", 
       "res"}]}], "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"appendParastichyElements", "[", 
    RowBox[{"mpf_", ",", "ix_", ",", "extraPoints_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", ",", "para", ",", "pix"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"res", " ", "=", " ", "mpf"}], ";", "\n", 
      RowBox[{"pix", " ", "=", " ", 
       RowBox[{"First", "@", 
        RowBox[{"FirstPosition", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "&"}], ",", "res"}], 
           "]"}], ",", "ix"}], "]"}]}]}], ";", "\n", 
      RowBox[{"para", " ", "=", " ", 
       RowBox[{"res", "[", 
        RowBox[{"[", "pix", "]"}], "]"}]}], ";", "\n", 
      RowBox[{
       RowBox[{"para", "[", "\"\<Members\>\"", "]"}], " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"para", "[", "\"\<Members\>\"", "]"}], ",", "extraPoints"}], 
        "]"}]}], ";", "\n", 
      RowBox[{
       RowBox[{"res", "[", 
        RowBox[{"[", "pix", "]"}], "]"}], "=", "para"}], ";", "\n", "res"}]}],
     "\n", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"prependParastichyElements", "[", 
    RowBox[{"mpf_", ",", "ix_", ",", "extraPoints_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", ",", "para", ",", "pix"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"res", " ", "=", " ", "mpf"}], ";", "\n", 
      RowBox[{"pix", " ", "=", " ", 
       RowBox[{"First", "@", 
        RowBox[{"FirstPosition", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "&"}], ",", "res"}], 
           "]"}], ",", "ix"}], "]"}]}]}], ";", "\n", 
      RowBox[{"para", " ", "=", " ", 
       RowBox[{"res", "[", 
        RowBox[{"[", "pix", "]"}], "]"}]}], ";", "\n", 
      RowBox[{
       RowBox[{"para", "[", "\"\<Members\>\"", "]"}], " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"extraPoints", ",", 
         RowBox[{"para", "[", "\"\<Members\>\"", "]"}]}], "]"}]}], ";", "\n", 
      RowBox[{
       RowBox[{"res", "[", 
        RowBox[{"[", "pix", "]"}], "]"}], "=", "para"}], ";", "\n", "res"}]}],
     "\n", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[42]:=",ExpressionUUID->"8d91e29a-16bb-4df2-99a4-fcf8eb6bdae2"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"parastichyStarter", "[", 
      RowBox[{"meshAssociation_", ",", " ", "starter_"}], "]"}], " ", ":=", 
     "\n", "  ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"inner", ",", " ", "parastichyPoints"}], "}"}], ",", "\n", 
       "    ", 
       RowBox[{
        RowBox[{"inner", " ", "=", " ", 
         RowBox[{"meshExtendParastichy", "[", 
          RowBox[{"meshAssociation", ",", " ", "starter", ",", " ", 
           RowBox[{
           "locateParastichyOptions", "[", "\"\<InitialParastichyLength\>\"", 
            "]"}], ",", " ", 
           RowBox[{"{", "}"}], ",", " ", 
           RowBox[{"{", "}"}]}], "]"}]}], ";", "\n", "   ", "inner"}]}], "\n",
       "  ", "]"}]}], ";"}], "\n", " ", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"meshExtendParastichy", "[", 
      RowBox[{
      "meshAssociation_", ",", "starter_", ",", "length_", ",", 
       "avoidPoints_", ",", "adjacentParastichy_"}], "]"}], " ", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", "parastichy", ",", "np", ",", "decho"}], "}"}], ",",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
         RowBox[{"If", "[", 
          RowBox[{"False", ",", 
           RowBox[{"Echo", "[", "x", "]"}], ",", "x"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"parastichy", " ", "=", " ", "starter"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"For", "[", " ", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "<=", " ", "length"}], ",", 
          RowBox[{"i", "++"}], ",", 
          RowBox[{
           RowBox[{"np", " ", "=", " ", 
            RowBox[{"decho", "@", 
             RowBox[{"nextParastichyPoint", "[", 
              RowBox[{
              "meshAssociation", ",", "parastichy", ",", "avoidPoints", ",", 
               "adjacentParastichy"}], "]"}]}]}], ";", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"MissingQ", "[", "np", "]"}], ",", 
             RowBox[{"Break", "[", "]"}]}], "]"}], ";", 
           RowBox[{"parastichy", "=", " ", 
            RowBox[{"Append", "[", 
             RowBox[{"parastichy", ",", "np"}], "]"}]}], ";", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"meshAssociation", "[", "\"\<OuterBoundary\>\"", "]"}],
                ",", "np"}], "]"}], ",", 
             RowBox[{"Break", "[", "]"}]}], "]"}], ";", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"meshAssociation", "[", "\"\<InnerBoundary\>\"", "]"}],
                ",", "np"}], "]"}], ",", 
             RowBox[{"Break", "[", "]"}]}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "parastichy"}]}], "\n", "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[47]:=",ExpressionUUID->"e051c6ea-9b7a-4344-afed-0ec63275c8f0"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"nextParastichyPoint", "[", 
      RowBox[{
      "meshAssociation_", ",", " ", "parastichy_", ",", " ", "avoidPoints_", 
       ",", " ", "adjacentParastichy_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "candidateContinues", ",", " ", "straightnessAngle", ",", " ", 
         "nextStraightest", ",", " ", "debugTest", ",", " ", 
         "adjacentParastichyEnds", ",", " ", "candidateInfo", ",", " ", 
         "adjacentParastichyCentre", ",", " ", "adjacentCandidates", ",", " ",
          "res", ",", " ", "decho"}], "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", " ", 
       RowBox[{
        RowBox[{"debugTest", " ", "=", " ", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"845", ",", " ", "10"}], "}"}], ",", " ", 
           RowBox[{"-", 
            RowBox[{"First", "@", "parastichy"}]}]}], "]"}]}], ";", " ", 
        RowBox[{
         RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
         RowBox[{"If", "[", 
          RowBox[{"debugTest", ",", " ", 
           RowBox[{"Echo", "[", 
            RowBox[{"x", ",", " ", "\"\<nPP\>\""}], "]"}], ",", " ", "x"}], 
          "]"}]}], ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "parastichy", "]"}], " ", "==", " ", "0"}], 
          ",", " ", 
          RowBox[{"Return", "[", 
           RowBox[{"Missing", "[", "\"\<No parastichy to extend\>\"", "]"}], 
           "]"}]}], "]"}], ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MissingQ", "[", "parastichy", "]"}], " ", "==", " ", 
           "0"}], ",", " ", 
          RowBox[{"Return", "[", 
           RowBox[{"Missing", "[", "\"\<Missing parastichy\>\"", "]"}], 
           "]"}]}], "]"}], ";", 
        RowBox[{"straightnessAngle", " ", "=", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "adjacentParastichy", "]"}], " ", ">", " ",
             "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{
           "locateParastichyOptions", "[", "\"\<StraightnessWhenAdjacent\>\"",
             "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{
           "locateParastichyOptions", "[", 
            "\"\<StraightnessWhenUnadjacent\>\"", "]"}]}], 
          "\[IndentingNewLine]", "]"}]}], ";", 
        RowBox[{"adjacentParastichyEnds", "  ", "=", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "adjacentParastichy", "]"}], " ", "==", 
            " ", "0"}], ",", " ", 
           RowBox[{"{", "}"}], ",", " ", 
           RowBox[{"Union", " ", "@@", " ", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"adjacencyFunction", "[", "meshAssociation", "]"}], 
                "[", "#", "]"}], " ", "&"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"First", "[", "adjacentParastichy", "]"}], ",", " ", 
                RowBox[{"Last", "[", "adjacentParastichy", "]"}]}], "}"}]}], 
             "]"}]}]}], "]"}]}], ";", " ", 
        RowBox[{"adjacentParastichyCentre", "   ", "=", " ", 
         RowBox[{"Complement", "[", 
          RowBox[{"adjacentParastichy", ",", " ", "adjacentParastichyEnds"}], 
          "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"candidateContinues", " ", "=", " ", 
         RowBox[{
          RowBox[{"adjacencyFunction", "[", "meshAssociation", "]"}], "[", 
          RowBox[{"Last", "@", "parastichy"}], "]"}]}], ";", "   ", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"candidateContinues", " ", "=", " ", 
         RowBox[{"Complement", "[", 
          RowBox[{"candidateContinues", ",", " ", "avoidPoints"}], "]"}]}], 
        ";", " ", 
        RowBox[{"candidateInfo", " ", "=", " ", 
         RowBox[{
          RowBox[{"KeyValueMap", "[", " ", 
           RowBox[{
            RowBox[{"<|", " ", 
             RowBox[{
              RowBox[{"\"\<Node\>\"", " ", "->", " ", "#1"}], ",", " ", 
              RowBox[{"\"\<Deviation\>\"", " ", "->", " ", "#2"}]}], "|>"}], 
            " ", "&"}], "]"}], "@", 
          RowBox[{"orderByStraightness", "[", 
           RowBox[{
           "meshAssociation", ",", " ", "parastichy", ",", " ", 
            "candidateContinues"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        " ", 
        RowBox[{"candidateInfo", " ", "=", " ", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Append", "[", 
             RowBox[{"#", ",", " ", "\[IndentingNewLine]", 
              RowBox[{"\"\<Adjacency\>\"", " ", "->", " ", 
               RowBox[{
                RowBox[{"adjacencyFunction", "[", "meshAssociation", "]"}], 
                "[", 
                RowBox[{"#", "[", "\"\<Node\>\"", "]"}], "]"}]}]}], "]"}], 
            " ", "&"}], ",", " ", "candidateInfo"}], "]"}]}], ";", 
        "\[IndentingNewLine]", " ", 
        RowBox[{"candidateInfo", " ", "=", " ", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Append", "[", 
             RowBox[{"#", ",", " ", "\[IndentingNewLine]", 
              RowBox[{"\"\<NextToAdjacentCentre\>\"", " ", "->", "  ", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"Intersection", "[", 
                  RowBox[{
                   RowBox[{"#", "[", "\"\<Adjacency\>\"", "]"}], ",", " ", 
                   "adjacentParastichyCentre"}], "]"}], "]"}], " ", ">", " ", 
                "0"}]}]}], "]"}], " ", "&"}], ",", " ", "candidateInfo"}], 
          "]"}]}], ";", " ", 
        RowBox[{"candidateInfo", " ", "=", " ", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Append", "[", 
             RowBox[{"#", ",", " ", "\[IndentingNewLine]", 
              RowBox[{"\"\<NextToAdjacentEnds\>\"", " ", "->", "  ", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"Intersection", "[", 
                  RowBox[{
                   RowBox[{"#", "[", "\"\<Adjacency\>\"", "]"}], ",", " ", 
                   "adjacentParastichyEnds"}], "]"}], "]"}], " ", ">", " ", 
                "0"}]}]}], "]"}], " ", "&"}], ",", " ", "candidateInfo"}], 
          "]"}]}], ";", "\[IndentingNewLine]", " ", 
        RowBox[{"candidateInfo", " ", "=", " ", 
         RowBox[{"Map", "[", "     ", 
          RowBox[{
           RowBox[{
            RowBox[{"Append", "[", 
             RowBox[{"#", ",", " ", "\[IndentingNewLine]", 
              RowBox[{"\"\<NextToAdjacent\>\"", " ", "->", "   ", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"Intersection", "[", 
                  RowBox[{
                   RowBox[{"#", "[", "\"\<Adjacency\>\"", "]"}], ",", " ", 
                   "adjacentParastichy"}], "]"}], "]"}], " ", ">", " ", 
                "0"}]}]}], "]"}], " ", "&"}], ",", " ", "candidateInfo"}], 
          "]"}]}], ";", "\[IndentingNewLine]", " ", 
        RowBox[{"candidateInfo", " ", "=", " ", 
         RowBox[{"Map", "[", "   ", 
          RowBox[{
           RowBox[{
            RowBox[{"Append", "[", 
             RowBox[{"#", ",", " ", "\[IndentingNewLine]", 
              RowBox[{"\"\<OnAdjacent\>\"", " ", "->", "   ", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"Intersection", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"#", "[", "\"\<Node\>\"", "]"}], "}"}], ",", " ", 
                   "adjacentParastichy"}], "]"}], "]"}], " ", ">", " ", 
                "0"}]}]}], "]"}], " ", "&"}], ",", " ", "candidateInfo"}], 
          "]"}]}], ";", 
        RowBox[{"candidateInfo", " ", "=", " ", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Append", "[", 
             RowBox[{"#", ",", "\[IndentingNewLine]", " ", 
              RowBox[{"\"\<Straightish\>\"", " ", "->", " ", 
               RowBox[{"isStraightish", "[", "#", "]"}]}]}], "]"}], " ", 
            "&"}], ",", " ", "candidateInfo"}], "]"}]}], ";", "\n", "   ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "screen", " ", "out", " ", "any", " ", "with", " ", "too", " ", 
          "much", " ", "deviation", " ", "anyway"}], " ", "*)"}], " ", 
        "\[IndentingNewLine]", 
        RowBox[{"candidateInfo", " ", "=", "  ", 
         RowBox[{
          RowBox[{"Query", "[", 
           RowBox[{"Select", "[", "  ", 
            RowBox[{
             RowBox[{"#", "[", "\"\<Straightish\>\"", "]"}], " ", "&"}], " ", 
            "]"}], "]"}], "@", " ", "candidateInfo"}]}], ";", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "candidateInfo", "]"}], " ", "==", " ", 
           "0"}], ",", " ", 
          RowBox[{"Return", "[", 
           RowBox[{"Missing", "[", "\"\<End of the line\>\"", "]"}], "]"}]}], 
         "  ", "]"}], ";", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"First", "[", "candidateInfo", "]"}], "[", 
           "\"\<OnAdjacent\>\"", "]"}], ",", "  ", 
          RowBox[{"Return", "[", 
           RowBox[{"Missing", "[", "\"\<Collision\>\"", "]"}], "]"}]}], 
         "    ", "]"}], ";", "\n", "   ", "\n", "   ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "do", " ", "we", " ", "have", " ", "any", " ", "that", " ", 
          "preserve", " ", "adjacency"}], " ", "*)"}], " ", 
        RowBox[{"adjacentCandidates", " ", "=", "  ", 
         RowBox[{
          RowBox[{"Query", "[", 
           RowBox[{"Select", "[", "  ", 
            RowBox[{
             RowBox[{"#", "[", "\"\<NextToAdjacent\>\"", "]"}], " ", "&"}], 
            " ", "]"}], "]"}], "@", "candidateInfo"}]}], ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "adjacentCandidates", "]"}], " ", ">", " ", 
           "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"res", " ", "=", " ", 
            RowBox[{
             RowBox[{"First", "[", "adjacentCandidates", "]"}], "[", 
             "\"\<Node\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "res", "]"}]}]}], "\[IndentingNewLine]", 
         "]"}], ";", "   ", "\n", "   ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "otherwise", " ", "we", " ", "take", " ", "a", " ", "nonadjacent", 
          " ", 
          RowBox[{"(", 
           RowBox[{
           "which", " ", "may", " ", "have", " ", "been", " ", "straighter"}],
            " "}]}], "*)"}], 
        RowBox[{"res", " ", "=", " ", 
         RowBox[{
          RowBox[{"First", "[", "candidateInfo", "]"}], "[", "\"\<Node\>\"", 
          "]"}]}], ";", " ", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "res", "]"}], ";"}]}], "\n", "   ", "]"}]}], 
    ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"isStraightish", "[", "cInfo_", "]"}], " ", ":=", " ", 
     RowBox[{"(", "\n", "   ", 
      RowBox[{
       RowBox[{"Abs", "[", 
        RowBox[{"cInfo", "[", "\"\<Deviation\>\"", "]"}], "]"}], " ", "<", 
       " ", "\n", "    ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"cInfo", "[", "\"\<NextToAdjacentCentre\>\"", "]"}], " ", "||",
           " ", 
          RowBox[{"cInfo", "[", "\"\<NextToAdjacentEnds\>\"", "]"}]}], ",", 
         " ", "\n", "     ", 
         RowBox[{
         "locateParastichyOptions", "[", "\"\<StraightnessWhenAdjacent\>\"", 
          "]"}], ",", "\n", "     ", 
         RowBox[{
         "locateParastichyOptions", "[", "\"\<StraightnessWhenUnadjacent\>\"",
           "]"}]}], "\n", "     ", "]"}]}], "\n", "   ", ")"}]}], ";"}], "\n",
    "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"orderByStraightness", "[", 
      RowBox[{
      "meshAssociation_", ",", " ", "parastichy_", ",", " ", 
       "candidateContinues_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "paraPossiblePairs", ",", " ", "paraPossibleAngles", ",", " ", 
         "lastAngle", ",", " ", "paraAngles", ",", " ", "deviationsNext"}], 
        "}"}], ",", " ", 
       RowBox[{
        RowBox[{"paraPossiblePairs", " ", "=", " ", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"parastichy", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}], ",", " ", "#"}], "}"}], " ",
             "&"}], ",", " ", "candidateContinues"}], "]"}]}], ";", " ", 
        RowBox[{"paraPossibleAngles", " ", "=", " ", 
         RowBox[{"Association", "@", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], " ", "->", " ", 
              RowBox[{"graphEdgeAngle", "[", 
               RowBox[{"meshAssociation", ",", " ", "#"}], "]"}]}], " ", 
             "&"}], ",", " ", "paraPossiblePairs"}], "]"}]}]}], ";", " ", 
        RowBox[{"lastAngle", " ", "=", " ", 
         RowBox[{"graphEdgeAngle", "[", 
          RowBox[{"meshAssociation", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"parastichy", "[", 
              RowBox[{"[", 
               RowBox[{"-", "2"}], "]"}], "]"}], ",", " ", 
             RowBox[{"parastichy", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", " ", 
        RowBox[{"paraAngles", " ", "=", " ", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"anglePrincipal", "[", 
             RowBox[{"#", " ", "-", " ", "lastAngle"}], "]"}], " ", "&"}], 
           ",", " ", "paraPossibleAngles"}], "]"}]}], ";", " ", 
        RowBox[{"deviationsNext", " ", "=", " ", 
         RowBox[{"Sort", "@", 
          RowBox[{"Abs", "[", "paraAngles", "]"}]}]}], ";", "\n", "   ", 
        "deviationsNext"}]}], "\n", "   ", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\n"}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[49]:=",ExpressionUUID->"76ea223f-8c2c-4947-9ea8-ff05b8f82dd0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"graphLineDeviation", "[", 
     RowBox[{"meshAssociation_", ",", " ", 
      RowBox[{"{", 
       RowBox[{"ix1_", ",", " ", "ix2_", ",", " ", "ix3_"}], "}"}]}], "]"}], 
    " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"first", ",", " ", "second"}], "}"}], ",", "\n", "   ", 
      RowBox[{"(*", " ", 
       RowBox[{"in", " ", "[", 
        RowBox[{
         RowBox[{"-", "180"}], ",", "180"}], " "}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"first", " ", "=", "  ", 
        RowBox[{"graphEdgeAngle", "[", 
         RowBox[{"meshAssociation", ",", 
          RowBox[{"{", 
           RowBox[{"ix1", ",", "ix2"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"second", " ", "=", " ", 
        RowBox[{"graphEdgeAngle", "[", 
         RowBox[{"meshAssociation", ",", 
          RowBox[{"{", 
           RowBox[{"ix2", ",", "ix3"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"anglePrincipal", "[", 
        RowBox[{"first", " ", "-", " ", "second"}], "]"}]}]}], "\n", "   ", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"graphEdgeAngle", "[", 
     RowBox[{"meshAssociation_", ",", 
      RowBox[{"{", 
       RowBox[{"ix1_", ",", "ix2_"}], "}"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"p1p2", ",", "pAngle"}], "}"}], ",", "\n", 
      RowBox[{"(*", " ", 
       RowBox[{"in", " ", "[", 
        RowBox[{
         RowBox[{"-", "180"}], ",", "180"}], " "}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p1p2", " ", "=", 
        RowBox[{"graphCoordinates", "[", 
         RowBox[{
          RowBox[{"meshAssociation", "[", "\"\<Graph\>\"", "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"ix1", ",", " ", "ix2"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pAngle", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x1_", ",", " ", "y1_"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"x2_", ",", " ", "y2_"}], "}"}]}], "}"}], "]"}], " ", ":=",
         " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"360", "/", 
           RowBox[{"(", 
            RowBox[{"2", " ", "\[Pi]"}], ")"}]}], ")"}], " ", 
         RowBox[{"ArcTan", "[", 
          RowBox[{
           RowBox[{"x2", " ", "-", " ", "x1"}], ",", " ", 
           RowBox[{"y2", " ", "-", " ", "y1"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pAngle", "[", "p1p2", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[52]:=",ExpressionUUID->"504ad3de-5291-4d89-8927-7f0ac3e8f56c"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"anglePrincipal", "[", "angle_", "]"}], " ", ":=", "  ", 
     RowBox[{"angle", " ", "-", " ", 
      RowBox[{"360", " ", 
       RowBox[{"Round", "[", 
        RowBox[{"angle", "/", "360"}], "]"}]}]}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"in", " ", "-", "180"}], " ", "<", " ", "angle", " ", "<", " ", 
     "180"}], " ", "*)"}], " ", "\n"}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[54]:=",ExpressionUUID->"ecc020ae-fd64-4da8-8c04-0acd6e012dfe"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"extendThreadAndAdd", "[", 
    RowBox[{"meshAssociation_", ",", "parastichyFamily_", ",", "thread_"}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mPF", ",", "extendThread", ",", "avoidPoints", ",", "decho"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mPF", " ", "=", " ", "parastichyFamily"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"avoidPoints", " ", "=", " ", 
       RowBox[{"nodesInParastichyFamily", "[", "mPF", "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Intersection", "[", 
           RowBox[{"thread", ",", "avoidPoints"}], "]"}], "]"}], ">", "0"}], 
        ",", 
        RowBox[{"Return", "[", "mPF", "]"}]}], "]"}], ";", 
      RowBox[{"extendThread", " ", "=", " ", 
       RowBox[{"meshExtendParastichy", "[", 
        RowBox[{"meshAssociation", ",", "thread", ",", 
         RowBox[{
         "locateParastichyOptions", "[", "\"\<ParastichyExtensionLength\>\"", 
          "]"}], ",", " ", "avoidPoints", ",", 
         RowBox[{"{", "}"}]}], "]"}]}], ";", 
      RowBox[{"avoidPoints", " ", "=", " ", 
       RowBox[{"Union", "[", 
        RowBox[{"avoidPoints", ",", "extendThread"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"extendThread", " ", "=", " ", 
       RowBox[{"meshExtendParastichy", "[", 
        RowBox[{"meshAssociation", ",", 
         RowBox[{"Reverse", "@", "extendThread"}], ",", 
         RowBox[{
         "locateParastichyOptions", "[", "\"\<ParastichyExtensionLength\>\"", 
          "]"}], ",", " ", "avoidPoints", ",", 
         RowBox[{"{", "}"}]}], "]"}]}], ";", 
      RowBox[{"decho", "[", 
       RowBox[{"{", 
        RowBox[{"\"\<Second extension \>\"", ",", "extendThread"}], "}"}], 
       "]"}], ";", 
      RowBox[{"avoidPoints", " ", "=", " ", 
       RowBox[{"Union", "[", 
        RowBox[{"avoidPoints", ",", "extendThread"}], "]"}]}], ";", 
      RowBox[{"extendThread", "  ", "=", " ", 
       RowBox[{"makeDirectedParastichy", "[", 
        RowBox[{"meshAssociation", ",", "extendThread"}], "]"}]}], ";", 
      RowBox[{"mPF", " ", "=", " ", 
       RowBox[{"addToParastichyFamily", "[", 
        RowBox[{"mPF", ",", "extendThread"}], "]"}]}], " ", ";", " ", 
      "\[IndentingNewLine]", "mPF"}]}], "\n", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[55]:=",ExpressionUUID->"66768435-00b5-4a9d-92b3-461e76c140f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"findAdjacentThreads", "[", 
    RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "mPF", ",", "atp", ",", "family", ",", "ix", ",", "avoidPoints", ",", 
       "extendThread", ",", "decho", ",", "nTimes"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mPF", " ", "=", " ", "parastichyFamily"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"nTimes", " ", "=", " ", "1"}], ",", 
        RowBox[{"nTimes", "<=", " ", "1"}], ",", 
        RowBox[{"nTimes", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"atp", " ", "=", " ", 
          RowBox[{"adjacentThreadsToParastichyFamily", "[", 
           RowBox[{"meshAssociation", ",", "mPF"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"ix", "=", "1"}], ",", 
           RowBox[{"ix", "<=", " ", 
            RowBox[{"Length", "[", "atp", "]"}]}], ",", 
           RowBox[{"ix", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"mPF", " ", "=", " ", 
             RowBox[{"extendThreadAndAdd", "[", 
              RowBox[{"meshAssociation", ",", "mPF", ",", 
               RowBox[{"atp", "[", 
                RowBox[{"[", "ix", "]"}], "]"}]}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", "mPF"}]}], "\n", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[56]:=",ExpressionUUID->"322c5088-f8d9-44cb-b112-dc5e4d3df686"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"centralMembers", "[", "parastichyFamilyMember_", "]"}], " ", ":=",
     " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "members", "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"members", " ", "=", " ", 
        RowBox[{"parastichyFamilyMember", "[", "\"\<Members\>\"", "]"}]}], 
       ";", "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "members", "]"}], "==", "0"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{
          "Missing", "[", "\"\<Error: parastichy with no members\>\"", "]"}], 
          "]"}]}], "]"}], ";", "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "members", "]"}], "<", "3"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"{", "}"}], "]"}]}], "]"}], ";", "\n", 
       RowBox[{"Drop", "[", 
        RowBox[{
         RowBox[{"Drop", "[", 
          RowBox[{"members", ",", 
           RowBox[{"-", "1"}]}], "]"}], ",", "1"}], "]"}]}]}], "\n", "]"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"nodesInParastichyFamily", "[", "parastichyFamily_", "]"}], " ", ":=",
     "  ", 
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{"Union", "@@", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", "\"\<Members\>\"", "]"}], "&"}], ",", 
        "parastichyFamily"}], "]"}]}], "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"nonEndNodesInParastichyFamily", "[", "parastichyFamily_", "]"}], 
    " ", ":=", "  ", 
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{"Union", "@@", 
      RowBox[{"Map", "[", 
       RowBox[{"centralMembers", ",", "parastichyFamily"}], "]"}]}], "]"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"adjacentNodesToParastichyFamily", "[", 
    RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], ":=", "  ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"familyPoints", ",", "allAdjacentPoints"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"familyPoints", "  ", "=", "  ", 
       RowBox[{"nonEndNodesInParastichyFamily", "@", "parastichyFamily"}]}], 
      ";", "\n", 
      RowBox[{"allAdjacentPoints", " ", "=", " ", 
       RowBox[{"Union", " ", "@@", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"adjacencyFunction", "[", "meshAssociation", "]"}], "[", 
            "#", "]"}], "&"}], ",", " ", "familyPoints"}], "]"}]}]}], ";", 
      "\n", 
      RowBox[{"allAdjacentPoints", " ", "=", " ", 
       RowBox[{"DeleteDuplicates", " ", "@", "allAdjacentPoints"}]}], " ", 
      ";", "\n", 
      RowBox[{"allAdjacentPoints", "=", " ", 
       RowBox[{"Complement", "[", 
        RowBox[{"allAdjacentPoints", ",", " ", 
         RowBox[{"nodesInParastichyFamily", "[", "parastichyFamily", "]"}]}], 
        " ", "]"}]}], ";", "\n", "allAdjacentPoints"}]}], "\n", "]"}]}], 
  ";"}]}], "Code",
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[57]:=",ExpressionUUID->"be645f4a-1ec5-42a2-a97d-351d1dab3f71"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"orientThreadToParastichy", "[", 
      RowBox[{"meshAssociation_", ",", "parastichy_", ",", "thread_"}], "]"}],
      " ", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "res", "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"al", " ", "=", " ", 
         RowBox[{"Map", "[", "\[IndentingNewLine]", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"AdjacencyList", "[", 
             RowBox[{
              RowBox[{"meshAssociation", "[", "\"\<Graph\>\"", "]"}], ",", 
              "#"}], "]"}], "&"}], ",", "parastichy"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"alFirst", " ", "=", " ", 
         RowBox[{"First", "@", 
          RowBox[{"FirstPosition", "[", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"MemberQ", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"First", "[", "thread", "]"}]}], "]"}], "&"}], ",", 
              "al"}], "]"}], ",", "True"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"alLast", " ", "=", " ", 
         RowBox[{"First", "@", 
          RowBox[{"FirstPosition", "[", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"MemberQ", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"Last", "[", "thread", "]"}]}], "]"}], "&"}], ",", 
              "al"}], "]"}], ",", "True"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"res", " ", "=", " ", "thread"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"alFirst", ">", "alLast"}], ",", "\[IndentingNewLine]", 
          RowBox[{"res", " ", "=", " ", 
           RowBox[{"Reverse", "[", "res", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "res"}]}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"orientComponentToParastichy", "[", 
      RowBox[{"meshAssociation_", ",", "parastichy_", ",", "component_"}], 
      "]"}], " ", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"endPoints", ",", "thread"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "called", " ", "here", " ", "after", " ", "split", " ", "at", " ", 
          "Splits"}], ",", " ", 
         RowBox[{
         "so", " ", "component", " ", "has", " ", "all", " ", "edge", " ", 
          "counts", " ", "1", " ", "or", " ", "2"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"endPoints", " ", "=", " ", 
         RowBox[{"Select", "[", 
          RowBox[{
           RowBox[{"VertexList", "[", "component", "]"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"vertexEdgeCount", "[", 
              RowBox[{"component", ",", "#"}], "]"}], "==", "1"}], "&"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "endPoints", "]"}], "\[NotEqual]", "2"}], 
          ",", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "endPoints", ",", "component", ",", 
             "\"\<Endpoints not found in oCTP\>\""}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]",
         "\[IndentingNewLine]", 
        RowBox[{"thread", " ", "=", " ", 
         RowBox[{"FindPath", "[", 
          RowBox[{"component", ",", 
           RowBox[{
           "endPoints", "\[LeftDoubleBracket]", "1", 
            "\[RightDoubleBracket]"}], ",", 
           RowBox[{
           "endPoints", "\[LeftDoubleBracket]", "2", 
            "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "thread", "]"}], "\[NotEqual]", " ", "1"}], 
          ",", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "endPoints", ",", "component", ",", 
             "\"\<Path not found in oCTP\>\""}], "]"}], 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"thread", " ", "=", " ", 
         RowBox[{"First", "[", "thread", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"orientThreadToParastichy", "[", 
         RowBox[{"meshAssociation", ",", "parastichy", ",", "thread"}], 
         "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"adjacentThreadsToParastichy", "[", 
      RowBox[{"meshAssociation_", ",", "parastichy_", ",", "avoidPoints_"}], 
      "]"}], ":=", "  ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "g", ",", "adjacentNodes", ",", "adjacentSubgraph", ",", "gList", ",",
          "largestAdjacentSubgraph", ",", "allAdjacentComponents", ",", 
         "adjacentThreads"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"debugTest", " ", "=", " ", "False"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"g", "=", " ", 
         RowBox[{"meshAssociation", "[", "\"\<Graph\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"adjacentNodes", " ", "=", " ", 
         RowBox[{"Apply", "[", 
          RowBox[{"Union", ",", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"AdjacencyList", "[", 
               RowBox[{"g", ",", "#"}], "]"}], "&"}], " ", ",", 
             "parastichy"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"adjacentNodes", " ", "=", " ", 
         RowBox[{"Complement", "[", 
          RowBox[{"adjacentNodes", ",", "avoidPoints"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"adjacentSubgraph", "  ", "=", " ", 
         RowBox[{"Subgraph", "[", 
          RowBox[{"g", ",", "adjacentNodes", ",", 
           RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"VertexCount", "[", "adjacentSubgraph", "]"}], "<", "2"}], 
          ",", 
          RowBox[{"Return", "[", 
           RowBox[{"Nothing", "[", "]"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"gList", " ", "=", " ", 
         RowBox[{"ConnectedGraphComponents", "[", "adjacentSubgraph", "]"}]}],
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"gList", " ", "=", "  ", 
         RowBox[{"Flatten", "@", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"splitAtKinks2", "[", 
              RowBox[{"meshAssociation", ",", "#"}], "]"}], "&"}], ",", 
            "gList"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"gList", " ", "=", "  ", 
         RowBox[{"Flatten", "@", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"splitAtSplits", "[", 
              RowBox[{"meshAssociation", ",", "#"}], "]"}], "&"}], ",", 
            "gList"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"adjacentThreads", " ", "=", " ", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"orientComponentToParastichy", "[", 
             RowBox[{"meshAssociation", ",", "parastichy", ",", "#"}], "]"}], 
            "&"}], ",", "gList"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "adjacentThreads", "]"}], ";"}]}], "\n", 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"adjacentThreadsToParastichyFamily", "[", 
      RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], ":=", 
     "  ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"adjacentThreads", ",", "avoidPoints", ",", "parastichies"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"debugTest", " ", "=", " ", "False"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"avoidPoints", " ", "=", "  ", 
         RowBox[{"nodesInParastichyFamily", "[", "parastichyFamily", "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"parastichies", " ", "=", " ", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "\"\<Members\>\"", "]"}], "&"}], ",", 
           "parastichyFamily"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"adjacentThreads", " ", "=", " ", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"adjacentThreadsToParastichy", "[", 
             RowBox[{"meshAssociation", ",", "#", ",", "avoidPoints"}], "]"}],
             "&"}], ",", "parastichies"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"adjacentThreads", " ", "=", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"adjacentThreads", ",", "1"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "adjacentThreads"}]}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[61]:=",ExpressionUUID->"c1ab1a61-6202-4858-9b27-ab224e963ebe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"vertexEdgeCount", "[", 
     RowBox[{"graph_", ",", "vertex_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Length", "[", 
     RowBox[{"IncidenceList", "[", 
      RowBox[{"graph", ",", "vertex"}], "]"}], "]"}]}], ";"}], "\n", 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"removeCyclicPoints", "[", "component_", "]"}], " ", ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "stree", ",", "incidence", ",", "edgeCount", ",", "branchPoints", ",", 
        "streeComponents", ",", "res"}], "}"}], ",", 
      RowBox[{
       RowBox[{"stree", " ", "=", " ", 
        RowBox[{"FindSpanningTree", "[", "component", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"incidence", "  ", "=", "  ", 
        RowBox[{"AssociationThread", "[", 
         RowBox[{
          RowBox[{"VertexList", "[", "stree", "]"}], ",", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"IncidenceList", "[", 
              RowBox[{"stree", ",", "#"}], "]"}], "&"}], ",", 
            RowBox[{"VertexList", "[", "stree", "]"}]}], "]"}]}], "]"}]}], 
       ";", 
       RowBox[{"edgeCount", "  ", "=", "  ", 
        RowBox[{"Map", "[", 
         RowBox[{"Length", ",", "incidence"}], "]"}]}], ";", 
       RowBox[{"branchPoints", " ", "=", " ", 
        RowBox[{"Select", "[", 
         RowBox[{"edgeCount", ",", 
          RowBox[{
           RowBox[{"#", ">", "2"}], "&"}]}], "]"}]}], ";", 
       RowBox[{"stree", " ", "=", 
        RowBox[{"VertexDelete", "[", 
         RowBox[{"component", ",", 
          RowBox[{"Keys", "@", "branchPoints"}]}], "]"}]}], ";", 
       RowBox[{"streeComponents", " ", "=", " ", 
        RowBox[{"ConnectedGraphComponents", "[", "stree", "]"}]}], ";", 
       RowBox[{"streeComponents", " ", "=", " ", 
        RowBox[{"SortBy", "[", 
         RowBox[{"streeComponents", ",", "VertexCount"}], "]"}]}], ";", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"Last", "@", "streeComponents"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "res"}]}], "\n", "\n", 
     "]"}]}], ";"}], "\n", "\n"}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[65]:=",ExpressionUUID->"bd123bb0-00cd-4325-b748-3131e98f621a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"findLongestPath", "[", "g_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"paths", ",", "path", ",", "decho"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{"False", ",", 
         RowBox[{"Echo", "[", 
          RowBox[{"x", ",", "\"\<fLP\>\""}], "]"}], ",", "x"}], "]"}]}], ";", 
      "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCount", "[", "g", "]"}], "<=", " ", "2"}], ",", " ", 
        RowBox[{"Return", "[", 
         RowBox[{"VertexList", "[", "g", "]"}], "]"}]}], "]"}], ";", "\n", 
      RowBox[{"paths", " ", "=", 
       RowBox[{"findEdgePaths", "[", "g", "]"}]}], ";", "\n", 
      RowBox[{"path", " ", "=", " ", 
       RowBox[{
        RowBox[{"Last", "[", 
         RowBox[{"SortBy", "[", 
          RowBox[{"paths", ",", 
           RowBox[{
            RowBox[{"#", "[", "\"\<PathLength\>\"", "]"}], "&"}]}], "]"}], 
         "]"}], "[", "\"\<Path\>\"", "]"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "path", "]"}], "==", "0"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"Missing", "[", "\"\<No spanning path\>\"", "]"}], "]"}]}], 
       "]"}], ";", "\n", "path"}]}], "\n", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[67]:=",ExpressionUUID->"82855400-5408-449f-af68-370bf0c13ed9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"findEndPoints", "[", "g_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"acyclic", ",", "endPoints"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{"False", ",", 
         RowBox[{"Echo", "[", 
          RowBox[{"x", ",", "\"\<fEPt\>\""}], "]"}], ",", "x"}], "]"}]}], ";",
       "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCount", "[", "g", "]"}], "<=", " ", "1"}], ",", " ", 
        RowBox[{"Return", "[", 
         RowBox[{"VertexList", "[", "g", "]"}], "]"}]}], "]"}], ";", "\n", 
      RowBox[{"acyclic", " ", "=", " ", 
       RowBox[{"FindSpanningTree", "[", "g", "]"}]}], ";", "\n", 
      RowBox[{"endPoints", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"VertexList", "[", "acyclic", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"vertexEdgeCount", "[", 
            RowBox[{"acyclic", ",", "#"}], "]"}], "==", "1"}], "&"}]}], 
        "]"}]}], ";", "\n", "endPoints"}]}], "\n", "]"}]}], ";"}]], "Code",
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[68]:=",ExpressionUUID->"3707e896-ac90-41c5-bd63-2e31683bd266"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"findEdgePaths", "[", "g_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"acyclic", ",", "endPoints", ",", "paths", ",", "decho"}], 
      "}"}], ",", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{"False", ",", 
         RowBox[{"Echo", "[", 
          RowBox[{"x", ",", "\"\<fEP\>\""}], "]"}], ",", "x"}], "]"}]}], ";", 
      "\n", 
      RowBox[{"endPoints", " ", "=", " ", 
       RowBox[{"decho", "@", 
        RowBox[{"findEndPoints", "[", "g", "]"}]}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endPoints", "]"}], "<", "1"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"Missing", "[", "\"\<Missing path ends\>\"", "]"}], "]"}]}], 
       "]"}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endPoints", "]"}], "==", "1"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{
         "Missing", "[", "\"\<Couldn't construct spanning tree\>\"", "]"}], 
         "]"}]}], "]"}], ";", "\n", "\n", 
      RowBox[{"paths", " ", "=", " ", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"<|", 
           RowBox[{
            RowBox[{"\"\<Start\>\"", "->", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ",", 
            RowBox[{"\"\<End\>\"", "->", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], "|>"}], " ", "&"}], ",", 
         RowBox[{"Partition", "[", 
          RowBox[{"endPoints", ",", "2", ",", "1"}], "]"}]}], "]"}]}], ";", 
      RowBox[{"paths", " ", "=", " ", 
       RowBox[{"Map", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Append", "[", 
           RowBox[{"#", ",", 
            RowBox[{"\"\<Path\>\"", "->", " ", 
             RowBox[{"First", "@", 
              RowBox[{"FindPath", "[", 
               RowBox[{"g", ",", 
                RowBox[{"#", "[", "\"\<Start\>\"", "]"}], ",", 
                RowBox[{"#", "[", "\"\<End\>\"", "]"}]}], "]"}]}]}]}], "]"}], 
          "&"}], ",", "paths"}], "]"}]}], ";", 
      RowBox[{"paths", " ", "=", " ", 
       RowBox[{"Map", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Append", "[", 
           RowBox[{"#", ",", 
            RowBox[{"\"\<PathLength\>\"", "->", " ", 
             RowBox[{"Length", "@", 
              RowBox[{"#", "[", "\"\<Path\>\"", "]"}]}]}]}], "]"}], "&"}], 
         ",", "paths"}], "]"}]}], ";", "\n", "paths"}]}], "\n", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[69]:=",ExpressionUUID->"752f904d-5e31-44ab-914d-ea0b8146f2f7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"topologicalSortByLongestPaths", "[", "g_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"reducedGraph", ",", "path"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{
        RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
        RowBox[{"If", "[", 
         RowBox[{"False", ",", 
          RowBox[{"Echo", "[", 
           RowBox[{"x", ",", "\"\<fLPs\>\""}], "]"}], ",", "x"}], "]"}]}], 
       ";", "\n", 
       RowBox[{"path", " ", "=", " ", 
        RowBox[{"findLongestPath", "[", "g", "]"}]}], ";", "\n", 
       RowBox[{"reducedGraph", " ", "=", " ", 
        RowBox[{"ConnectedGraphComponents", "@", 
         RowBox[{"VertexDelete", "[", 
          RowBox[{"g", ",", "path"}], "]"}]}]}], ";", "\n", 
       RowBox[{"leftoverPaths", " ", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{"findLongestPath", ",", "reducedGraph"}], "]"}]}], ";", "\n", 
       RowBox[{"(*", " ", 
        RowBox[{
        "if", " ", "that", " ", "reduced", " ", "tree", " ", "still", " ", 
         "has", " ", "branches", " ", "we", " ", "wil", " ", "lose", " ", 
         "them"}], " ", "*)"}], "\n", 
       RowBox[{"Join", "[", 
        RowBox[{"path", ",", 
         RowBox[{"Join", "@@", "leftoverPaths"}]}], "]"}]}]}], "\n", "]"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"findSpanningPath", "[", 
    RowBox[{"meshAssociation_", ",", "undirectedGraph_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"acyclic", ",", "endPoints", ",", "path", ",", "decho"}], "}"}],
      ",", "\n", 
     RowBox[{"(*", " ", "fixable", " ", "*)"}], " ", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{"False", ",", 
         RowBox[{"Echo", "[", 
          RowBox[{"x", ",", "\"\<fSPd\>\""}], "]"}]}], "]"}]}], ";", "\n", 
      RowBox[{"acyclic", " ", "=", " ", 
       RowBox[{"removeCyclicPoints", "[", "undirectedGraph", "]"}]}], ";", 
      "\n", "\n", 
      RowBox[{"endPoints", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"VertexList", "[", "acyclic", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"vertexEdgeCount", "[", 
            RowBox[{"acyclic", ",", "#"}], "]"}], "==", "1"}], "&"}]}], 
        "]"}]}], ";", "\n", 
      RowBox[{"endPoints", " ", "=", " ", 
       RowBox[{"SortBy", "[", 
        RowBox[{"endPoints", ",", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"graphPointRadius", "[", 
            RowBox[{"meshAssociation", ",", "#"}], "]"}]}], "&"}]}], "]"}]}], 
      ";", "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endPoints", "]"}], "<", "1"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"Missing", "[", "\"\<Missing path ends\>\"", "]"}], "]"}]}], 
       "]"}], ";", "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endPoints", "]"}], "==", "1"}], ",", "\n", 
        RowBox[{
         RowBox[{"decho", "[", 
          RowBox[{"{", 
           RowBox[{"\"\<No spanning tree for \>\"", ",", "acyclic"}], "}"}], 
          "]"}], ";", "\n", 
         RowBox[{"Return", "[", 
          RowBox[{
          "Missing", "[", "\"\<Couldn't construct spanning tree\>\"", "]"}], 
          "]"}]}]}], "]"}], ";", "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endPoints", "]"}], ">", "2"}], ",", 
        RowBox[{"endPoints", "=", 
         RowBox[{"Take", "[", 
          RowBox[{"endPoints", ",", "2"}], "]"}]}]}], "]"}], ";", "\n", "\n", 
      RowBox[{"path", " ", "=", " ", 
       RowBox[{"FindPath", "[", 
        RowBox[{"acyclic", ",", 
         RowBox[{"First", "[", "endPoints", "]"}], ",", 
         RowBox[{"Last", "[", "endPoints", "]"}]}], "]"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "path", "]"}], "==", "0"}], ",", "\n", 
        RowBox[{"path", " ", "=", " ", 
         RowBox[{"FindPath", "[", 
          RowBox[{"acyclic", ",", 
           RowBox[{"Last", "[", "endPoints", "]"}], ",", 
           RowBox[{"First", "[", "endPoints", "]"}]}], "]"}]}]}], "\n", "]"}],
       ";", "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "path", "]"}], "==", "0"}], ",", "\n", 
        RowBox[{"Return", "[", 
         RowBox[{"Missing", "[", "\"\<No spanning path\>\"", "]"}], "]"}]}], 
       "]"}], ";", "\n", 
      RowBox[{"Clear", "[", "decho", "]"}], ";", "\n", 
      RowBox[{"path", " ", "=", " ", 
       RowBox[{"First", "@", "path"}]}], ";", "\n", "path"}]}], "\n", "]"}]}],
   ";"}]}], "Code",
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[70]:=",ExpressionUUID->"e9b0a34e-a121-475f-a643-57550abc01f4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeDirectedParastichy", "[", 
    RowBox[{"meshAssociation_", ",", "parastichy_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"edgeList", ",", "path"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"edgeList", " ", "=", " ", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"List", ",", 
            RowBox[{"{", "#", "}"}], ",", 
            RowBox[{"Intersection", "[", 
             RowBox[{"parastichy", ",", 
              RowBox[{
               RowBox[{"adjacencyFunction", "[", "meshAssociation", "]"}], 
               "[", "#", "]"}]}], "]"}]}], "}"}], "&"}], ",", "parastichy"}], 
        "]"}]}], ";", "\n", 
      RowBox[{"edgeList", " ", "=", " ", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Sort", " ", "/@", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Apply", "[", 
               RowBox[{"Outer", ",", "#"}], "]"}], "&"}], ",", "edgeList"}], 
            "]"}], ",", "2"}], "]"}]}], "]"}]}], ";", "\n", 
      RowBox[{"edgeList", " ", "=", " ", 
       RowBox[{"Map", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], " ", "\[UndirectedEdge]", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], " ", "&"}], ",", " ", 
         "edgeList"}], "]"}]}], ";", "\n", 
      RowBox[{"path", "  ", "=", " ", 
       RowBox[{"findSpanningPath", "[", 
        RowBox[{"meshAssociation", ",", " ", 
         RowBox[{"Graph", "[", "edgeList", "]"}]}], "]"}]}], ";", "\n", 
      "path"}]}], "\n", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[72]:=",ExpressionUUID->"70bf3f1a-54dc-4bc3-9028-1c5fb201242e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeDirectedPath", "[", 
     RowBox[{"meshAssociation_", ",", "component_"}], "]"}], " ", ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"path", ",", "acyclic", ",", "res"}], "}"}], ",", "\n", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "given", " ", "an", " ", "undirected", " ", "graph", " ", "which", 
         " ", "is", " ", "mainly", " ", "a", " ", "single", " ", "path"}], 
        " ", ",", " ", 
        RowBox[{
        "return", " ", "the", " ", "directed", " ", "graph", " ", "with", " ",
          "outer", " ", "point", " ", "at", " ", "head"}]}], " ", "*)"}], 
      RowBox[{
       RowBox[{"acyclic", " ", "=", " ", 
        RowBox[{"removeCyclicPoints", "[", "component", "]"}]}], ";", 
       RowBox[{"path", " ", "=", " ", 
        RowBox[{"findSpanningPath", "[", 
         RowBox[{"meshAssociation", ",", "acyclic"}], "]"}]}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MissingQ", "[", "path", "]"}], ",", 
         RowBox[{"Return", "[", "path", "]"}]}], "]"}], ";", 
       RowBox[{"path", " ", "=", " ", 
        RowBox[{"Partition", "[", 
         RowBox[{"path", ",", "2", ",", "1"}], "]"}]}], ";", 
       RowBox[{"res", "=", " ", 
        RowBox[{"EdgeDelete", "[", 
         RowBox[{"acyclic", ",", 
          RowBox[{"EdgeList", "[", "acyclic", "]"}]}], "]"}]}], ";", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"EdgeAdd", "[", 
         RowBox[{"res", ",", 
          RowBox[{"DirectedEdge", " ", "@@@", " ", "path"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "res"}]}], "\n", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"directedPathHead", "[", "component_", "]"}], " ", ":=", "  ", 
   RowBox[{"First", "@", 
    RowBox[{"TopologicalSort", "[", "component", "]"}]}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[73]:=",ExpressionUUID->"3f1b1063-c893-4c9a-abf7-831c9e8274e1"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"graphPointRadius", "[", 
      RowBox[{"meshAssociation_Association", ",", "ix_"}], "]"}], " ", ":=", 
     "  ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"c", ",", "p"}], "}"}], ",", "\n", 
       RowBox[{
        RowBox[{"c", " ", "=", " ", 
         RowBox[{"meshAssociation", "[", "\"\<Centroid\>\"", "]"}]}], ";", 
        "\n", 
        RowBox[{"p", " ", "=", " ", 
         RowBox[{"graphCoordinates", "[", 
          RowBox[{
           RowBox[{"meshAssociation", "[", "\"\<Graph\>\"", "]"}], ",", 
           "ix"}], "]"}]}], ";", "\n", 
        RowBox[{"Norm", "[", 
         RowBox[{"(", 
          RowBox[{"c", "-", "p"}], ")"}], "]"}]}]}], "\n", "]"}]}], ";"}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"vertexAngle", "[", 
      RowBox[{"meshAssociation_", ",", "component_", ",", "vertex_"}], "]"}], 
     " ", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"incidence", ",", "inPair", ",", "outPair", ",", "ix123"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"incidence", " ", "=", " ", 
         RowBox[{"IncidenceList", "[", 
          RowBox[{"component", ",", "vertex"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "incidence", "]"}], "==", "0"}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"Missing", "[", "\"\<Can't find incidence\>\"", "]"}], 
           "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "incidence", "]"}], "==", "1"}], ",", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "incidence", "]"}], " ", ">", " ", "2"}], 
          ",", 
          RowBox[{"Return", "[", 
           RowBox[{"Missing", "[", "\"\<Too many incidences\>\"", "]"}], 
           "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"inPair", " ", "=", " ", 
         RowBox[{"First", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"incidence", ",", " ", 
            RowBox[{"_", " ", "\[DirectedEdge]", " ", "vertex"}]}], "]"}]}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"outPair", " ", "=", " ", 
         RowBox[{"First", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"incidence", ",", " ", 
            RowBox[{"vertex", " ", "\[DirectedEdge]", " ", "_"}]}], "]"}]}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"ix123", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"First", "[", "inPair", "]"}], ",", 
           RowBox[{"First", "[", "outPair", "]"}], ",", 
           RowBox[{"Last", "[", "outPair", "]"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"graphLineDeviation", "[", 
         RowBox[{"meshAssociation", ",", "ix123"}], "]"}]}]}], "\n", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"vertexAngleUndirected", "[", 
      RowBox[{"meshAssociation_", ",", "component_", ",", "vertex_"}], "]"}], 
     " ", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pairList", ",", "ix123"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pairList", " ", "=", " ", 
         RowBox[{"AdjacencyList", "[", 
          RowBox[{"component", ",", "vertex"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pairList", "]"}], "==", "0"}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"Missing", "[", "\"\<Can't find incidence\>\"", "]"}], 
           "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pairList", "]"}], "==", "1"}], ",", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pairList", "]"}], " ", ">", " ", "2"}], 
          ",", 
          RowBox[{"Return", "[", 
           RowBox[{"Missing", "[", "\"\<Too many incidences\>\"", "]"}], 
           "]"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"ix123", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
           "pairList", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
            ",", "vertex", ",", 
           RowBox[{
           "pairList", "\[LeftDoubleBracket]", "2", 
            "\[RightDoubleBracket]"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"graphLineDeviation", "[", 
         RowBox[{"meshAssociation", ",", "ix123"}], "]"}]}]}], "\n", "]"}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[75]:=",ExpressionUUID->"23e910ed-a1dc-4ea0-ae8e-0daf1b70bad7"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"splitAtKinks2", "[", 
      RowBox[{"meshAssociation_", ",", "component_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "vertices", ",", "angleAtVertex", ",", "angles", ",", "res", ",", 
         "kinks", ",", "edgesToDrop"}], "}"}], ",", "\n", 
       RowBox[{"(*", " ", 
        RowBox[{
        "component", " ", "is", " ", "an", " ", "undirected", " ", "path"}], 
        "  ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"VertexCount", "[", "component", "]"}], "\[LessEqual]", 
           " ", "2"}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"Nothing", "[", "]"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"vertices", " ", "=", " ", 
         RowBox[{"VertexList", "[", "component", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"angleAtVertex", " ", "=", " ", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"vertexAngleUndirected", "[", 
             RowBox[{"meshAssociation", ",", "component", ",", "#"}], "]"}], 
            "&"}], ",", "vertices"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"angles", " ", "=", " ", 
         RowBox[{"AssociationThread", "[", 
          RowBox[{"vertices", ",", "angleAtVertex"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"kinks", " ", "=", " ", 
         RowBox[{"Keys", "@", 
          RowBox[{"Select", "[", 
           RowBox[{"angles", ",", "\n", "\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "#", "]"}], " ", ">", 
              RowBox[{
              "locateParastichyOptions", "[", 
               "\"\<StraightnessWhenAdjacent\>\"", "]"}]}], "&"}]}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"res", " ", "=", " ", "component"}], ";", 
        RowBox[{"res", " ", "=", " ", 
         RowBox[{"VertexDelete", "[", 
          RowBox[{"res", ",", "kinks"}], "]"}]}], ";", 
        RowBox[{"res", "  ", "=", 
         RowBox[{"ConnectedGraphComponents", "[", "res", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"res", " ", "=", " ", 
         RowBox[{"Select", "[", 
          RowBox[{"res", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"VertexCount", "[", "#", "]"}], ">", "  ", 
             RowBox[{
             "locateParastichyOptions", "[", "\"\<MinimumThreadLength\>\"", 
              "]"}]}], "&"}]}], "]"}]}], ";", 
        RowBox[{"Return", "[", "res", "]"}], ";"}]}], "\n", "\n", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"splitAtSplits", "[", 
      RowBox[{"meshAssociation_", ",", "component_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "vertices", ",", "angleAtVertex", ",", "angles", ",", "res", ",", 
         "kinks", ",", "edgesToDrop"}], "}"}], ",", "\n", 
       RowBox[{"(*", " ", 
        RowBox[{
        "component", " ", "is", " ", "an", " ", "undirected", " ", "path"}], 
        "  ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"VertexCount", "[", "component", "]"}], "\[LessEqual]", 
           " ", "2"}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"Nothing", "[", "]"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"vertices", " ", "=", " ", 
         RowBox[{"VertexList", "[", "component", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"vertexEdgeCounts", " ", "=", " ", 
         RowBox[{"Association", "@", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "->", 
              RowBox[{"vertexEdgeCount", "[", 
               RowBox[{"component", ",", "#"}], "]"}]}], "&"}], ",", 
            RowBox[{"VertexList", "[", "component", "]"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"kinks", " ", "=", " ", 
         RowBox[{"Keys", "@", 
          RowBox[{"Select", "[", 
           RowBox[{"vertexEdgeCounts", ",", 
            RowBox[{
             RowBox[{"#", " ", ">", " ", "2"}], "&"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"res", " ", "=", " ", "component"}], ";", 
        RowBox[{"res", " ", "=", " ", 
         RowBox[{"VertexDelete", "[", 
          RowBox[{"res", ",", "kinks"}], "]"}]}], ";", 
        RowBox[{"res", "  ", "=", 
         RowBox[{"ConnectedGraphComponents", "[", "res", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"res", " ", "=", " ", 
         RowBox[{"Select", "[", 
          RowBox[{"res", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"VertexCount", "[", "#", "]"}], ">", "  ", 
             RowBox[{
             "locateParastichyOptions", "[", "\"\<MinimumThreadLength\>\"", 
              "]"}]}], "&"}]}], "]"}]}], ";", 
        RowBox[{"Return", "[", "res", "]"}], ";"}]}], "\n", "\n", "]"}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"bec8a550-880d-4270-b994-1ee9f1cc4e8b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"eDeleteEdge", "[", 
     RowBox[{"g_Graph", ",", "edge_"}], "]"}], " ", ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"EdgeQ", "[", 
       RowBox[{"g", ",", "edge"}], "]"}], ",", 
      RowBox[{"EdgeDelete", "[", 
       RowBox[{"g", ",", "edge"}], "]"}], ",", "g"}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"eDelete", "[", 
     RowBox[{"comp_", ",", "edges_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"g", ",", "i"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"g", "=", "comp"}], ";", "\n", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "<=", " ", 
          RowBox[{"Length", "[", "edges", "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\n", 
         RowBox[{"g", " ", "=", " ", 
          RowBox[{"eDeleteEdge", "[", 
           RowBox[{"g", ",", 
            RowBox[{"edges", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}]}], "\n", "]"}], ";", 
       "\n", "g"}]}], "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"connectedDirectedGraphComponents", "[", "g_", "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"edges", ",", "flip", ",", "res"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"edges", " ", "=", " ", 
       RowBox[{"EdgeList", "[", "g", "]"}]}], ";", "\n", 
      RowBox[{
       RowBox[{"flip", "[", " ", 
        RowBox[{"a_", " ", "\[DirectedEdge]", " ", "b_"}], " ", "]"}], " ", ":=",
        " ", 
       RowBox[{"b", " ", "\[DirectedEdge]", " ", "a"}]}], ";", "\n", 
      RowBox[{"edges", " ", "=", " ", 
       RowBox[{"Map", "[", 
        RowBox[{"flip", ",", "edges"}], "]"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MissingQ", "[", "edges", "]"}], ",", 
        RowBox[{"Echo", "[", 
         RowBox[{"\"\< Missing edges \>\"", ",", " ", 
          RowBox[{"Stack", "[", "]"}]}], "]"}]}], "]"}], ";", "\n", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"EdgeAdd", "[", 
        RowBox[{"g", ",", "edges"}], "]"}]}], ";", "\n", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"eDelete", "[", 
          RowBox[{"#", ",", "edges"}], "]"}], "&"}], ",", "\n", 
        RowBox[{"ConnectedGraphComponents", "[", "res", "]"}]}], "]"}]}]}], 
    "\n", "]"}]}], ";"}]}], "Code",
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[81]:=",ExpressionUUID->"84d878d6-dd33-4fb8-a10a-037275e2a40e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"polygonsAtVertex", "[", 
     RowBox[{"g_", ",", "v_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "edges", "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"edges", " ", "=", " ", 
        RowBox[{"EdgeList", "@", 
         RowBox[{"NeighborhoodGraph", "[", 
          RowBox[{"g", ",", "v"}], "]"}]}]}], ";", "\n", 
       RowBox[{"edges", " ", "=", " ", 
        RowBox[{"Cases", "[", 
         RowBox[{"edges", ",", 
          RowBox[{"Except", "[", " ", 
           RowBox[{
            RowBox[{"_", " ", "\[UndirectedEdge]", " ", "v"}], " ", "|", " ", 
            RowBox[{"v", " ", "\[UndirectedEdge]", " ", "_"}]}], "]"}]}], 
         "]"}]}], ";", "\n", 
       RowBox[{"edges", "  ", "=", " ", 
        RowBox[{"Apply", "[", 
         RowBox[{"List", ",", "edges", ",", "1"}], "]"}]}], ";", "\n", 
       RowBox[{"edges", " ", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Polygon", "@", 
            RowBox[{"Append", "[", 
             RowBox[{"#", ",", "v"}], "]"}]}], "&"}], ",", "edges"}], "]"}]}],
        ";", "\n", "edges"}]}], " ", "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"graphToMesh", "[", "g_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"meshPoints", ",", "meshPolygons", ",", "mesh"}], "}"}], ",", 
      "\n", 
      RowBox[{
       RowBox[{"meshPoints", " ", "=", " ", 
        RowBox[{"AnnotationValue", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"g", ",", 
            RowBox[{"VertexList", "[", "g", "]"}]}], "}"}], ",", 
          "VertexCoordinates"}], "]"}]}], ";", "\n", 
       RowBox[{"meshPolygons", " ", "=", " ", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"polygonsAtVertex", "[", 
             RowBox[{"g", ",", "#"}], "]"}], "&"}], ",", 
           RowBox[{"VertexList", "[", "g", "]"}]}], "]"}]}]}], ";", "\n", 
       RowBox[{"mesh", " ", "=", " ", 
        RowBox[{"MeshRegion", "[", 
         RowBox[{"meshPoints", ",", "meshPolygons"}], "]"}]}], ";", "\n", 
       RowBox[{"{", 
        RowBox[{"meshPoints", ",", "meshPolygons"}], "}"}]}]}], "\n", "]"}]}],
    ";"}], "\n", "\n"}], "\n"}], "Code",
 CellLabel->
  "2/16/21 16:14:26 (Local) \
In[84]:=",ExpressionUUID->"7d934c07-76a0-4a5f-9037-ee7523bc7b4d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"graphVCA", "[", "g_", "]"}], " ", ":=", " ", 
   RowBox[{"AssociationThread", "[", 
    RowBox[{
     RowBox[{"VertexList", "[", "g", "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"AnnotationValue", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"g", ",", 
         RowBox[{"VertexList", "[", "g", "]"}]}], "}"}], ",", 
       "VertexCoordinates"}], "]"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/17/21 10:56:02 (Local) \
In[260]:=",ExpressionUUID->"afaffb66-151b-47d7-bc2a-d75855c28589"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"graphJoin", "[", "gList_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"vcas", ",", "g", ",", "vc"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vcas", " ", "=", " ", 
        RowBox[{"Union", "@@", 
         RowBox[{"Map", "[", 
          RowBox[{"graphVCA", ",", "gList"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"g", " ", "=", " ", 
        RowBox[{"GraphUnion", " ", "@@", "gList"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vc", " ", "=", 
        RowBox[{"Map", "[", 
         RowBox[{"vcas", ",", " ", 
          RowBox[{"VertexList", "[", "g", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"g", " ", "=", " ", 
        RowBox[{"Graph", "[", 
         RowBox[{"g", ",", 
          RowBox[{"VertexCoordinates", "\[Rule]", "vc"}]}], "]"}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"graphToParastichyFamily", "[", 
    RowBox[{"meshAssociation_", ",", "g_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"gList", ",", "paths"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vList", " ", "=", " ", 
       RowBox[{"Map", "[", 
        RowBox[{"VertexList", ",", " ", 
         RowBox[{"ConnectedGraphComponents", "[", "g", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"vList", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{"vList", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "#", "]"}], ">", "1"}], "&"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"paths", " ", "=", " ", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"makeDirectedParastichy", "[", 
           RowBox[{"meshAssociation", ",", "#"}], "]"}], "&"}], ",", 
         "vList"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"aPF", "[", 
        RowBox[{"mPF_", ",", "path_"}], "]"}], " ", ":=", " ", 
       RowBox[{"addToParastichyFamily", "[", 
        RowBox[{"mPF", ",", "path", ",", "3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Fold", "[", " ", 
       RowBox[{"aPF", ",", 
        RowBox[{"{", "}"}], ",", "paths"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellLabel->
  "2/17/21 11:34:34 (Local) \
In[360]:=",ExpressionUUID->"0de7f3f9-0cb0-400d-a741-e8b35a9f5a51"]
}, Open  ]]
},
WindowSize->{718.5, 831.},
WindowMargins->{{Automatic, -2.099999999999909}, {Automatic, 0}},
WindowStatusArea->"",
TaggingRules->{
 "WelcomeScreenSettings" -> {"FEStarting" -> False}, 
  "CodeFormatter" -> {
   "ToolbarState" -> True, "ToolbarAccentColor" -> 
    RGBColor[0.1411764705882353, 0.592156862745098, 0.7176470588235294]}},
FrontEndVersion->"12.2 for Microsoft Windows (64-bit) (December 12, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"e85e8579-a274-4676-96a5-47167c9968b5"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 1531, 40, 331, "Code",ExpressionUUID->"c6c4cce2-bc28-4439-ae0d-6afb0daf69fe"],
Cell[2092, 62, 6905, 155, 866, "Code",ExpressionUUID->"545f80d8-56e3-47b6-8060-3a2155b76023"],
Cell[9000, 219, 205, 5, 63, "Code",ExpressionUUID->"5cb0906a-7fd6-41ca-bd93-01a456c28bc8"],
Cell[9208, 226, 389, 11, 63, "Code",ExpressionUUID->"266cd5b1-2123-4b41-8621-e7480adb92fc"],
Cell[CellGroupData[{
Cell[9622, 241, 102, 0, 55, "Subsection",ExpressionUUID->"f0d4dbc7-8000-477d-a6d2-41c86a995399"],
Cell[9727, 243, 15954, 436, 1877, "Input",ExpressionUUID->"7d3ee17a-750e-48b8-9523-9ce516590beb",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[25718, 684, 98, 0, 55, "Subsection",ExpressionUUID->"217b4cfc-7091-426b-b4ac-8966b4ce8f0c"],
Cell[25819, 686, 1423, 41, 245, "Input",ExpressionUUID->"37db2415-c424-4b7f-be64-7d290b7571fa",
 InitializationCell->True],
Cell[27245, 729, 2403, 59, 320, "Input",ExpressionUUID->"d3f2d60d-4435-48a4-be52-8b86c3b6f85d",
 InitializationCell->True],
Cell[29651, 790, 7676, 184, 982, "Input",ExpressionUUID->"d27eb31f-9685-4b44-b6ca-9d98105f73e6",
 InitializationCell->True],
Cell[37330, 976, 4452, 105, 658, "Input",ExpressionUUID->"6f079890-0c30-49f9-a923-bceb2e315ea5",
 InitializationCell->True],
Cell[41785, 1083, 3434, 82, 414, "Input",ExpressionUUID->"756f00cc-3755-454d-a208-247637ce9458",
 InitializationCell->True],
Cell[45222, 1167, 2506, 63, 320, "Input",ExpressionUUID->"1d014996-9baf-42c8-a2cc-89ac1bc48b8e",
 InitializationCell->True],
Cell[47731, 1232, 2325, 55, 358, "Input",ExpressionUUID->"aa52782f-2f77-4f6d-b567-77af59b4375b",
 InitializationCell->True],
Cell[50059, 1289, 936, 28, 135, "Code",ExpressionUUID->"dbb63815-f69a-4a96-bfec-9b2f1f193c64"],
Cell[50998, 1319, 1909, 52, 224, "Code",ExpressionUUID->"c85247cb-971b-4af8-acc6-d28716b5ddbf"],
Cell[52910, 1373, 5293, 143, 695, "Input",ExpressionUUID->"8d91e29a-16bb-4df2-99a4-fcf8eb6bdae2",
 InitializationCell->True],
Cell[58206, 1518, 3286, 81, 489, "Input",ExpressionUUID->"e051c6ea-9b7a-4344-afed-0ec63275c8f0",
 InitializationCell->True],
Cell[61495, 1601, 14602, 340, 1558, "Input",ExpressionUUID->"76ea223f-8c2c-4947-9ea8-ff05b8f82dd0",
 InitializationCell->True],
Cell[76100, 1943, 2975, 82, 320, "Input",ExpressionUUID->"504ad3de-5291-4d89-8927-7f0ac3e8f56c",
 InitializationCell->True],
Cell[79078, 2027, 661, 17, 133, "Input",ExpressionUUID->"ecc020ae-fd64-4da8-8c04-0acd6e012dfe",
 InitializationCell->True],
Cell[79742, 2046, 2575, 60, 339, "Input",ExpressionUUID->"66768435-00b5-4a9d-92b3-461e76c140f5",
 InitializationCell->True],
Cell[82320, 2108, 1809, 43, 283, "Input",ExpressionUUID->"322c5088-f8d9-44cb-b112-dc5e4d3df686",
 InitializationCell->True],
Cell[84132, 2153, 3190, 87, 367, "Code",ExpressionUUID->"be645f4a-1ec5-42a2-a97d-351d1dab3f71"],
Cell[87325, 2242, 10015, 238, 1389, "Input",ExpressionUUID->"c1ab1a61-6202-4858-9b27-ab224e963ebe",
 InitializationCell->True],
Cell[97343, 2482, 2413, 59, 470, "Input",ExpressionUUID->"bd123bb0-00cd-4325-b748-3131e98f621a",
 InitializationCell->True],
Cell[99759, 2543, 1584, 42, 189, "Input",ExpressionUUID->"82855400-5408-449f-af68-370bf0c13ed9",
 InitializationCell->True],
Cell[101346, 2587, 1332, 35, 171, "Code",ExpressionUUID->"3707e896-ac90-41c5-bd63-2e31683bd266"],
Cell[102681, 2624, 2850, 76, 245, "Input",ExpressionUUID->"752f904d-5e31-44ab-914d-ea0b8146f2f7",
 InitializationCell->True],
Cell[105534, 2702, 5015, 128, 687, "Code",ExpressionUUID->"e9b0a34e-a121-475f-a643-57550abc01f4"],
Cell[110552, 2832, 1969, 52, 227, "Input",ExpressionUUID->"70bf3f1a-54dc-4bc3-9028-1c5fb201242e",
 InitializationCell->True],
Cell[112524, 2886, 2059, 50, 283, "Input",ExpressionUUID->"3f1b1063-c893-4c9a-abf7-831c9e8274e1",
 InitializationCell->True],
Cell[114586, 2938, 5284, 134, 620, "Input",ExpressionUUID->"23e910ed-a1dc-4ea0-ae8e-0daf1b70bad7",
 InitializationCell->True],
Cell[119873, 3074, 5620, 131, 870, "Input",ExpressionUUID->"bec8a550-880d-4270-b994-1ee9f1cc4e8b",
 InitializationCell->True],
Cell[125496, 3207, 2620, 73, 385, "Code",ExpressionUUID->"84d878d6-dd33-4fb8-a10a-037275e2a40e"],
Cell[128119, 3282, 2511, 66, 350, "Code",ExpressionUUID->"7d934c07-76a0-4a5f-9037-ee7523bc7b4d"],
Cell[130633, 3350, 582, 16, 77, "Input",ExpressionUUID->"afaffb66-151b-47d7-bc2a-d75855c28589",
 InitializationCell->True],
Cell[131218, 3368, 2693, 72, 369, "Input",ExpressionUUID->"0de7f3f9-0cb0-400d-a741-e8b35a9f5a51",
 InitializationCell->True]
}, Open  ]]
}
]
*)

