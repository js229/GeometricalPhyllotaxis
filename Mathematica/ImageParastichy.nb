(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    114331,       2953]
NotebookOptionsPosition[    110348,       2886]
NotebookOutlinePosition[    110996,       2908]
CellTagsIndexPosition[    110953,       2905]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"makePackage", " ", "=", " ", "False"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{"makePackage", ",", "\n", "    ", 
     RowBox[{
      RowBox[{"BeginPackage", "[", "\"\<ImageParastichy`\>\"", "]"}], ";", 
      "\n", "    ", 
      RowBox[{
       RowBox[{"locateParastichyOptions", "::", "usage"}], " ", "=", " ", 
       "\"\<Global options for heuristics\>\""}], ";", "\n", "    ", 
      RowBox[{
       RowBox[{"makeTidyMesh", "::", "usage"}], " ", "=", " ", 
       "\"\<Delete duplicate points and remove over-large cells\>\""}], ";", 
      "\n", "    ", 
      RowBox[{
       RowBox[{"meshExtendParastichy", "::", "usage"}], " ", "=", " ", 
       "\"\<Extend a line without large kinks\>\""}]}]}], "\n", "]"}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{"makePackage", ",", "\n", "    ", 
     RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]}], "\n", "]"}], ";"}], 
  "\n", "  "}], "\n", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Options", "[", 
     RowBox[{
      RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
      RowBox[{"AutoGeneratedPackage", "\[Rule]", "Automatic"}]}], "]"}], 
    ";"}], "\n", "*)"}]}]}], "Code",ExpressionUUID->"c6c4cce2-bc28-4439-ae0d-\
6afb0daf69fe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"resetOptions", " ", ":=", " ", 
    RowBox[{"locateParastichyOptions", " ", "=", " ", 
     RowBox[{"<|", "\n", 
      RowBox[{
       RowBox[{"\"\<Renumber\>\"", "->", " ", "True"}], ",", "\n", 
       RowBox[{"\"\<DuplicateNearness\>\"", " ", "->", "5.1"}], ",", "\n", 
       RowBox[{"\"\<LargePolygonLength\>\"", " ", "->", "42"}], ",", "\n", 
       RowBox[{"\"\<InitialPeel\>\"", " ", "->", " ", "0"}], ",", "\n", 
       RowBox[{"\"\<StraightnessWhenAdjacent\>\"", " ", "->", "25"}], ",", 
       "\n", 
       RowBox[{"\"\<StraightnessWhenUnadjacent\>\"", "->", " ", "30"}], ",", 
       "\n", 
       RowBox[{"\"\<InitialParastichyLength\>\"", "->", "  ", "10"}], ",", 
       "\n", 
       RowBox[{"\"\<ParastichyExtensionLength\>\"", "->", "  ", "10"}], ",", 
       " ", 
       RowBox[{"(*", " ", 
        RowBox[{"each", " ", "way"}], " ", "*)"}], "\n", 
       RowBox[{"\"\<MinimumThreadLength\>\"", "->", " ", "3"}], ",", "\n", 
       RowBox[{"\"\<FamilyGrowthSize\>\"", " ", "->", " ", "90"}]}], "\n", 
      "|>"}]}]}], ";"}], " "}], "\n", 
 RowBox[{
  RowBox[{"resetOptions", ";"}], "\n", "\n", "\t"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeTidyMesh", "[", "seedCentres_", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "dMeshRaw", ",", " ", "lineLength", ",", " ", "lengths", ",", " ", 
        "pointsToDrop", ",", " ", "x", ",", " ", "meshxy", ",", " ", "toDrop",
         ",", " ", "dMesh", ",", " ", "res", ",", " ", "boundary"}], "}"}], 
      ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"dMeshRaw", " ", "=", " ", 
        RowBox[{"DelaunayMesh", "[", "seedCentres", "]"}]}], ";", "\n", "\t", 
       "\n", "\t", 
       RowBox[{"lengths", " ", "=", " ", 
        RowBox[{"AssociationThread", "[", 
         RowBox[{
          RowBox[{"MeshCells", "[", 
           RowBox[{"dMeshRaw", ",", " ", "1"}], "]"}], ",", " ", 
          RowBox[{"Map", "[", 
           RowBox[{"meshLineLength", ",", " ", 
            RowBox[{"MeshPrimitives", "[", 
             RowBox[{"dMeshRaw", ",", " ", "1"}], "]"}]}], "]"}]}], "]"}]}], 
       ";", "\n", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{
        "find", " ", "the", " ", "short", " ", "line", " ", "pairs", " ", 
         "and", " ", "take", " ", "the", " ", "first", " ", "cell", " ", 
         "index"}], " ", "*)"}], " ", "\n", "\t", 
       RowBox[{"pointsToDrop", " ", "=", "\n", "\t", 
        RowBox[{"(", "\n", "\t", 
         RowBox[{
          RowBox[{"Keys", " ", "@", " ", 
           RowBox[{"Select", "[", 
            RowBox[{"lengths", ",", " ", 
             RowBox[{
              RowBox[{"#", " ", "<", " ", 
               RowBox[{
               "locateParastichyOptions", "[", "\"\<DuplicateNearness\>\"", 
                "]"}]}], "&"}]}], "]"}]}], " ", "/.", " ", 
          RowBox[{
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{"x_", ",", " ", "y_"}], "}"}], "]"}], " ", "->", " ", 
           "x"}]}], "\n", "\t", ")"}]}], ";", "\n", "\t", 
       RowBox[{"toDrop", " ", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"First", " ", "@", " ", 
            RowBox[{"Position", "[", 
             RowBox[{"seedCentres", ",", " ", 
              RowBox[{"meshCoordinates", "[", 
               RowBox[{"dMeshRaw", ",", "#"}], "]"}]}], "]"}]}], "&"}], ",", 
          " ", "pointsToDrop"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{
        "should", " ", "be", " ", "in", " ", "point", " ", "order", " ", 
         "anyway"}], " ", "*)"}], "\n", "\t", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Dropping \>\"", ",", " ", 
         RowBox[{"Length", "[", "toDrop", "]"}], ",", " ", 
         "\"\< points as duplicates\>\""}], "]"}], ";", "\n", "\t", 
       RowBox[{"dMesh", " ", "=", " ", 
        RowBox[{"DelaunayMesh", "[", 
         RowBox[{"Delete", "[", 
          RowBox[{"seedCentres", ",", " ", "toDrop"}], "]"}], "]"}]}], ";", 
       "\n", "\t", 
       RowBox[{"dMesh", " ", "=", " ", 
        RowBox[{"meshDeletePolygons", "[", 
         RowBox[{"dMesh", ",", " ", 
          RowBox[{"meshLongCells", "[", 
           RowBox[{"dMesh", ",", " ", 
            RowBox[{
            "locateParastichyOptions", "[", "\"\<LargePolygonLength\>\"", 
             "]"}]}], "]"}]}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"dMesh", " ", "=", " ", 
        RowBox[{"meshPeel", "[", 
         RowBox[{"dMesh", ",", " ", 
          RowBox[{
          "locateParastichyOptions", "[", "\"\<InitialPeel\>\"", "]"}]}], 
         "]"}]}], ";", "\n", "\t", 
       RowBox[{"boundary", " ", "=", " ", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"ConnectedMeshComponents", " ", "@", " ", 
           RowBox[{"RegionBoundary", "[", "dMesh", "]"}]}], ",", " ", 
          RowBox[{"Length", "[", 
           RowBox[{
            RowBox[{"MeshCells", "[", 
             RowBox[{"#", ",", " ", "0"}], "]"}], "&"}], "]"}]}], "]"}]}], 
       ";", "\n", "\t", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"<|", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"\"\<Mesh\>\"", " ", "->", " ", "dMesh"}], "\n", "\t\t\t", 
          ",", " ", 
          RowBox[{"\"\<InnerBoundary\>\"", " ", "->", " ", 
           RowBox[{"meshCellsOfMesh1InMesh2", "[", 
            RowBox[{
             RowBox[{"boundary", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dMesh"}], "]"}]}], 
          "\n", "\t\t\t", ",", " ", 
          RowBox[{"\"\<OuterBoundary\>\"", " ", "->", " ", 
           RowBox[{"meshCellsOfMesh1InMesh2", "[", 
            RowBox[{
             RowBox[{"boundary", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", " ", "dMesh"}], "]"}]}], 
          "\n", "\t\t\t", ",", " ", 
          RowBox[{"\"\<Adjacency\>\"", " ", "->", " ", 
           RowBox[{"meshAdjacencyAssociation", "[", "dMesh", "]"}]}]}], "\n", 
         "\t\t", "|>"}]}], ";", "\n", "\t\t", "res"}]}], "\n", "\t", "]"}]}], 
   ";"}], "\t"}], "\n"}], "Code",
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[281]:=",ExpressionUUID->"545f80d8-56e3-47b6-8060-3a2155b76023"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"private", " ", "functions"}], " ", "*)"}]], "Code",
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[284]:=",ExpressionUUID->"5cb0906a-7fd6-41ca-bd93-01a456c28bc8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"meshLineLength", "[", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"p1_", ",", " ", "p2_"}], "}"}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"Norm", "[", 
    RowBox[{"p1", " ", "-", " ", "p2"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshCellCellDistance", "[", 
    RowBox[{"mesh_", ",", 
     RowBox[{"{", 
      RowBox[{"ix1_", ",", "ix2_"}], "}"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Norm", "[", 
    RowBox[{
     RowBox[{"meshCoordinates", "[", 
      RowBox[{"mesh", ",", "ix1"}], "]"}], "-", 
     RowBox[{"meshCoordinates", "[", 
      RowBox[{"mesh", ",", "ix2"}], "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshCoordinates", "[", 
    RowBox[{"mesh_MeshRegion", ",", "ix_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "x", "}"}], ",", 
     RowBox[{
      RowBox[{"MeshPrimitives", "[", 
       RowBox[{"mesh", ",", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", " ", "ix"}], "}"}]}], "]"}], " ", "/.", " ", 
      RowBox[{
       RowBox[{"Point", "[", "x_", "]"}], " ", "->", " ", "x"}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"meshCoordinates", "[", 
   RowBox[{"meshAssociation_Association", ",", "ix_"}], "]"}], " ", ":=", " ", 
  RowBox[{"meshCoordinates", "[", 
   RowBox[{
    RowBox[{"meshAssociation", "[", "\"\<Mesh\>\"", "]"}], ",", "ix"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshCoordinates", "[", "mesh_", "]"}], " ", ":=", " ", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "x", "}"}], ",", 
      RowBox[{
       RowBox[{"MeshPrimitives", "[", 
        RowBox[{"mesh", ",", " ", "0"}], "]"}], " ", "/.", " ", 
       RowBox[{
        RowBox[{"Point", "[", "x_", "]"}], " ", "->", " ", "x"}]}]}], "]"}]}],
    ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshDeletePolygons", "[", 
     RowBox[{"mesh_", ",", "deletedpolys_"}], "]"}], " ", ":=", "   ", "\n", 
    "\t", 
    RowBox[{"MeshRegion", "[", 
     RowBox[{
      RowBox[{"meshCoordinates", "[", "mesh", "]"}], ",", 
      RowBox[{"Complement", "[", " ", 
       RowBox[{
        RowBox[{"MeshCells", "[", 
         RowBox[{"mesh", ",", "2"}], "]"}], ",", "deletedpolys"}], "]"}]}], 
     "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshLinesWithLength", "[", "mesh_MeshRegion", "]"}], " ", ":=", 
   " ", 
   RowBox[{"AssociationThread", "[", 
    RowBox[{
     RowBox[{"MeshCells", "[", 
      RowBox[{"mesh", ",", "1"}], "]"}], ",", 
     RowBox[{"Map", "[", 
      RowBox[{"meshLineLength", ",", 
       RowBox[{"MeshPrimitives", "[", 
        RowBox[{"mesh", ",", "1"}], "]"}]}], "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshLinesWithLength", "[", "mesh_Association", "]"}], " ", ":=", 
    " ", 
    RowBox[{"meshLinesWithLength", "[", 
     RowBox[{"mesh", "[", "\"\<Mesh\>\"", "]"}], "]"}]}], ";"}], "\n", "\n", 
  RowBox[{"(*", " ", 
   RowBox[{"for", " ", "tidying", " ", "the", " ", "initial", " ", "mesh"}], 
   " ", "*)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshLongCells", "::", "usage"}], " ", "=", " ", 
   "\"\<Find cells in which one of the sides has length> length \>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshLongCells", "[", 
     RowBox[{"mesh_", ",", "length_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "polys", ",", "x", ",", "lengths", ",", "polyMembers", ",", 
        "longLinePairs", ",", "polyHasLinePair", ",", "polyHasAnyPairs"}], 
       "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"longLinePairs", " ", "=", " ", 
        RowBox[{
         RowBox[{"Keys", "@", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"meshLinesWithLength", "[", "mesh", "]"}], ",", " ", 
            RowBox[{
             RowBox[{"#", " ", ">", " ", "length"}], "&"}]}], "]"}]}], " ", "/.",
          " ", 
         RowBox[{
          RowBox[{"Line", "[", "x_", "]"}], "->", "x"}]}]}], ";", "\n", "\t", 
       RowBox[{"polys", " ", "=", " ", 
        RowBox[{"MeshCells", "[", 
         RowBox[{"mesh", ",", "2"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"polyMembers", "  ", "=", 
        RowBox[{"AssociationThread", "[", 
         RowBox[{"polys", ",", 
          RowBox[{"polys", "/.", " ", 
           RowBox[{
            RowBox[{"Polygon", "[", "x_", "]"}], "->", "x"}]}]}], "]"}]}], 
       ";", "\n", "\t", 
       RowBox[{
        RowBox[{"polyHasLinePair", "[", 
         RowBox[{
          RowBox[{"Polygon", "[", "x_", "]"}], ",", "pair_"}], "]"}], " ", ":=",
         " ", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Intersection", "[", 
           RowBox[{"x", ",", "pair"}], "]"}], "]"}], ">=", " ", "2"}]}], ";", 
       "\n", "\t", 
       RowBox[{
        RowBox[{"polyHasAnyPairs", "[", "p_", "]"}], " ", ":=", 
        RowBox[{"Or", "@@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"polyHasLinePair", "[", 
             RowBox[{"p", ",", "#"}], "]"}], "&"}], ",", "longLinePairs"}], 
          "]"}]}]}], ";", "\n", "\t", 
       RowBox[{"Keys", "@", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"Association", "@", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "->", 
               RowBox[{"polyHasAnyPairs", "[", "#", "]"}]}], "&"}], ",", 
             "polys"}], "]"}]}], ",", 
          RowBox[{"#", "&"}]}], "]"}]}]}]}], "\n", "]"}]}], ";"}], "\n", "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
   "peel", " ", "the", " ", "outer", " ", "boundary", " ", "of", " ", "cells",
     " ", "off", " ", "n", " ", "times"}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshPeel", "[", 
    RowBox[{"mesh_", ",", "n_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "doapeel", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"doapeel", "[", "meshp_", "]"}], " ", ":=", " ", 
       RowBox[{"MeshRegion", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"MeshPrimitives", "[", 
           RowBox[{"meshp", ",", "0"}], "]"}], "/.", " ", 
          RowBox[{
           RowBox[{"Point", "[", "x_", "]"}], "->", "x"}]}], ",", 
         RowBox[{"meshPolygonsNotFormingBoundary", "[", "meshp", "]"}]}], 
        "]"}]}], ";", "\n", "\t", 
      RowBox[{"Nest", "[", 
       RowBox[{"doapeel", ",", "mesh", ",", "n"}], "]"}]}]}], "\n", "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshPolygonsNotFormingBoundary", "[", "mesh_", "]"}], " ", ":=", 
    " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "boundaryNodes", ",", "meshPolygons", ",", "polyFormsBoundary"}], 
       "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"boundaryNodes", " ", "=", " ", 
        RowBox[{"boundaryPointIndexes", "[", "mesh", "]"}]}], ";", "\n", "\t", 
       RowBox[{"meshPolygons", " ", "=", " ", 
        RowBox[{"MeshCells", "[", 
         RowBox[{"mesh", ",", "2"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{
        RowBox[{"polyFormsBoundary", "[", 
         RowBox[{"Polygon", "[", "threeNodeList_", "]"}], "]"}], " ", ":=", 
        " ", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Intersection", "[", 
           RowBox[{"threeNodeList", ",", "boundaryNodes"}], "]"}], "]"}], ">=",
          " ", "2"}]}], ";", "\n", "\t", 
       RowBox[{"Select", "[", 
        RowBox[{"meshPolygons", ",", 
         RowBox[{"Not", " ", "@*", " ", "polyFormsBoundary"}]}], "]"}]}]}], 
     "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"boundaryPointIndexes", "[", "mesh_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"boundaryNodesXY", ",", "meshXY"}], "}"}], ",", "\n", 
      RowBox[{"(*", " ", 
       RowBox[{"replace", " ", "by", " ", 
        RowBox[{"cellsOfMesh1InMesh2", "[", 
         RowBox[{
          RowBox[{"RegionBoundary", "[", "mesh", "]"}], ",", " ", "mesh"}], 
         "]"}], " ", "just", " ", "for", " ", "clarity"}], " ", "*)"}], "\n", 
      "\t", 
      RowBox[{
       RowBox[{"boundaryNodesXY", " ", "=", " ", 
        RowBox[{"MeshPrimitives", "[", 
         RowBox[{
          RowBox[{"RegionBoundary", "[", "mesh", "]"}], ",", "0"}], "]"}]}], 
       ";", "\n", "\t", 
       RowBox[{"meshXY", " ", "=", " ", 
        RowBox[{"MeshPrimitives", "[", 
         RowBox[{"mesh", ",", "0"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"First", "@", 
           RowBox[{"FirstPosition", "[", 
            RowBox[{"meshXY", ",", "#"}], "]"}]}], "&"}], ",", 
         "boundaryNodesXY"}], "]"}]}]}], "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshCellsOfMesh1InMesh2", "[", 
     RowBox[{"mesh1_", ",", " ", "mesh2_"}], "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "pointxy", "}"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"pointxy", " ", "=", " ", 
        RowBox[{"MeshPrimitives", "[", 
         RowBox[{"mesh1", ",", " ", "0"}], "]"}]}], ";", "\n", "\t\t", 
       RowBox[{"Flatten", " ", "@", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"FirstPosition", "[", 
            RowBox[{
             RowBox[{"MeshPrimitives", "[", 
              RowBox[{"mesh2", ",", " ", "0"}], "]"}], ",", " ", "#"}], "]"}],
            "&"}], ",", " ", "pointxy"}], "]"}]}]}]}], "\n", "\t", "]"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshAdjacencyAssociation", "[", "mesh_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "paraPossibles", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"paraPossibles", " ", "=", "  ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Apply", "[", 
           RowBox[{"List", ",", 
            RowBox[{"MeshCells", "[", 
             RowBox[{"mesh", ",", "1"}], "]"}], ",", 
            RowBox[{"{", "1", "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", "\n", 
       "\t", 
       RowBox[{"paraPossibles", " ", "=", " ", 
        RowBox[{"DeleteDuplicates", "@", 
         RowBox[{"Join", "[", 
          RowBox[{"paraPossibles", ",", 
           RowBox[{"Map", "[", 
            RowBox[{"Reverse", ",", "paraPossibles"}], "]"}]}], "]"}]}]}], 
       ";", "\n", "\t", 
       RowBox[{"GroupBy", "[", 
        RowBox[{"paraPossibles", ",", "First", ",", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{"Last", ",", "#"}], "]"}], "&"}]}], "]"}]}]}], "\n", 
     "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{"makePackage", ",", 
     RowBox[{"End", "[", "]"}]}], "]"}], ";"}], " ", 
  RowBox[{"(*", " ", "Private", " ", "*)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{"makePackage", ",", 
     RowBox[{"EndPackage", "[", "]"}]}], "]"}], ";"}], "\n", 
  "\n"}], "\n"}], "Code",
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[285]:=",ExpressionUUID->"266cd5b1-2123-4b41-8621-e7480adb92fc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"createParastichyFamily", "[", 
    RowBox[{"meshAssociation_", ",", "starter_", ",", 
     RowBox[{"family_", ":", "1"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"nextpara", ",", "paraList", ",", "mpf", ",", "pstart"}], "}"}],
      ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pstart", " ", "=", " ", 
       RowBox[{"parastichyStarter", "[", 
        RowBox[{"meshAssociation", ",", "starter"}], "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "pstart", "]"}], "<", "2"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"Missing", "[", 
          RowBox[{"\"\<Can't make starter from \>\"", ",", " ", "starter"}], 
          "]"}], "]"}]}], "]"}], ";", 
      RowBox[{"mpf", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"mpf", " ", "=", " ", 
       RowBox[{"addToParastichyFamily", "[", 
        RowBox[{"mpf", ",", "pstart", ",", "family"}], "]"}]}], ";", 
      RowBox[{"mpf", " ", "=", " ", 
       RowBox[{"Nest", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"findAdjacentThreads", "[", 
           RowBox[{"meshAssociation", ",", "#"}], "]"}], "&"}], ",", "mpf", 
         ",", 
         RowBox[{
         "locateParastichyOptions", "[", "\"\<FamilyGrowthSize\>\"", "]"}]}], 
        "]"}]}], ";", 
      RowBox[{"mpf", " ", "=", " ", 
       RowBox[{"tidyParastichyFamily", "[", 
        RowBox[{"meshAssociation", ",", "mpf"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"locateParastichyOptions", "[", "\"\<Renumber\>\"", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"mpf", " ", "=", " ", 
          RowBox[{"renumberParastichyFamily", "[", 
           RowBox[{"meshAssociation", ",", "mpf"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "mpf"}]}], 
    "\n", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[302]:=",ExpressionUUID->"d3f2d60d-4435-48a4-be52-8b86c3b6f85d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"findAnOverlap", "[", 
     RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], " ", ":=",
     " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ix", ",", "jx", ",", "overlap"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"ix", "=", "1"}], ",", 
         RowBox[{"ix", "<", 
          RowBox[{"Length", "[", "parastichyFamily", "]"}]}], ",", 
         RowBox[{"ix", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"jx", " ", "=", " ", 
            RowBox[{"ix", "+", "1"}]}], ",", " ", 
           RowBox[{"jx", "<=", 
            RowBox[{"Length", "[", "parastichyFamily", "]"}]}], ",", 
           RowBox[{"jx", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"overlap", "  ", "=", " ", 
             RowBox[{"Intersection", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"parastichyFamily", "[", 
                 RowBox[{"[", "ix", "]"}], "]"}], "[", "\"\<Members\>\"", 
                "]"}], ",", 
               RowBox[{
                RowBox[{"parastichyFamily", "[", 
                 RowBox[{"[", "jx", "]"}], "]"}], "[", "\"\<Members\>\"", 
                "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "overlap", "]"}], ">", "0"}], " ", 
              "\[IndentingNewLine]", ",", " ", 
              RowBox[{"Return", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "parastichyFamily", "\[LeftDoubleBracket]", "ix", 
                   "\[RightDoubleBracket]"}], "[", "\"\<Index\>\"", "]"}], 
                 ",", 
                 RowBox[{
                  RowBox[{
                  "parastichyFamily", "\[LeftDoubleBracket]", "jx", 
                   "\[RightDoubleBracket]"}], "[", "\"\<Index\>\"", "]"}]}], 
                "}"}], "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", "\"\<No overlap\>\"", "]"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"findAnAdjacency", "[", 
     RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], " ", ":=",
     " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ix", ",", "jx", ",", "firstTail", ",", "secondHead"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"ix", "=", "1"}], ",", 
         RowBox[{"ix", "<", 
          RowBox[{"Length", "[", "parastichyFamily", "]"}]}], ",", 
         RowBox[{"ix", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"jx", " ", "=", " ", 
            RowBox[{"ix", "+", "1"}]}], ",", " ", 
           RowBox[{"jx", "<=", 
            RowBox[{"Length", "[", "parastichyFamily", "]"}]}], ",", 
           RowBox[{"jx", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"firstTail", " ", "=", " ", 
             RowBox[{"Last", "[", 
              RowBox[{
               RowBox[{"parastichyFamily", "[", 
                RowBox[{"[", "ix", "]"}], "]"}], "[", "\"\<Members\>\"", 
               "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"secondHead", " ", "=", "  ", 
             RowBox[{"First", "[", 
              RowBox[{
               RowBox[{"parastichyFamily", "[", 
                RowBox[{"[", "jx", "]"}], "]"}], "[", "\"\<Members\>\"", 
               "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"meshAssociation", "[", "\"\<Adjacency\>\"", "]"}], 
                 "[", "firstTail", "]"}], ",", "secondHead"}], "]"}], 
              "\[IndentingNewLine]", ",", " ", 
              RowBox[{"Return", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "parastichyFamily", "\[LeftDoubleBracket]", "ix", 
                   "\[RightDoubleBracket]"}], "[", "\"\<Index\>\"", "]"}], 
                 ",", 
                 RowBox[{
                  RowBox[{
                  "parastichyFamily", "\[LeftDoubleBracket]", "jx", 
                   "\[RightDoubleBracket]"}], "[", "\"\<Index\>\"", "]"}]}], 
                "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"firstTail", " ", "=", " ", 
             RowBox[{"Last", "[", 
              RowBox[{
               RowBox[{"parastichyFamily", "[", 
                RowBox[{"[", "jx", "]"}], "]"}], "[", "\"\<Members\>\"", 
               "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"secondHead", " ", "=", "  ", 
             RowBox[{"First", "[", 
              RowBox[{
               RowBox[{"parastichyFamily", "[", 
                RowBox[{"[", "ix", "]"}], "]"}], "[", "\"\<Members\>\"", 
               "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"meshAssociation", "[", "\"\<Adjacency\>\"", "]"}], 
                 "[", "firstTail", "]"}], ",", "secondHead"}], "]"}], 
              "\[IndentingNewLine]", ",", " ", 
              RowBox[{"Return", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "parastichyFamily", "\[LeftDoubleBracket]", "jx", 
                   "\[RightDoubleBracket]"}], "[", "\"\<Index\>\"", "]"}], 
                 ",", 
                 RowBox[{
                  RowBox[{
                  "parastichyFamily", "\[LeftDoubleBracket]", "ix", 
                   "\[RightDoubleBracket]"}], "[", "\"\<Index\>\"", "]"}]}], 
                "}"}], "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", "\"\<No adjacency\>\"", "]"}], "]"}], ";"}]}],
      "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[303]:=",ExpressionUUID->"d27eb31f-9685-4b44-b6ca-9d98105f73e6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"tidyParastichyFamily", "[", 
     RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], " ", ":=",
     " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ijx", ",", "n", ",", "mPF"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mPF", " ", "=", " ", "parastichyFamily"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"n", "=", "0"}], ",", 
         RowBox[{"n", "<", "100"}], ",", 
         RowBox[{"n", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ijx", " ", "=", " ", 
           RowBox[{"findAnOverlap", "[", 
            RowBox[{"meshAssociation", ",", "mPF"}], "]"}]}], " ", ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MissingQ", "[", "ijx", "]"}], ",", 
            RowBox[{"Break", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"n", ",", " ", "\"\< Overlap\>\"", ",", " ", "ijx"}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"mPF", " ", "=", " ", 
           RowBox[{"mergeParastichySibs", "[", 
            RowBox[{"meshAssociation", ",", "mPF", ",", "ijx"}], "]"}]}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"n", "=", "0"}], ",", 
         RowBox[{"n", "<", "10"}], ",", 
         RowBox[{"n", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ijx", " ", "=", " ", 
           RowBox[{"findAnAdjacency", "[", 
            RowBox[{"meshAssociation", ",", "mPF"}], "]"}]}], " ", ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MissingQ", "[", "ijx", "]"}], ",", 
            RowBox[{"Break", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"mPF", " ", "=", " ", 
           RowBox[{"mergeParastichySibs", "[", 
            RowBox[{"meshAssociation", ",", "mPF", ",", "ijx"}], "]"}]}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "mPF"}]}], "\n", "]"}]}], ";"}], 
  "\n"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[305]:=",ExpressionUUID->"6f079890-0c30-49f9-a923-bceb2e315ea5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"parastichyAdjacencyTable", " ", "[", 
    RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "g", ",", "path", ",", "paraAdjacency", ",", "paraAdjacencyCount", ",", 
       "paraAdjacencies", ",", "paraAdjacencyTable"}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"paraAdjacency", "[", "parastichyFamilyMember_", "]"}], " ", ":=",
        " ", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Union", "@@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{"meshAssociation", "[", "\"\<Adjacency\>\"", "]"}], ",", 
           RowBox[{"parastichyFamilyMember", "[", "\"\<Members\>\"", "]"}]}], 
          "]"}]}], "]"}]}], ";", "\n", "\t", 
      RowBox[{
       RowBox[{"paraAdjacencyCount", "[", 
        RowBox[{"ix_", ",", "ix_"}], "]"}], " ", ":=", " ", "0"}], ";", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"paraAdjacencyCount", "[", 
        RowBox[{"ix_", ",", "jx_"}], "]"}], " ", ":=", " ", 
       RowBox[{"Length", "@", 
        RowBox[{"Intersection", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"paraAdjacency", "[", 
           RowBox[{"parastichyFamily", "[", 
            RowBox[{"[", "ix", "]"}], "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"parastichyFamily", "[", 
            RowBox[{"[", "jx", "]"}], "]"}], "[", "\"\<Members\>\"", "]"}]}], 
         "\n", "\t", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"paraAdjacencies", "[", "ix_", "]"}], " ", ":=", " ", 
       RowBox[{"Keys", "@", 
        RowBox[{"Take", "[", 
         RowBox[{
          RowBox[{"Reverse", "@", 
           RowBox[{"Sort", "@", 
            RowBox[{"Association", "@", 
             RowBox[{"Table", "[", " ", "\n", "\t\t", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"parastichyFamily", "[", 
                   RowBox[{"[", "ix", "]"}], "]"}], "[", "\"\<Index\>\"", 
                  "]"}], " ", "\[UndirectedEdge]", 
                 RowBox[{
                  RowBox[{"parastichyFamily", "[", 
                   RowBox[{"[", "jx", "]"}], "]"}], "[", "\"\<Index\>\"", 
                  "]"}]}], "\n", "\t\t", "->", " ", 
                RowBox[{"paraAdjacencyCount", "[", 
                 RowBox[{"ix", ",", "jx"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"jx", ",", 
                 RowBox[{"Length", "[", "parastichyFamily", "]"}]}], "}"}]}], 
              "]"}]}]}]}], ",", "2"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"paraAdjacencyTable", " ", "=", " ", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"paraAdjacencies", "[", "ix", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"ix", ",", 
            RowBox[{"Length", "[", "parastichyFamily", "]"}]}], "}"}]}], 
         "]"}]}]}], ";", " ", "\n", "\t", "paraAdjacencyTable"}]}], "\n", 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[306]:=",ExpressionUUID->"756f00cc-3755-454d-a208-247637ce9458"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"renumberParastichyFamily", "[", 
    RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "g", ",", "familyOrder", ",", "paraAdjacencyTable", ",", "res", ",", 
       "family", ",", "para", ",", "i"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"paraAdjacencyTable", " ", "=", 
       RowBox[{"parastichyAdjacencyTable", "[", 
        RowBox[{"meshAssociation", ",", "parastichyFamily"}], "]"}]}], ";", 
      " ", 
      RowBox[{"g", " ", "=", " ", 
       RowBox[{"Graph", "[", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "&"}], ",", 
           "parastichyFamily"}], "]"}], ",", "paraAdjacencyTable", ",", 
         RowBox[{"VertexLabels", "->", "\"\<Name\>\""}]}], "]"}]}], ";", "\n", 
      RowBox[{"familyOrder", " ", "=", " ", 
       RowBox[{"topologicalSortByLongestPaths", "[", "g", "]"}]}], ";", "\n", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"family", " ", "=", " ", 
       RowBox[{
        RowBox[{"First", "[", "parastichyFamily", "]"}], "[", 
        "\"\<Family\>\"", "]"}]}], ";", 
      RowBox[{"family", "=", 
       RowBox[{
        RowBox[{"ToString", "[", "family", "]"}], "~~", "\"\<A\>\""}]}], ";", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "<=", " ", 
         RowBox[{"Length", "[", "familyOrder", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\n", 
        RowBox[{
         RowBox[{"para", " ", "=", " ", 
          RowBox[{
           RowBox[{"Query", "[", 
            RowBox[{"SelectFirst", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "==", 
               RowBox[{"familyOrder", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "&"}], "]"}], "]"}], "@", 
           "parastichyFamily"}]}], ";", 
         RowBox[{"res", " ", "=", " ", 
          RowBox[{"addToParastichyFamily", "[", 
           RowBox[{"res", ",", 
            RowBox[{"para", "[", "\"\<Members\>\"", "]"}], ",", "family"}], 
           "]"}]}], ";"}]}], "\n", "\t", "]"}], ";", "\n", "\t", "res"}]}], 
    "\n", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[307]:=",ExpressionUUID->"1d014996-9baf-42c8-a2cc-89ac1bc48b8e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mergeParastichySibs", "[", 
    RowBox[{"meshAssociation_", ",", "parastichyFamily_", ",", 
     RowBox[{"{", 
      RowBox[{"ix_", ",", "jx_"}], "}"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mPF", ",", "newParastichy", ",", "decho"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{"True", ",", 
         RowBox[{"Echo", "[", 
          RowBox[{"x", ",", "\"\<mPS\>\""}], "]"}], ",", "x"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"mPF", " ", "=", " ", "parastichyFamily"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"newParastichy", " ", "=", " ", 
       RowBox[{"Union", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"getParastichyByIndex", "[", 
           RowBox[{"mPF", ",", "ix"}], "]"}], "[", "\"\<Members\>\"", "]"}], 
         ",", 
         RowBox[{
          RowBox[{"getParastichyByIndex", "[", 
           RowBox[{"mPF", ",", "jx"}], "]"}], "[", "\"\<Members\>\"", "]"}]}],
         "]"}]}], ";", 
      RowBox[{"newParastichy", " ", "=", " ", 
       RowBox[{"makeDirectedParastichy", "[", 
        RowBox[{"meshAssociation", ",", "newParastichy"}], "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MissingQ", "[", "newParastichy", "]"}], ",", 
        RowBox[{"Return", "[", "mPF", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", 
      RowBox[{"mPF", " ", "=", " ", 
       RowBox[{"deleteFromParastichyFamily", "[", 
        RowBox[{"mPF", ",", 
         RowBox[{"{", 
          RowBox[{"ix", ",", "jx"}], "}"}]}], "]"}]}], ";", "\t", 
      "\[IndentingNewLine]", 
      RowBox[{"mPF", " ", "=", " ", 
       RowBox[{"addToParastichyFamily", "[", 
        RowBox[{"mPF", ",", "newParastichy"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "mPF"}]}], "\n", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[308]:=",ExpressionUUID->"aa52782f-2f77-4f6d-b567-77af59b4375b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"deleteFromParastichyFamily", "[", 
    RowBox[{"mpf_", ",", "indices_"}], "]"}], " ", ":=", "  ", 
   RowBox[{
    RowBox[{"Query", "[", 
     RowBox[{"Select", "[", " ", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"indices", ",", 
          RowBox[{"#", "[", "\"\<Index\>\"", "]"}]}], "]"}]}], "&"}], "]"}], 
     "]"}], "@", "mpf"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"getParastichyByIndex", "[", 
    RowBox[{"mpf_", ",", "index_"}], "]"}], " ", ":=", " ", 
   RowBox[{"First", "@", 
    RowBox[{"Select", "[", 
     RowBox[{"mpf", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "==", "index"}], "&"}]}], 
     "]"}]}]}], ";"}], "\n"}], "Code",
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[309]:=",ExpressionUUID->"dbb63815-f69a-4a96-bfec-9b2f1f193c64"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"combineInParastichyFamily", "[", 
    RowBox[{"mpf_", ",", 
     RowBox[{"{", 
      RowBox[{"ix1_", ",", "ix2_"}], "}"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"para", ",", "para1", ",", "para2", ",", "res"}], "}"}], ",", 
     "\n", 
     RowBox[{
      RowBox[{"para1", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"First", "@", 
          RowBox[{
           RowBox[{"Query", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "==", "ix1"}], "&"}],
              "]"}], "]"}], "@", "mpf"}]}], ")"}], "[", "\"\<Members\>\"", 
        "]"}]}], ";", "\n", 
      RowBox[{"para2", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"First", "@", 
          RowBox[{
           RowBox[{"Query", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "==", "ix2"}], "&"}],
              "]"}], "]"}], "@", "mpf"}]}], ")"}], "[", "\"\<Members\>\"", 
        "]"}]}], ";", "\n", 
      RowBox[{"para", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"para1", ",", "para2"}], "]"}]}], ";", "\n", 
      RowBox[{"res", " ", "=", " ", "mpf"}], ";", "\n", "\n", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"deleteFromParastichyFamily", "[", 
        RowBox[{"mpf", ",", 
         RowBox[{"{", 
          RowBox[{"ix1", ",", "ix2"}], "}"}]}], "]"}]}], ";", "\n", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"addToParastichyFamily", "[", 
        RowBox[{"res", ",", "para"}], "]"}]}], ";", "\n", "res"}]}], "\n", 
    "]"}]}], ";"}]], "Code",
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[311]:=",ExpressionUUID->"c85247cb-971b-4af8-acc6-d28716b5ddbf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"addToParastichyFamily", "[", 
    RowBox[{"mpf_", ",", "parastichy_"}], "]"}], " ", ":=", " ", 
   RowBox[{"addToParastichyFamily", "[", 
    RowBox[{"mpf", ",", "parastichy", ",", 
     RowBox[{
      RowBox[{"First", "[", "mpf", "]"}], "[", "\"\<Family\>\"", "]"}]}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"addToParastichyFamily", "[", 
     RowBox[{"mpf_", ",", "parastichy_", ",", "family_"}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ix", ",", "res", ",", "overlaps", ",", "maxIndex"}], "}"}], 
      ",", "\n", 
      RowBox[{
       RowBox[{"res", " ", "=", " ", "mpf"}], ";", "\n", 
       RowBox[{"maxIndex", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "mpf", "]"}], "==", "0"}], ",", "0", ",", 
          RowBox[{"Max", "[", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "&"}], ",", "mpf"}], 
            "]"}], "]"}]}], "]"}]}], ";", "\n", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"Append", "[", 
         RowBox[{"res", ",", "\n", 
          RowBox[{"<|", " ", 
           RowBox[{
            RowBox[{"\"\<Family\>\"", "->", "family"}], ",", 
            RowBox[{"\"\<Index\>\"", "->", " ", 
             RowBox[{"maxIndex", "+", "1"}]}], ",", 
            RowBox[{"\"\<Members\>\"", "->", "parastichy"}], " ", ",", " ", 
            RowBox[{"\"\<Head\>\"", "->", " ", 
             RowBox[{"First", "@", "parastichy"}]}]}], "|>"}]}], "]"}]}], ";",
        "\n", "res"}]}], "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"dropParastichyElement", "[", 
     RowBox[{"mpf_", ",", "ix_", ",", "dix_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", ",", "para", ",", "pix"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"res", " ", "=", " ", "mpf"}], ";", "\n", 
       RowBox[{"pix", " ", "=", " ", 
        RowBox[{"First", "@", 
         RowBox[{"FirstPosition", "[", 
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "&"}], ",", "res"}], 
            "]"}], ",", "ix"}], "]"}]}]}], ";", "\n", 
       RowBox[{"para", " ", "=", " ", 
        RowBox[{"res", "[", 
         RowBox[{"[", "pix", "]"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"para", "[", "\"\<Members\>\"", "]"}], " ", "=", " ", 
        RowBox[{"Drop", "[", 
         RowBox[{
          RowBox[{"para", "[", "\"\<Members\>\"", "]"}], ",", "dix"}], 
         "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"res", "[", 
         RowBox[{"[", "pix", "]"}], "]"}], "=", "para"}], ";", "\n", 
       "res"}]}], "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"appendParastichyElements", "[", 
    RowBox[{"mpf_", ",", "ix_", ",", "extraPoints_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", ",", "para", ",", "pix"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"res", " ", "=", " ", "mpf"}], ";", "\n", 
      RowBox[{"pix", " ", "=", " ", 
       RowBox[{"First", "@", 
        RowBox[{"FirstPosition", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "&"}], ",", "res"}], 
           "]"}], ",", "ix"}], "]"}]}]}], ";", "\n", 
      RowBox[{"para", " ", "=", " ", 
       RowBox[{"res", "[", 
        RowBox[{"[", "pix", "]"}], "]"}]}], ";", "\n", 
      RowBox[{
       RowBox[{"para", "[", "\"\<Members\>\"", "]"}], " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"para", "[", "\"\<Members\>\"", "]"}], ",", "extraPoints"}], 
        "]"}]}], ";", "\n", 
      RowBox[{
       RowBox[{"res", "[", 
        RowBox[{"[", "pix", "]"}], "]"}], "=", "para"}], ";", "\n", "res"}]}],
     "\n", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"prependParastichyElements", "[", 
    RowBox[{"mpf_", ",", "ix_", ",", "extraPoints_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", ",", "para", ",", "pix"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"res", " ", "=", " ", "mpf"}], ";", "\n", 
      RowBox[{"pix", " ", "=", " ", 
       RowBox[{"First", "@", 
        RowBox[{"FirstPosition", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", "\"\<Index\>\"", "]"}], "&"}], ",", "res"}], 
           "]"}], ",", "ix"}], "]"}]}]}], ";", "\n", 
      RowBox[{"para", " ", "=", " ", 
       RowBox[{"res", "[", 
        RowBox[{"[", "pix", "]"}], "]"}]}], ";", "\n", 
      RowBox[{
       RowBox[{"para", "[", "\"\<Members\>\"", "]"}], " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"extraPoints", ",", 
         RowBox[{"para", "[", "\"\<Members\>\"", "]"}]}], "]"}]}], ";", "\n", 
      RowBox[{
       RowBox[{"res", "[", 
        RowBox[{"[", "pix", "]"}], "]"}], "=", "para"}], ";", "\n", "res"}]}],
     "\n", "]"}]}], ";"}]}], "Code",
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[312]:=",ExpressionUUID->"8d91e29a-16bb-4df2-99a4-fcf8eb6bdae2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"parastichyStarter", "[", 
     RowBox[{"meshAssociation_", ",", " ", "starter_"}], "]"}], " ", ":=", 
    "\n", "  ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"inner", ",", " ", "parastichyPoints"}], "}"}], ",", "\n", 
      "    ", 
      RowBox[{
       RowBox[{"inner", " ", "=", " ", 
        RowBox[{"meshExtendParastichy", "[", 
         RowBox[{"meshAssociation", ",", " ", "starter", ",", " ", 
          RowBox[{
          "locateParastichyOptions", "[", "\"\<InitialParastichyLength\>\"", 
           "]"}], ",", " ", 
          RowBox[{"{", "}"}], ",", " ", 
          RowBox[{"{", "}"}]}], "]"}]}], ";", "\n", "   ", "inner"}]}], "\n", 
     "  ", "]"}]}], ";"}], "\n", " "}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshExtendParastichy", "[", 
    RowBox[{
    "meshAssociation_", ",", "starter_", ",", "length_", ",", "avoidPoints_", 
     ",", "adjacentParastichy_"}], "]"}], " ", ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"i", ",", "res", ",", "np", ",", "decho"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Intersection", "[", 
            RowBox[{"starter", ",", 
             RowBox[{"{", 
              RowBox[{"340", ",", "464"}], "}"}]}], "]"}], "]"}], "<", "00"}],
          ",", 
         RowBox[{"Echo", "[", 
          RowBox[{"x", ",", "\"\<mEP\>\""}], "]"}], ",", "x"}], "]"}]}], ";", 
      "\n", 
      RowBox[{"res", " ", "=", " ", "starter"}], ";", "\n", "\n", 
      RowBox[{"For", "[", " ", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "<=", " ", "length"}], ",", 
        RowBox[{"i", "++"}], ",", "\n", 
        RowBox[{
         RowBox[{"np", " ", "=", " ", 
          RowBox[{"decho", "@", 
           RowBox[{"nextParastichyPoint", "[", 
            RowBox[{
            "meshAssociation", ",", "res", ",", "avoidPoints", ",", 
             "adjacentParastichy"}], "]"}]}]}], ";", "\n", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MissingQ", "[", "np", "]"}], ",", 
           RowBox[{"Break", "[", "]"}]}], "]"}], ";", 
         RowBox[{"res", "=", " ", 
          RowBox[{"Append", "[", 
           RowBox[{"res", ",", "np"}], "]"}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"meshAssociation", "[", "\"\<OuterBoundary\>\"", "]"}], 
             ",", "np"}], "]"}], ",", 
           RowBox[{"Break", "[", "]"}]}], "]"}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"meshAssociation", "[", "\"\<InnerBoundary\>\"", "]"}], 
             ",", "np"}], "]"}], ",", 
           RowBox[{"Break", "[", "]"}]}], "]"}], ";"}]}], "\n", "]"}], ";", 
      "\n", "res"}]}], "\n", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[317]:=",ExpressionUUID->"e051c6ea-9b7a-4344-afed-0ec63275c8f0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"nextParastichyPoint", "[", 
     RowBox[{
     "meshAssociation_", ",", "parastichy_", ",", "avoidPoints_", ",", 
      "adjacentParastichy_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "candidateContinues", ",", "straightnessAngle", ",", "nextStraightest",
         ",", "debugTest", ",", "adjacentParastichyEnds", ",", 
        "candidateInfo", ",", "adjacentParastichyCentre", ",", "\n", 
        "adjacentCandidates", ",", "res", ",", "decho"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"debugTest", " ", "=", " ", 
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"2", ",", "10"}], "}"}], ",", 
          RowBox[{"-", 
           RowBox[{"Last", "@", "parastichy"}]}]}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
        RowBox[{"If", "[", 
         RowBox[{"debugTest", ",", 
          RowBox[{"Echo", "[", 
           RowBox[{"x", ",", "\"\<nPP\>\""}], "]"}], ",", "x"}], "]"}]}], ";",
        "\n", "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "parastichy", "]"}], "==", "0"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"Missing", "[", "\"\<No parastichy to extend\>\"", "]"}], 
          "]"}]}], "]"}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"MissingQ", "[", "parastichy", "]"}], "==", "0"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"Missing", "[", "\"\<Missing parastichy\>\"", "]"}], 
          "]"}]}], "]"}], ";", "\n", "\n", 
       RowBox[{"straightnessAngle", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "adjacentParastichy", "]"}], ">", "0"}], 
          ",", "\n", 
          RowBox[{
          "locateParastichyOptions", "[", "\"\<StraightnessWhenAdjacent\>\"", 
           "]"}], ",", "\n", 
          RowBox[{
          "locateParastichyOptions", "[", 
           "\"\<StraightnessWhenUnadjacent\>\"", "]"}]}], "\n", "]"}]}], ";", 
       "\n", 
       RowBox[{"adjacentParastichyEnds", "  ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "adjacentParastichy", "]"}], "==", "0"}], 
          ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"Union", "@@", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"meshAssociation", "[", "\"\<Adjacency\>\"", "]"}], 
               "[", "#", "]"}], "&"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"First", "[", "adjacentParastichy", "]"}], ",", 
               RowBox[{"Last", "[", "adjacentParastichy", "]"}]}], "}"}]}], 
            "]"}]}]}], "]"}]}], ";", 
       RowBox[{"adjacentParastichyCentre", "   ", "=", " ", 
        RowBox[{"Complement", "[", 
         RowBox[{"adjacentParastichy", ",", "adjacentParastichyEnds"}], 
         "]"}]}], ";", "\n", "\n", 
       RowBox[{"decho", "[", "parastichy", "]"}], ";", "\n", 
       RowBox[{"candidateContinues", " ", "=", " ", 
        RowBox[{
         RowBox[{"meshAssociation", "[", "\"\<Adjacency\>\"", "]"}], "[", 
         RowBox[{"Last", "@", "parastichy"}], "]"}]}], ";", "\n", "\n", 
       RowBox[{"candidateContinues", " ", "=", " ", 
        RowBox[{"Complement", "[", 
         RowBox[{"candidateContinues", ",", "avoidPoints"}], "]"}]}], ";", 
       RowBox[{"candidateInfo", " ", "=", " ", 
        RowBox[{
         RowBox[{"KeyValueMap", "[", " ", 
          RowBox[{
           RowBox[{"<|", " ", 
            RowBox[{
             RowBox[{"\"\<Node\>\"", "->", "#1"}], ",", 
             RowBox[{"\"\<Deviation\>\"", "->", " ", "#2"}]}], "|>"}], " ", 
           "&"}], "]"}], "@", 
         RowBox[{"orderByStraightness", "[", 
          RowBox[{
          "meshAssociation", ",", "parastichy", ",", "candidateContinues"}], 
          "]"}]}]}], ";", 
       RowBox[{"candidateInfo", " ", "=", " ", 
        RowBox[{"Map", "[", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"#", ",", " ", 
             RowBox[{"\"\<Adjacency\>\"", "->", " ", 
              RowBox[{
               RowBox[{"meshAssociation", "[", "\"\<Adjacency\>\"", "]"}], 
               "[", 
               RowBox[{"#", "[", "\"\<Node\>\"", "]"}], "]"}]}]}], "]"}], 
           "&"}], ",", "candidateInfo"}], "]"}]}], ";", 
       RowBox[{"candidateInfo", " ", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"#", ",", " ", 
             RowBox[{"\"\<NextToAdjacentCentre\>\"", "->", "  ", "\n", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Intersection", "[", 
                 RowBox[{
                  RowBox[{"#", "[", "\"\<Adjacency\>\"", "]"}], ",", 
                  "adjacentParastichyCentre"}], "]"}], "]"}], ">", "0"}]}]}], 
            "]"}], "&"}], ",", "candidateInfo"}], "]"}]}], ";", 
       RowBox[{"candidateInfo", " ", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"#", ",", " ", 
             RowBox[{"\"\<NextToAdjacentEnds\>\"", "->", "  ", "\n", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Intersection", "[", 
                 RowBox[{
                  RowBox[{"#", "[", "\"\<Adjacency\>\"", "]"}], ",", 
                  "adjacentParastichyEnds"}], "]"}], "]"}], ">", "0"}]}]}], 
            "]"}], "&"}], ",", "candidateInfo"}], "]"}]}], ";", 
       RowBox[{"candidateInfo", " ", "=", " ", 
        RowBox[{"Map", "[", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"#", ",", " ", 
             RowBox[{"\"\<NextToAdjacent\>\"", "->", "  ", "\n", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Intersection", "[", 
                 RowBox[{
                  RowBox[{"#", "[", "\"\<Adjacency\>\"", "]"}], ",", 
                  "adjacentParastichy"}], "]"}], "]"}], ">", "0"}]}]}], "]"}],
            "&"}], ",", "candidateInfo"}], "]"}]}], ";", 
       RowBox[{"candidateInfo", " ", "=", " ", 
        RowBox[{"Map", "[", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"#", ",", " ", 
             RowBox[{"\"\<OnAdjacent\>\"", "->", " ", "\n", " ", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Intersection", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"#", "[", "\"\<Node\>\"", "]"}], "}"}], ",", 
                  "adjacentParastichy"}], "]"}], "]"}], ">", "0"}]}]}], "]"}],
            "&"}], ",", "candidateInfo"}], "]"}]}], ";", "\n", 
       RowBox[{"candidateInfo", " ", "=", " ", 
        RowBox[{"Map", "[", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"#", ",", " ", 
             RowBox[{"\"\<Straightish\>\"", "->", " ", 
              RowBox[{"isStraightish", "[", "#", "]"}]}]}], "]"}], "&"}], ",",
           "candidateInfo"}], "]"}]}], ";", "\n", 
       RowBox[{"(*", " ", 
        RowBox[{
        "screen", " ", "out", " ", "any", " ", "with", " ", "too", " ", 
         "much", " ", "deviation", " ", "anyway"}], " ", "*)"}], " ", "\n", 
       "\n", 
       RowBox[{"candidateInfo", " ", "=", "  ", 
        RowBox[{
         RowBox[{"Query", "[", 
          RowBox[{"Select", "[", "  ", 
           RowBox[{
            RowBox[{"#", "[", "\"\<Straightish\>\"", "]"}], "&"}], " ", "]"}],
           "]"}], "@", " ", "candidateInfo"}]}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "candidateInfo", "]"}], "==", "0"}], ",", 
         "\n", 
         RowBox[{
          RowBox[{"decho", "@", "\"\<End of the line\>\""}], " ", ";", 
          RowBox[{"Return", "[", 
           RowBox[{"Missing", "[", "\"\<End of the line\>\"", "]"}], 
           "]"}]}]}], "]"}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"First", "[", "candidateInfo", "]"}], "[", 
          "\"\<OnAdjacent\>\"", "]"}], ",", 
         RowBox[{
          RowBox[{"decho", "@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<terminating at \>\"", ",", "candidateInfo", ",", " ", 
             "\"\<because of collision with adjacent\>\""}], "}"}]}], ";", 
          RowBox[{"Return", "[", 
           RowBox[{"Missing", "[", "\"\<Collision\>\"", "]"}], "]"}]}]}], 
        "\n", "]"}], ";", "\n", "\n", 
       RowBox[{"(*", " ", 
        RowBox[{
        "do", " ", "we", " ", "have", " ", "any", " ", "that", " ", 
         "preserve", " ", "adjacency"}], " ", "*)"}], " ", 
       RowBox[{"adjacentCandidates", " ", "=", "  ", 
        RowBox[{
         RowBox[{"Query", "[", 
          RowBox[{"Select", "[", "  ", 
           RowBox[{
            RowBox[{"#", "[", "\"\<NextToAdjacent\>\"", "]"}], "&"}], " ", 
           "]"}], "]"}], "@", "candidateInfo"}]}], ";", 
       RowBox[{"If", "[", 
        RowBox[{"debugTest", ",", 
         RowBox[{"Print", "[", "adjacentCandidates", " ", "]"}]}], "]"}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "adjacentCandidates", "]"}], ">", "0"}], ",",
          "\n", 
         RowBox[{
          RowBox[{"res", " ", "=", " ", 
           RowBox[{
            RowBox[{"First", "[", "adjacentCandidates", "]"}], "[", 
            "\"\<Node\>\"", "]"}]}], ";", "\n", 
          RowBox[{"If", "[", 
           RowBox[{"debugTest", ",", 
            RowBox[{"Print", "[", "res", "]"}]}], "]"}], ";", "\n", 
          RowBox[{"Return", "[", "res", "]"}]}]}], "]"}], ";", "\n", "\n", 
       RowBox[{"(*", " ", 
        RowBox[{
        "otherwise", " ", "we", " ", "take", " ", "a", " ", "nonadjacent", 
         " ", 
         RowBox[{"(", 
          RowBox[{
          "which", " ", "may", " ", "have", " ", "been", " ", "straighter"}], 
          " "}]}], "*)"}], 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{
         RowBox[{"First", "[", "candidateInfo", "]"}], "[", "\"\<Node\>\"", 
         "]"}]}], ";", 
       RowBox[{"If", "[", 
        RowBox[{"debugTest", ",", 
         RowBox[{"Print", "[", "res", "]"}]}], "]"}], ";", 
       RowBox[{"Return", "[", "res", "]"}], ";"}]}], "\n", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"isStraightish", "[", "cInfo_", "]"}], " ", ":=", " ", 
    RowBox[{"(", "\n", 
     RowBox[{
      RowBox[{"Abs", "[", 
       RowBox[{"cInfo", "[", "\"\<Deviation\>\"", "]"}], "]"}], "<", " ", 
      "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"cInfo", "[", "\"\<NextToAdjacentCentre\>\"", "]"}], " ", "||",
          " ", 
         RowBox[{"cInfo", "[", "\"\<NextToAdjacentEnds\>\"", "]"}]}], ",", 
        " ", "\n", 
        RowBox[{
        "locateParastichyOptions", "[", "\"\<StraightnessWhenAdjacent\>\"", 
         "]"}], ",", "\n", 
        RowBox[{
        "locateParastichyOptions", "[", "\"\<StraightnessWhenUnadjacent\>\"", 
         "]"}]}], "\n", "]"}]}], "\n", ")"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"orderByStraightness", "[", 
     RowBox[{
     "meshAssociation_", ",", "parastichy_", ",", "candidateContinues_"}], 
     "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "paraPossiblePairs", ",", "paraPossibleAngles", ",", "lastAngle", ",", 
        "paraAngles", ",", "deviationsNext"}], "}"}], ",", 
      RowBox[{
       RowBox[{"paraPossiblePairs", " ", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"parastichy", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], ",", "#"}], "}"}], "&"}], 
          ",", "candidateContinues"}], "]"}]}], ";", 
       RowBox[{"paraPossibleAngles", " ", "=", " ", 
        RowBox[{"Association", "@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "->", 
             RowBox[{"meshLineAngle", "[", 
              RowBox[{"meshAssociation", ",", "#"}], "]"}]}], "&"}], ",", 
           "paraPossiblePairs"}], "]"}]}]}], ";", 
       RowBox[{"lastAngle", " ", "=", " ", 
        RowBox[{"meshLineAngle", "[", 
         RowBox[{"meshAssociation", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"parastichy", "[", 
             RowBox[{"[", 
              RowBox[{"-", "2"}], "]"}], "]"}], ",", 
            RowBox[{"parastichy", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
       RowBox[{"paraAngles", " ", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"anglePrincipal", "[", 
            RowBox[{"#", "-", "lastAngle"}], "]"}], "&"}], ",", 
          "paraPossibleAngles"}], "]"}]}], ";", 
       RowBox[{"deviationsNext", " ", "=", " ", 
        RowBox[{"Sort", "@", 
         RowBox[{"Abs", "[", "paraAngles", "]"}]}]}], ";", "\n", 
       "deviationsNext"}]}], "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshLineDeviation", "[", 
     RowBox[{"meshAssociation_", ",", 
      RowBox[{"{", 
       RowBox[{"ix1_", ",", "ix2_", ",", "ix3_"}], "}"}]}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "p1p2", ",", "p2p3", ",", "first", ",", "second", ",", "pAngle", ",", 
        "res"}], "}"}], ",", "\n", 
      RowBox[{"(*", " ", 
       RowBox[{"in", " ", "[", 
        RowBox[{
         RowBox[{"-", "180"}], ",", "180"}], " "}], "*)"}], 
      RowBox[{
       RowBox[{"p1p2", " ", "=", " ", 
        RowBox[{"MeshPrimitives", "[", 
         RowBox[{
          RowBox[{"meshAssociation", "[", "\"\<Mesh\>\"", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"ix1", ",", "ix2"}], "}"}]}], "}"}]}], "]"}]}], ";", 
       RowBox[{
        RowBox[{"pAngle", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Point", "[", 
            RowBox[{"{", 
             RowBox[{"x1_", ",", "y1_"}], "}"}], "]"}], ",", 
           RowBox[{"Point", "[", 
            RowBox[{"{", 
             RowBox[{"x2_", ",", "y2_"}], "}"}], "]"}]}], "}"}], "]"}], " ", ":=",
         " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"360", "/", 
           RowBox[{"(", 
            RowBox[{"2", "\[Pi]"}], ")"}]}], ")"}], " ", 
         RowBox[{"ArcTan", "[", 
          RowBox[{
           RowBox[{"x2", "-", "x1"}], ",", 
           RowBox[{"y2", "-", "y1"}]}], "]"}]}]}], ";", 
       RowBox[{"first", " ", "=", " ", 
        RowBox[{"pAngle", "[", "p1p2", "]"}]}], ";", "\n", 
       RowBox[{"p2p3", " ", "=", " ", 
        RowBox[{"MeshPrimitives", "[", 
         RowBox[{
          RowBox[{"meshAssociation", "[", "\"\<Mesh\>\"", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"ix2", ",", "ix3"}], "}"}]}], "}"}]}], "]"}]}], ";", 
       "\n", 
       RowBox[{"second", " ", "=", " ", 
        RowBox[{"pAngle", "[", "p2p3", "]"}]}], ";", "\n", 
       RowBox[{"anglePrincipal", "[", 
        RowBox[{"first", "-", "second"}], "]"}]}]}], "\n", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshLineAngle", "[", 
    RowBox[{"meshAssociation_", ",", 
     RowBox[{"{", 
      RowBox[{"ix1_", ",", "ix2_"}], "}"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"p1p2", ",", "pAngle", ",", "res"}], "}"}], ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{"in", " ", "[", 
       RowBox[{
        RowBox[{"-", "180"}], ",", "180"}], " "}], "*)"}], "\n", 
     RowBox[{
      RowBox[{"p1p2", " ", "=", " ", 
       RowBox[{"MeshPrimitives", "[", 
        RowBox[{
         RowBox[{"meshAssociation", "[", "\"\<Mesh\>\"", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"ix1", ",", "ix2"}], "}"}]}], "}"}]}], "]"}]}], ";", "\n", 
      RowBox[{
       RowBox[{"pAngle", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Point", "[", 
           RowBox[{"{", 
            RowBox[{"x1_", ",", "y1_"}], "}"}], "]"}], ",", 
          RowBox[{"Point", "[", 
           RowBox[{"{", 
            RowBox[{"x2_", ",", "y2_"}], "}"}], "]"}]}], "}"}], "]"}], " ", ":=",
        " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"360", "/", 
          RowBox[{"(", 
           RowBox[{"2", "\[Pi]"}], ")"}]}], ")"}], " ", 
        RowBox[{"ArcTan", "[", 
         RowBox[{
          RowBox[{"x2", "-", "x1"}], ",", 
          RowBox[{"y2", "-", "y1"}]}], "]"}]}]}], ";", "\n", 
      RowBox[{"pAngle", "[", "p1p2", "]"}]}]}], "\n", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"anglePrincipal", "[", "angle_", "]"}], " ", ":=", "  ", 
    RowBox[{"angle", " ", "-", " ", 
     RowBox[{"360", " ", 
      RowBox[{"Round", "[", 
       RowBox[{"angle", "/", "360"}], "]"}]}]}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"in", " ", "-", "180"}], " ", "<", " ", "angle", " ", "<", " ", 
    "180"}], " ", "*)"}], " "}], "\n"}], "Code",
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[319]:=",ExpressionUUID->"76ea223f-8c2c-4947-9ea8-ff05b8f82dd0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"extendThreadAndAdd", "[", 
    RowBox[{"meshAssociation_", ",", "parastichyFamily_", ",", "thread_"}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mPF", ",", "extendThread", ",", "avoidPoints"}], "}"}], ",", 
     "\n", 
     RowBox[{
      RowBox[{"mPF", " ", "=", " ", "parastichyFamily"}], ";", "\n", 
      RowBox[{"avoidPoints", " ", "=", " ", 
       RowBox[{"nodesInParastichyFamily", "[", "mPF", "]"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Intersection", "[", 
           RowBox[{"thread", ",", "avoidPoints"}], "]"}], "]"}], ">", "0"}], 
        ",", 
        RowBox[{"Return", "[", "mPF", "]"}]}], "]"}], ";", "\n", 
      RowBox[{"extendThread", " ", "=", " ", 
       RowBox[{"meshExtendParastichy", "[", 
        RowBox[{"meshAssociation", ",", "thread", "\n", ",", 
         RowBox[{
         "locateParastichyOptions", "[", "\"\<ParastichyExtensionLength\>\"", 
          "]"}], ",", " ", "avoidPoints", ",", 
         RowBox[{"{", "}"}]}], "]"}]}], ";", "\n", 
      RowBox[{"avoidPoints", " ", "=", " ", 
       RowBox[{"Union", "[", 
        RowBox[{"avoidPoints", ",", "extendThread"}], "]"}]}], ";", "\n", 
      "\n", 
      RowBox[{"extendThread", " ", "=", " ", 
       RowBox[{"meshExtendParastichy", "[", 
        RowBox[{"meshAssociation", ",", 
         RowBox[{"Reverse", "@", "extendThread"}], ",", "\n", 
         RowBox[{
         "locateParastichyOptions", "[", "\"\<ParastichyExtensionLength\>\"", 
          "]"}], ",", " ", "avoidPoints", ",", 
         RowBox[{"{", "}"}]}], "]"}]}], ";", 
      RowBox[{"decho", "[", 
       RowBox[{"{", 
        RowBox[{"\"\<Second extension \>\"", ",", "extendThread"}], "}"}], 
       "]"}], ";", 
      RowBox[{"avoidPoints", " ", "=", " ", 
       RowBox[{"Union", "[", 
        RowBox[{"avoidPoints", ",", "extendThread"}], "]"}]}], ";", "\n", 
      "\n", 
      RowBox[{"extendThread", "  ", "=", " ", 
       RowBox[{"makeDirectedParastichy", "[", 
        RowBox[{"meshAssociation", ",", "extendThread"}], "]"}]}], ";", 
      RowBox[{"mPF", " ", "=", " ", 
       RowBox[{"addToParastichyFamily", "[", 
        RowBox[{"mPF", ",", "extendThread"}], "]"}]}], " ", ";", " ", "\n", 
      "mPF"}]}], "\n", "\n", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[325]:=",ExpressionUUID->"66768435-00b5-4a9d-92b3-461e76c140f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"findAdjacentThreads", "[", 
    RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "mPF", ",", "atp", ",", "family", ",", "ix", ",", "avoidPoints", ",", 
       "extendThread", ",", "decho", ",", "nTimes"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mPF", " ", "=", " ", "parastichyFamily"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"nTimes", " ", "=", " ", "1"}], ",", 
        RowBox[{"nTimes", "<=", " ", "4"}], ",", 
        RowBox[{"nTimes", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"atp", " ", "=", " ", 
          RowBox[{"adjacentThreadsToParastichyFamily", "[", 
           RowBox[{"meshAssociation", ",", "mPF"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"ix", "=", "1"}], ",", 
           RowBox[{"ix", "<=", " ", 
            RowBox[{"Length", "[", "atp", "]"}]}], ",", 
           RowBox[{"ix", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"mPF", " ", "=", " ", 
             RowBox[{"extendThreadAndAdd", "[", 
              RowBox[{"meshAssociation", ",", "mPF", ",", 
               RowBox[{"atp", "[", 
                RowBox[{"[", "ix", "]"}], "]"}]}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", "mPF"}]}], "\n", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[326]:=",ExpressionUUID->"322c5088-f8d9-44cb-b112-dc5e4d3df686"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"centralMembers", "[", "parastichyFamilyMember_", "]"}], " ", ":=",
     " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "members", "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"members", " ", "=", " ", 
        RowBox[{"parastichyFamilyMember", "[", "\"\<Members\>\"", "]"}]}], 
       ";", "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "members", "]"}], "==", "0"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{
          "Missing", "[", "\"\<Error: parastichy with no members\>\"", "]"}], 
          "]"}]}], "]"}], ";", "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "members", "]"}], "<", "3"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"{", "}"}], "]"}]}], "]"}], ";", "\n", 
       RowBox[{"Drop", "[", 
        RowBox[{
         RowBox[{"Drop", "[", 
          RowBox[{"members", ",", 
           RowBox[{"-", "1"}]}], "]"}], ",", "1"}], "]"}]}]}], "\n", "]"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"nodesInParastichyFamily", "[", "parastichyFamily_", "]"}], " ", ":=",
     "  ", 
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{"Union", "@@", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", "\"\<Members\>\"", "]"}], "&"}], ",", 
        "parastichyFamily"}], "]"}]}], "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"nonEndNodesInParastichyFamily", "[", "parastichyFamily_", "]"}], 
    " ", ":=", "  ", 
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{"Union", "@@", 
      RowBox[{"Map", "[", 
       RowBox[{"centralMembers", ",", "parastichyFamily"}], "]"}]}], "]"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"adjacentNodesToParastichyFamily", "[", 
    RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], ":=", "  ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"familyPoints", ",", "allAdjacentPoints"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"familyPoints", "  ", "=", "  ", 
       RowBox[{"nonEndNodesInParastichyFamily", "@", "parastichyFamily"}]}], 
      ";", "\n", 
      RowBox[{"allAdjacentPoints", " ", "=", " ", 
       RowBox[{"Union", " ", "@@", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"meshAssociation", "[", "\"\<Adjacency\>\"", "]"}], "[", 
            "#", "]"}], "&"}], ",", " ", "familyPoints"}], "]"}]}]}], ";", 
      "\n", 
      RowBox[{"allAdjacentPoints", " ", "=", " ", 
       RowBox[{"DeleteDuplicates", " ", "@", "allAdjacentPoints"}]}], " ", 
      ";", "\n", 
      RowBox[{"allAdjacentPoints", "=", " ", 
       RowBox[{"Complement", "[", 
        RowBox[{"allAdjacentPoints", ",", " ", 
         RowBox[{"nodesInParastichyFamily", "[", "parastichyFamily", "]"}]}], 
        " ", "]"}]}], ";", "\n", "allAdjacentPoints"}]}], "\n", "]"}]}], 
  ";"}]}], "Code",
 CellLabel->
  "2/14/21 17:16:49 (Local) \
In[327]:=",ExpressionUUID->"be645f4a-1ec5-42a2-a97d-351d1dab3f71"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"adjacentThreadsToParastichyFamily", "[", 
    RowBox[{"meshAssociation_", ",", "parastichyFamily_"}], "]"}], ":=", "  ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "allAdjacentPoints", ",", "allAdjacentGraph", ",", 
       "allAdjacentComponents", ",", "adjacentThreads"}], "}"}], ",", 
     RowBox[{
      RowBox[{"allAdjacentPoints", " ", "=", 
       RowBox[{"adjacentNodesToParastichyFamily", "[", 
        RowBox[{"meshAssociation", ",", "parastichyFamily"}], "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "allAdjacentPoints", "]"}], " ", "<", " ", 
         "2"}], ",", "\n", "\t\t\t", 
        RowBox[{"Return", "[", 
         RowBox[{"{", "}"}], "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"allAdjacentGraph", "=", " ", 
       RowBox[{"adjacencyGraph", "[", 
        RowBox[{"meshAssociation", ",", " ", "allAdjacentPoints"}], "]"}]}], 
      ";", 
      RowBox[{"allAdjacentComponents", " ", "=", "  ", 
       RowBox[{"ConnectedGraphComponents", "[", "allAdjacentGraph", "]"}]}], 
      ";", 
      RowBox[{"allAdjacentComponents", "  ", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"allAdjacentComponents", ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"VertexCount", "[", "#", "]"}], " ", ">=", " ", 
           RowBox[{
           "locateParastichyOptions", "[", "\"\<MinimumThreadLength\>\"", 
            "]"}]}], "&"}]}], "]"}]}], ";", 
      RowBox[{"allAdjacentComponents", "  ", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"makeDirectedPath", "[", 
           RowBox[{"meshAssociation", ",", "#"}], "]"}], "&"}], ",", 
         "allAdjacentComponents"}], "]"}]}], ";", 
      RowBox[{"allAdjacentComponents", "    ", "=", " ", 
       RowBox[{"allAdjacentComponents", " ", "/.", " ", 
        RowBox[{
         RowBox[{"Missing", "[", "_", "]"}], "->", 
         RowBox[{"Nothing", "[", "]"}]}]}]}], ";", 
      RowBox[{"allAdjacentComponents", "  ", "=", " ", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"splitAtKinks", "[", 
           RowBox[{"meshAssociation", ",", "#"}], "]"}], "&"}], ",", 
         "allAdjacentComponents"}], "]"}]}], ";", 
      RowBox[{"allAdjacentComponents", "  ", "=", " ", 
       RowBox[{"Flatten", " ", "@", "allAdjacentComponents"}]}], ";", 
      RowBox[{"allAdjacentComponents", "    ", "=", " ", 
       RowBox[{"allAdjacentComponents", " ", "/.", " ", 
        RowBox[{
         RowBox[{"Missing", "[", "_", "]"}], "->", 
         RowBox[{"Nothing", "[", "]"}]}]}]}], ";", 
      RowBox[{"adjacentThreads", "  ", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"TopologicalSort", ",", "allAdjacentComponents"}], "]"}]}], 
      ";", "\[IndentingNewLine]", "adjacentThreads"}]}], "\n", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:50 (Local) \
In[331]:=",ExpressionUUID->"c1ab1a61-6202-4858-9b27-ab224e963ebe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"vertexEdgeCount", "[", 
     RowBox[{"graph_", ",", "vertex_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Length", "[", 
     RowBox[{"IncidenceList", "[", 
      RowBox[{"graph", ",", "vertex"}], "]"}], "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"removeCyclicPoints", "[", "component_", "]"}], " ", ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "stree", ",", "incidence", ",", "edgeCount", ",", "branchPoints", ",", 
        "streeComponents", ",", "res"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"stree", " ", "=", " ", 
        RowBox[{"FindSpanningTree", "[", "component", "]"}]}], ";", "\n", 
       RowBox[{"incidence", "  ", "=", "  ", 
        RowBox[{"AssociationThread", "[", 
         RowBox[{
          RowBox[{"VertexList", "[", "stree", "]"}], ",", "\n", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"IncidenceList", "[", 
              RowBox[{"stree", ",", "#"}], "]"}], "&"}], ",", 
            RowBox[{"VertexList", "[", "stree", "]"}]}], "]"}]}], "\n", 
         "]"}]}], ";", "\n", 
       RowBox[{"edgeCount", "  ", "=", "  ", 
        RowBox[{"Map", "[", 
         RowBox[{"Length", ",", "incidence"}], "]"}]}], ";", "\n", 
       RowBox[{"branchPoints", " ", "=", " ", 
        RowBox[{"Select", "[", 
         RowBox[{"edgeCount", ",", 
          RowBox[{
           RowBox[{"#", ">", "2"}], "&"}]}], "]"}]}], ";", "\n", 
       RowBox[{"stree", " ", "=", 
        RowBox[{"VertexDelete", "[", 
         RowBox[{"component", ",", 
          RowBox[{"Keys", "@", "branchPoints"}]}], "]"}]}], ";", "\n", 
       RowBox[{"streeComponents", " ", "=", " ", 
        RowBox[{"ConnectedGraphComponents", "[", "stree", "]"}]}], ";", "\n", 
       RowBox[{"streeComponents", " ", "=", " ", 
        RowBox[{"SortBy", "[", 
         RowBox[{"streeComponents", ",", "VertexCount"}], "]"}]}], ";", "\n", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"Last", "@", "streeComponents"}]}], ";", "\n", "res"}]}], 
     "\n", "\n", "]"}]}], ";"}], "\n", "\n"}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:50 (Local) \
In[332]:=",ExpressionUUID->"bd123bb0-00cd-4325-b748-3131e98f621a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"findLongestPath", "[", "g_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"paths", ",", "path", ",", "decho"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{"False", ",", 
         RowBox[{"Echo", "[", 
          RowBox[{"x", ",", "\"\<fLP\>\""}], "]"}], ",", "x"}], "]"}]}], ";", 
      "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCount", "[", "g", "]"}], "<=", " ", "2"}], ",", " ", 
        RowBox[{"Return", "[", 
         RowBox[{"VertexList", "[", "g", "]"}], "]"}]}], "]"}], ";", "\n", 
      RowBox[{"paths", " ", "=", 
       RowBox[{"findEdgePaths", "[", "g", "]"}]}], ";", "\n", 
      RowBox[{"path", " ", "=", " ", 
       RowBox[{
        RowBox[{"Last", "[", 
         RowBox[{"SortBy", "[", 
          RowBox[{"paths", ",", 
           RowBox[{
            RowBox[{"#", "[", "\"\<PathLength\>\"", "]"}], "&"}]}], "]"}], 
         "]"}], "[", "\"\<Path\>\"", "]"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "path", "]"}], "==", "0"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"Missing", "[", "\"\<No spanning path\>\"", "]"}], "]"}]}], 
       "]"}], ";", "\n", "path"}]}], "\n", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:50 (Local) \
In[334]:=",ExpressionUUID->"82855400-5408-449f-af68-370bf0c13ed9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"findEndPoints", "[", "g_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"acyclic", ",", "endPoints"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{"False", ",", 
         RowBox[{"Echo", "[", 
          RowBox[{"x", ",", "\"\<fEPt\>\""}], "]"}], ",", "x"}], "]"}]}], ";",
       "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCount", "[", "g", "]"}], "<=", " ", "1"}], ",", " ", 
        RowBox[{"Return", "[", 
         RowBox[{"VertexList", "[", "g", "]"}], "]"}]}], "]"}], ";", "\n", 
      RowBox[{"acyclic", " ", "=", " ", 
       RowBox[{"FindSpanningTree", "[", "g", "]"}]}], ";", "\n", 
      RowBox[{"endPoints", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"VertexList", "[", "acyclic", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"vertexEdgeCount", "[", 
            RowBox[{"acyclic", ",", "#"}], "]"}], "==", "1"}], "&"}]}], 
        "]"}]}], ";", "\n", "endPoints"}]}], "\n", "]"}]}], ";"}]], "Code",
 CellLabel->
  "2/14/21 17:16:50 (Local) \
In[335]:=",ExpressionUUID->"3707e896-ac90-41c5-bd63-2e31683bd266"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"findEdgePaths", "[", "g_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"acyclic", ",", "endPoints", ",", "paths", ",", "decho"}], 
      "}"}], ",", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{"False", ",", 
         RowBox[{"Echo", "[", 
          RowBox[{"x", ",", "\"\<fEP\>\""}], "]"}], ",", "x"}], "]"}]}], ";", 
      "\n", 
      RowBox[{"endPoints", " ", "=", " ", 
       RowBox[{"decho", "@", 
        RowBox[{"findEndPoints", "[", "g", "]"}]}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endPoints", "]"}], "<", "1"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"Missing", "[", "\"\<Missing path ends\>\"", "]"}], "]"}]}], 
       "]"}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endPoints", "]"}], "==", "1"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{
         "Missing", "[", "\"\<Couldn't construct spanning tree\>\"", "]"}], 
         "]"}]}], "]"}], ";", "\n", "\n", 
      RowBox[{"paths", " ", "=", " ", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"<|", 
           RowBox[{
            RowBox[{"\"\<Start\>\"", "->", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ",", 
            RowBox[{"\"\<End\>\"", "->", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], "|>"}], " ", "&"}], ",", 
         RowBox[{"Partition", "[", 
          RowBox[{"endPoints", ",", "2", ",", "1"}], "]"}]}], "]"}]}], ";", 
      RowBox[{"paths", " ", "=", " ", 
       RowBox[{"Map", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Append", "[", 
           RowBox[{"#", ",", 
            RowBox[{"\"\<Path\>\"", "->", " ", 
             RowBox[{"First", "@", 
              RowBox[{"FindPath", "[", 
               RowBox[{"g", ",", 
                RowBox[{"#", "[", "\"\<Start\>\"", "]"}], ",", 
                RowBox[{"#", "[", "\"\<End\>\"", "]"}]}], "]"}]}]}]}], "]"}], 
          "&"}], ",", "paths"}], "]"}]}], ";", 
      RowBox[{"paths", " ", "=", " ", 
       RowBox[{"Map", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Append", "[", 
           RowBox[{"#", ",", 
            RowBox[{"\"\<PathLength\>\"", "->", " ", 
             RowBox[{"Length", "@", 
              RowBox[{"#", "[", "\"\<Path\>\"", "]"}]}]}]}], "]"}], "&"}], 
         ",", "paths"}], "]"}]}], ";", "\n", "paths"}]}], "\n", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:50 (Local) \
In[336]:=",ExpressionUUID->"752f904d-5e31-44ab-914d-ea0b8146f2f7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"topologicalSortByLongestPaths", "[", "g_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"reducedGraph", ",", "path"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{
        RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
        RowBox[{"If", "[", 
         RowBox[{"False", ",", 
          RowBox[{"Echo", "[", 
           RowBox[{"x", ",", "\"\<fLPs\>\""}], "]"}], ",", "x"}], "]"}]}], 
       ";", "\n", 
       RowBox[{"path", " ", "=", " ", 
        RowBox[{"findLongestPath", "[", "g", "]"}]}], ";", "\n", 
       RowBox[{"reducedGraph", " ", "=", " ", 
        RowBox[{"ConnectedGraphComponents", "@", 
         RowBox[{"VertexDelete", "[", 
          RowBox[{"g", ",", "path"}], "]"}]}]}], ";", "\n", 
       RowBox[{"leftoverPaths", " ", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{"findLongestPath", ",", "reducedGraph"}], "]"}]}], ";", "\n", 
       RowBox[{"(*", " ", 
        RowBox[{
        "if", " ", "that", " ", "reduced", " ", "tree", " ", "still", " ", 
         "has", " ", "branches", " ", "we", " ", "wil", " ", "lose", " ", 
         "them"}], " ", "*)"}], "\n", 
       RowBox[{"Join", "[", 
        RowBox[{"path", ",", 
         RowBox[{"Join", "@@", "leftoverPaths"}]}], "]"}]}]}], "\n", "]"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"findSpanningPath", "[", 
    RowBox[{"meshAssociation_", ",", "undirectedGraph_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"acyclic", ",", "endPoints", ",", "path", ",", "decho"}], "}"}],
      ",", "\n", 
     RowBox[{"(*", " ", "fixable", " ", "*)"}], " ", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"decho", "[", "x_", "]"}], " ", ":=", " ", 
       RowBox[{"If", "[", 
        RowBox[{"False", ",", 
         RowBox[{"Echo", "[", 
          RowBox[{"x", ",", "\"\<fSPd\>\""}], "]"}]}], "]"}]}], ";", "\n", 
      RowBox[{"acyclic", " ", "=", " ", 
       RowBox[{"removeCyclicPoints", "[", "undirectedGraph", "]"}]}], ";", 
      "\n", "\n", 
      RowBox[{"endPoints", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"VertexList", "[", "acyclic", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"vertexEdgeCount", "[", 
            RowBox[{"acyclic", ",", "#"}], "]"}], "==", "1"}], "&"}]}], 
        "]"}]}], ";", "\n", 
      RowBox[{"endPoints", " ", "=", " ", 
       RowBox[{"SortBy", "[", 
        RowBox[{"endPoints", ",", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"meshPointRadius", "[", 
            RowBox[{"meshAssociation", ",", "#"}], "]"}]}], "&"}]}], "]"}]}], 
      ";", "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endPoints", "]"}], "<", "1"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"Missing", "[", "\"\<Missing path ends\>\"", "]"}], "]"}]}], 
       "]"}], ";", "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endPoints", "]"}], "==", "1"}], ",", "\n", 
        RowBox[{
         RowBox[{"decho", "[", 
          RowBox[{"{", 
           RowBox[{"\"\<No spanning tree for \>\"", ",", "acyclic"}], "}"}], 
          "]"}], ";", "\n", 
         RowBox[{"Return", "[", 
          RowBox[{
          "Missing", "[", "\"\<Couldn't construct spanning tree\>\"", "]"}], 
          "]"}]}]}], "]"}], ";", "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endPoints", "]"}], ">", "2"}], ",", 
        RowBox[{"endPoints", "=", 
         RowBox[{"Take", "[", 
          RowBox[{"endPoints", ",", "2"}], "]"}]}]}], "]"}], ";", "\n", "\n", 
      RowBox[{"path", " ", "=", " ", 
       RowBox[{"FindPath", "[", 
        RowBox[{"acyclic", ",", 
         RowBox[{"First", "[", "endPoints", "]"}], ",", 
         RowBox[{"Last", "[", "endPoints", "]"}]}], "]"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "path", "]"}], "==", "0"}], ",", "\n", 
        RowBox[{"path", " ", "=", " ", 
         RowBox[{"FindPath", "[", 
          RowBox[{"acyclic", ",", 
           RowBox[{"Last", "[", "endPoints", "]"}], ",", 
           RowBox[{"First", "[", "endPoints", "]"}]}], "]"}]}]}], "\n", "]"}],
       ";", "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "path", "]"}], "==", "0"}], ",", "\n", 
        RowBox[{"Return", "[", 
         RowBox[{"Missing", "[", "\"\<No spanning path\>\"", "]"}], "]"}]}], 
       "]"}], ";", "\n", 
      RowBox[{"Clear", "[", "decho", "]"}], ";", "\n", 
      RowBox[{"path", " ", "=", " ", 
       RowBox[{"First", "@", "path"}]}], ";", "\n", "path"}]}], "\n", "]"}]}],
   ";"}]}], "Code",
 CellLabel->
  "2/14/21 17:16:50 (Local) \
In[337]:=",ExpressionUUID->"e9b0a34e-a121-475f-a643-57550abc01f4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeDirectedParastichy", "[", 
    RowBox[{"meshAssociation_", ",", "parastichy_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"edgeList", ",", "path"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"edgeList", " ", "=", " ", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"List", ",", 
            RowBox[{"{", "#", "}"}], ",", 
            RowBox[{"Intersection", "[", 
             RowBox[{"parastichy", ",", 
              RowBox[{
               RowBox[{"meshAssociation", "[", "\"\<Adjacency\>\"", "]"}], 
               "[", "#", "]"}]}], "]"}]}], "}"}], "&"}], ",", "parastichy"}], 
        "]"}]}], ";", "\n", 
      RowBox[{"edgeList", " ", "=", " ", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Sort", " ", "/@", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Apply", "[", 
               RowBox[{"Outer", ",", "#"}], "]"}], "&"}], ",", "edgeList"}], 
            "]"}], ",", "2"}], "]"}]}], "]"}]}], ";", "\n", 
      RowBox[{"edgeList", " ", "=", " ", 
       RowBox[{"Map", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], " ", "\[UndirectedEdge]", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], " ", "&"}], ",", " ", 
         "edgeList"}], "]"}]}], ";", "\n", 
      RowBox[{"path", "  ", "=", " ", 
       RowBox[{"findSpanningPath", "[", 
        RowBox[{"meshAssociation", ",", " ", 
         RowBox[{"Graph", "[", "edgeList", "]"}]}], "]"}]}], ";", "\n", 
      "path"}]}], "\n", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:50 (Local) \
In[339]:=",ExpressionUUID->"70bf3f1a-54dc-4bc3-9028-1c5fb201242e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeDirectedPath", "[", 
     RowBox[{"meshAssociation_", ",", "component_"}], "]"}], " ", ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"path", ",", "acyclic", ",", "res"}], "}"}], ",", "\n", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "given", " ", "an", " ", "undirected", " ", "graph", " ", "which", 
         " ", "is", " ", "mainly", " ", "a", " ", "single", " ", "path"}], 
        " ", ",", " ", 
        RowBox[{
        "return", " ", "the", " ", "directed", " ", "graph", " ", "with", " ",
          "outer", " ", "point", " ", "at", " ", "head"}]}], " ", "*)"}], 
      RowBox[{
       RowBox[{"acyclic", " ", "=", " ", 
        RowBox[{"removeCyclicPoints", "[", "component", "]"}]}], ";", 
       RowBox[{"path", " ", "=", " ", 
        RowBox[{"findSpanningPath", "[", 
         RowBox[{"meshAssociation", ",", "acyclic"}], "]"}]}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MissingQ", "[", "path", "]"}], ",", 
         RowBox[{"Return", "[", "path", "]"}]}], "]"}], ";", 
       RowBox[{"path", " ", "=", " ", 
        RowBox[{"Partition", "[", 
         RowBox[{"path", ",", "2", ",", "1"}], "]"}]}], ";", 
       RowBox[{"res", "=", " ", 
        RowBox[{"EdgeDelete", "[", 
         RowBox[{"acyclic", ",", 
          RowBox[{"EdgeList", "[", "acyclic", "]"}]}], "]"}]}], ";", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"EdgeAdd", "[", 
         RowBox[{"res", ",", 
          RowBox[{"DirectedEdge", " ", "@@@", " ", "path"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "res"}]}], "\n", "]"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"directedPathHead", "[", "component_", "]"}], " ", ":=", "  ", 
   RowBox[{"First", "@", 
    RowBox[{"TopologicalSort", "[", "component", "]"}]}]}], ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"3f1b1063-c893-4c9a-abf7-831c9e8274e1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshPointRadius", "[", 
     RowBox[{"mesh_MeshRegion", ",", "ix_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"c", ",", "p"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"c", " ", "=", " ", 
        RowBox[{"RegionCentroid", "[", "mesh", "]"}]}], ";", "\n", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"meshCoordinates", "[", 
         RowBox[{"mesh", ",", "ix"}], "]"}]}], ";", "\n", 
       RowBox[{"Norm", "[", 
        RowBox[{"(", 
         RowBox[{"c", "-", "p"}], ")"}], "]"}]}]}], "\n", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshPointRadius", "[", 
    RowBox[{"meshAssociation_Association", ",", "ix_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"meshPointRadius", "[", 
    RowBox[{
     RowBox[{"meshAssociation", "[", "\"\<Mesh\>\"", "]"}], ",", "ix"}], 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"vertexAngle", "[", 
    RowBox[{"meshAssociation_", ",", "component_", ",", "vertex_"}], "]"}], 
   " ", ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"incidence", ",", "inPair", ",", "outPair", ",", "ix123"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"incidence", " ", "=", " ", 
       RowBox[{"IncidenceList", "[", 
        RowBox[{"component", ",", "vertex"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "incidence", "]"}], "==", "0"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"Missing", "[", "\"\<Can't find incidence\>\"", "]"}], 
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "incidence", "]"}], "==", "1"}], ",", 
        RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "incidence", "]"}], " ", ">", " ", "2"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"Missing", "[", "\"\<Too many incidences\>\"", "]"}], 
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"inPair", " ", "=", " ", 
       RowBox[{"First", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{"incidence", ",", " ", 
          RowBox[{"_", " ", "\[DirectedEdge]", " ", "vertex"}]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"outPair", " ", "=", " ", 
       RowBox[{"First", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{"incidence", ",", " ", 
          RowBox[{"vertex", " ", "\[DirectedEdge]", " ", "_"}]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ix123", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"First", "[", "inPair", "]"}], ",", 
         RowBox[{"First", "[", "outPair", "]"}], ",", 
         RowBox[{"Last", "[", "outPair", "]"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"meshLineDeviation", "[", 
       RowBox[{"meshAssociation", ",", "ix123"}], "]"}]}]}], "\n", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:20:07 (Local) \
In[358]:=",ExpressionUUID->"23e910ed-a1dc-4ea0-ae8e-0daf1b70bad7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"splitAtKinks", "[", 
    RowBox[{"meshAssociation_", ",", "component_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"angles", ",", "res", ",", "kinks", ",", "edgesToDrop"}], "}"}],
      ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
      "component", " ", "is", " ", "an", " ", "unforked", " ", "directed", 
       " ", "path", " ", "with", " ", "one", " ", "element"}], " ", "*)"}], 
     RowBox[{
      RowBox[{"angles", " ", "=", " ", 
       RowBox[{"Association", "@", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "->", 
            RowBox[{"vertexAngle", "[", 
             RowBox[{"meshAssociation", ",", "component", ",", "#"}], "]"}]}],
            "&"}], ",", "\n", "\t\t", 
          RowBox[{"VertexList", "[", "component", "]"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kinks", " ", "=", " ", 
       RowBox[{"Keys", "@", 
        RowBox[{"Select", "[", 
         RowBox[{"angles", ",", "\n", "\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", "#", "]"}], " ", ">", 
            RowBox[{
            "locateParastichyOptions", "[", 
             "\"\<StraightnessWhenAdjacent\>\"", "]"}]}], "&"}]}], "]"}]}]}], 
      ";", 
      RowBox[{"edgesToDrop", " ", "=", " ", 
       RowBox[{"Map", "[", "\n", "\t", 
        RowBox[{
         RowBox[{
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"IncidenceList", "[", 
             RowBox[{"component", ",", "#"}], "]"}], ",", 
            RowBox[{"#", "\[DirectedEdge]", " ", "_"}]}], "]"}], "&"}], ",", 
         "kinks"}], "]"}]}], ";", 
      RowBox[{"res", " ", "=", " ", "component"}], ";", "\n", "\t", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"EdgeDelete", "[", 
        RowBox[{"res", ",", 
         RowBox[{"Flatten", "@", "edgesToDrop"}]}], "]"}]}], ";", 
      RowBox[{"res", "  ", "=", 
       RowBox[{"connectedDirectedGraphComponents", "[", "res", "]"}]}], ";", 
      "\n", "\t", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{"res", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"VertexCount", "[", "#", "]"}], ">", "  ", 
           RowBox[{
           "locateParastichyOptions", "[", "\"\<MinimumThreadLength\>\"", 
            "]"}]}], "&"}]}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"Return", "[", "res", "]"}], ";"}]}], "\n", "\n", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "2/14/21 17:16:50 (Local) \
In[343]:=",ExpressionUUID->"bec8a550-880d-4270-b994-1ee9f1cc4e8b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"eDeleteEdge", "[", 
     RowBox[{"g_Graph", ",", "edge_"}], "]"}], " ", ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"EdgeQ", "[", 
       RowBox[{"g", ",", "edge"}], "]"}], ",", 
      RowBox[{"EdgeDelete", "[", 
       RowBox[{"g", ",", "edge"}], "]"}], ",", "g"}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"eDelete", "[", 
     RowBox[{"comp_", ",", "edges_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"g", ",", "i"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"g", "=", "comp"}], ";", "\n", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "<=", " ", 
          RowBox[{"Length", "[", "edges", "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\n", 
         RowBox[{"g", " ", "=", " ", 
          RowBox[{"eDeleteEdge", "[", 
           RowBox[{"g", ",", 
            RowBox[{"edges", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}]}], "\n", "]"}], ";", 
       "\n", "g"}]}], "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"connectedDirectedGraphComponents", "[", "g_", "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"edges", ",", "flip", ",", "res"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"edges", " ", "=", " ", 
       RowBox[{"EdgeList", "[", "g", "]"}]}], ";", "\n", 
      RowBox[{
       RowBox[{"flip", "[", " ", 
        RowBox[{"a_", " ", "\[DirectedEdge]", " ", "b_"}], " ", "]"}], " ", ":=",
        " ", 
       RowBox[{"b", " ", "\[DirectedEdge]", " ", "a"}]}], ";", "\n", 
      RowBox[{"edges", " ", "=", " ", 
       RowBox[{"Map", "[", 
        RowBox[{"flip", ",", "edges"}], "]"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MissingQ", "[", "edges", "]"}], ",", 
        RowBox[{"Echo", "[", 
         RowBox[{"\"\< Missing edges \>\"", ",", " ", 
          RowBox[{"Stack", "[", "]"}]}], "]"}]}], "]"}], ";", "\n", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"EdgeAdd", "[", 
        RowBox[{"g", ",", "edges"}], "]"}]}], ";", "\n", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"eDelete", "[", 
          RowBox[{"#", ",", "edges"}], "]"}], "&"}], ",", "\n", 
        RowBox[{"ConnectedGraphComponents", "[", "res", "]"}]}], "]"}]}]}], 
    "\n", "]"}]}], ";"}]}], "Code",
 CellLabel->
  "2/14/21 17:16:50 (Local) \
In[344]:=",ExpressionUUID->"84d878d6-dd33-4fb8-a10a-037275e2a40e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"adjacencyGraph", "[", 
     RowBox[{"meshAssociation_", ",", "vertexes_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "g", ",", "edges", ",", "edge", ",", "adjacencies", ",", 
        "vertexCoordinates"}], "}"}], ",", "\n", "\n", 
      RowBox[{
       RowBox[{"adjacencies", "=", " ", 
        RowBox[{"KeyTake", "[", 
         RowBox[{
          RowBox[{"meshAssociation", "[", "\"\<Adjacency\>\"", "]"}], ",", 
          "vertexes"}], "]"}]}], ";", 
       RowBox[{"adjacencies", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Intersection", "[", 
            RowBox[{"vertexes", ",", "#"}], "]"}], "&"}], ",", 
          "adjacencies"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"makeSortedEdge", "[", 
         RowBox[{"v1_", ",", "v2_"}], "]"}], " ", ":=", " ", 
        RowBox[{"UndirectedEdge", " ", "@@", " ", 
         RowBox[{"Sort", "[", 
          RowBox[{"{", 
           RowBox[{"v1", ",", "v2"}], "}"}], "]"}]}]}], ";", "\n", 
       RowBox[{
        RowBox[{"edge", "[", 
         RowBox[{"k_", ",", "v_"}], "]"}], " ", ":=", " ", 
        RowBox[{"Map", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"makeSortedEdge", "[", 
            RowBox[{"k", ",", "#"}], "]"}], "&"}], ",", "v"}], "]"}]}], ";", 
       RowBox[{"edges", " ", "=", 
        RowBox[{"DeleteDuplicates", "@", 
         RowBox[{"Flatten", "[", 
          RowBox[{"KeyValueMap", "[", 
           RowBox[{"edge", ",", "adjacencies"}], "]"}], "]"}]}]}], ";", "\n", 
       "\n", 
       RowBox[{"vertexCoordinates", " ", ":=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"meshCoordinates", "[", 
            RowBox[{
             RowBox[{"meshAssociation", "[", "\"\<Mesh\>\"", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "#"}], "}"}]}], "]"}], "&"}], ",", 
          "vertexes"}], "]"}]}], " ", ";", 
       RowBox[{"g", "  ", "=", " ", 
        RowBox[{"Graph", "[", 
         RowBox[{"vertexes", ",", "edges", ",", 
          RowBox[{"VertexLabels", " ", "->", " ", "\"\<Name\>\""}], ",", "\n",
           " ", 
          RowBox[{
          "VertexCoordinates", " ", "->", " ", "vertexCoordinates"}]}], 
         "]"}]}], ";", "\n", "g"}]}], "\n", "]"}]}], ";"}], "\n"}]], "Code",
 CellLabel->
  "2/14/21 17:16:50 (Local) \
In[347]:=",ExpressionUUID->"edad16cf-609c-4d48-8f5d-f38a880f72cc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"polygonsAtVertex", "[", 
    RowBox[{"g_", ",", "v_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "edges", "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"edges", " ", "=", " ", 
       RowBox[{"EdgeList", "@", 
        RowBox[{"NeighborhoodGraph", "[", 
         RowBox[{"g", ",", "v"}], "]"}]}]}], ";", "\n", 
      RowBox[{"edges", " ", "=", " ", 
       RowBox[{"Cases", "[", 
        RowBox[{"edges", ",", 
         RowBox[{"Except", "[", " ", 
          RowBox[{
           RowBox[{"_", " ", "\[UndirectedEdge]", " ", "v"}], " ", "|", " ", 
           RowBox[{"v", " ", "\[UndirectedEdge]", " ", "_"}]}], "]"}]}], 
        "]"}]}], ";", "\n", 
      RowBox[{"edges", "  ", "=", " ", 
       RowBox[{"Apply", "[", 
        RowBox[{"List", ",", "edges", ",", "1"}], "]"}]}], ";", "\n", 
      RowBox[{"edges", " ", "=", " ", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Polygon", "@", 
           RowBox[{"Append", "[", 
            RowBox[{"#", ",", "v"}], "]"}]}], "&"}], ",", "edges"}], "]"}]}], 
      ";", "\n", "edges"}]}], " ", "\n", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"graphToMesh", "[", "g_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"meshPoints", ",", "meshPolygons", ",", "mesh"}], "}"}], ",", 
      "\n", 
      RowBox[{
       RowBox[{"meshPoints", " ", "=", " ", 
        RowBox[{"AnnotationValue", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"g", ",", 
            RowBox[{"VertexList", "[", "g", "]"}]}], "}"}], ",", 
          "VertexCoordinates"}], "]"}]}], ";", "\n", 
       RowBox[{"meshPolygons", " ", "=", " ", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"polygonsAtVertex", "[", 
             RowBox[{"g", ",", "#"}], "]"}], "&"}], ",", 
           RowBox[{"VertexList", "[", "g", "]"}]}], "]"}]}]}], ";", "\n", 
       RowBox[{"mesh", " ", "=", " ", 
        RowBox[{"MeshRegion", "[", 
         RowBox[{"meshPoints", ",", "meshPolygons"}], "]"}]}], ";", "\n", 
       RowBox[{"{", 
        RowBox[{"meshPoints", ",", "meshPolygons"}], "}"}]}]}], "\n", "]"}]}],
    ";"}], "\n", "\n"}], "\n"}], "Code",
 CellLabel->
  "2/14/21 17:16:50 (Local) \
In[348]:=",ExpressionUUID->"7d934c07-76a0-4a5f-9037-ee7523bc7b4d"]
},
WindowSize->{1150.5, 825.75},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
WindowStatusArea->"",
TaggingRules->{
 "WelcomeScreenSettings" -> {"FEStarting" -> False}, 
  "CodeFormatter" -> {
   "ToolbarState" -> True, "ToolbarAccentColor" -> 
    RGBColor[0.1411764705882353, 0.592156862745098, 0.7176470588235294]}},
FrontEndVersion->"12.2 for Microsoft Windows (64-bit) (December 12, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"e85e8579-a274-4676-96a5-47167c9968b5"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 1308, 35, 282, "Code",ExpressionUUID->"c6c4cce2-bc28-4439-ae0d-6afb0daf69fe"],
Cell[1869, 57, 6262, 143, 777, "Code",ExpressionUUID->"545f80d8-56e3-47b6-8060-3a2155b76023"],
Cell[8134, 202, 207, 5, 63, "Code",ExpressionUUID->"5cb0906a-7fd6-41ca-bd93-01a456c28bc8"],
Cell[8344, 209, 11378, 314, 1133, "Code",ExpressionUUID->"266cd5b1-2123-4b41-8621-e7480adb92fc"],
Cell[19725, 525, 2209, 55, 283, "Input",ExpressionUUID->"d3f2d60d-4435-48a4-be52-8b86c3b6f85d",
 InitializationCell->True],
Cell[21937, 582, 7017, 166, 658, "Input",ExpressionUUID->"d27eb31f-9685-4b44-b6ca-9d98105f73e6",
 InitializationCell->True],
Cell[28957, 750, 2483, 59, 377, "Input",ExpressionUUID->"6f079890-0c30-49f9-a923-bceb2e315ea5",
 InitializationCell->True],
Cell[31443, 811, 3310, 79, 302, "Input",ExpressionUUID->"756f00cc-3755-454d-a208-247637ce9458",
 InitializationCell->True],
Cell[34756, 892, 2518, 63, 283, "Input",ExpressionUUID->"1d014996-9baf-42c8-a2cc-89ac1bc48b8e",
 InitializationCell->True],
Cell[37277, 957, 2238, 54, 302, "Input",ExpressionUUID->"aa52782f-2f77-4f6d-b567-77af59b4375b",
 InitializationCell->True],
Cell[39518, 1013, 902, 27, 100, "Code",ExpressionUUID->"dbb63815-f69a-4a96-bfec-9b2f1f193c64"],
Cell[40423, 1042, 1910, 52, 224, "Code",ExpressionUUID->"c85247cb-971b-4af8-acc6-d28716b5ddbf"],
Cell[42336, 1096, 5439, 144, 652, "Code",ExpressionUUID->"8d91e29a-16bb-4df2-99a4-fcf8eb6bdae2"],
Cell[47778, 1242, 3226, 85, 395, "Input",ExpressionUUID->"e051c6ea-9b7a-4344-afed-0ec63275c8f0",
 InitializationCell->True],
Cell[51007, 1329, 17932, 461, 1240, "Code",ExpressionUUID->"76ea223f-8c2c-4947-9ea8-ff05b8f82dd0"],
Cell[68942, 1792, 2547, 60, 358, "Input",ExpressionUUID->"66768435-00b5-4a9d-92b3-461e76c140f5",
 InitializationCell->True],
Cell[71492, 1854, 1764, 43, 227, "Input",ExpressionUUID->"322c5088-f8d9-44cb-b112-dc5e4d3df686",
 InitializationCell->True],
Cell[73259, 1899, 3191, 87, 367, "Code",ExpressionUUID->"be645f4a-1ec5-42a2-a97d-351d1dab3f71"],
Cell[76453, 1988, 3109, 73, 358, "Input",ExpressionUUID->"c1ab1a61-6202-4858-9b27-ab224e963ebe",
 InitializationCell->True],
Cell[79565, 2063, 2325, 56, 395, "Input",ExpressionUUID->"bd123bb0-00cd-4325-b748-3131e98f621a",
 InitializationCell->True],
Cell[81893, 2121, 1585, 42, 189, "Input",ExpressionUUID->"82855400-5408-449f-af68-370bf0c13ed9",
 InitializationCell->True],
Cell[83481, 2165, 1333, 35, 171, "Code",ExpressionUUID->"3707e896-ac90-41c5-bd63-2e31683bd266"],
Cell[84817, 2202, 2851, 76, 245, "Input",ExpressionUUID->"752f904d-5e31-44ab-914d-ea0b8146f2f7",
 InitializationCell->True],
Cell[87671, 2280, 5015, 128, 687, "Code",ExpressionUUID->"e9b0a34e-a121-475f-a643-57550abc01f4"],
Cell[92689, 2410, 1970, 52, 170, "Input",ExpressionUUID->"70bf3f1a-54dc-4bc3-9028-1c5fb201242e",
 InitializationCell->True],
Cell[94662, 2464, 2008, 48, 251, "Input",ExpressionUUID->"3f1b1063-c893-4c9a-abf7-831c9e8274e1",
 InitializationCell->True],
Cell[96673, 2514, 3336, 89, 377, "Input",ExpressionUUID->"23e910ed-a1dc-4ea0-ae8e-0daf1b70bad7",
 InitializationCell->True],
Cell[100012, 2605, 2677, 69, 245, "Input",ExpressionUUID->"bec8a550-880d-4270-b994-1ee9f1cc4e8b",
 InitializationCell->True],
Cell[102692, 2676, 2621, 73, 385, "Code",ExpressionUUID->"84d878d6-dd33-4fb8-a10a-037275e2a40e"],
Cell[105316, 2751, 2562, 66, 242, "Code",ExpressionUUID->"edad16cf-609c-4d48-8f5d-f38a880f72cc"],
Cell[107881, 2819, 2463, 65, 332, "Code",ExpressionUUID->"7d934c07-76a0-4a5f-9037-ee7523bc7b4d"]
}
]
*)

