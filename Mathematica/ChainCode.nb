(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     30767,        746]
NotebookOptionsPosition[     29943,        722]
NotebookOutlinePosition[     30413,        740]
CellTagsIndexPosition[     30370,        737]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SetOptions", "[", 
    RowBox[{
     RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
     RowBox[{"AutoGeneratedPackage", "->", "Automatic"}]}], "]"}], ";"}], 
  "\n"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[952]:=",ExpressionUUID->"7d77eaad-7cce-48eb-b198-8dc4dd759adc"],

Cell[CellGroupData[{

Cell["Chain code", "Section",
 CellChangeTimes->{{3.8595354332704773`*^9, 
  3.8595354401520576`*^9}},ExpressionUUID->"6ab48122-af17-4dcf-b0ec-\
7c9b2b450180"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"diskZ", "[", 
      RowBox[{"Disk", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_", ",", "z_"}], "}"}], ",", "_"}], "]"}], "]"}], " ", ":=",
      " ", "z"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"diskX", "[", 
      RowBox[{"Disk", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x_", ",", "_"}], "}"}], ",", "_"}], "]"}], "]"}], " ", ":=",
      " ", "x"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"diskXZ", "[", 
      RowBox[{"Disk", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x_", ",", "z_"}], "}"}], ",", "_"}], "]"}], "]"}], " ", ":=",
      " ", 
     RowBox[{"{", 
      RowBox[{"x", ",", "z"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"diskRightX", "[", 
      RowBox[{"Disk", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x_", ",", "_"}], "}"}], ",", "r_"}], "]"}], "]"}], " ", ":=",
      " ", 
     RowBox[{"x", "+", "r"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"diskLeftX", "[", 
      RowBox[{"Disk", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x_", ",", "_"}], "}"}], ",", "r_"}], "]"}], "]"}], " ", ":=",
      " ", 
     RowBox[{"x", "-", "r"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"moveDiskRight", "[", 
      RowBox[{"Disk", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x_", ",", "z_"}], "}"}], ",", "r_"}], "]"}], "]"}], " ", ":=",
      "\[IndentingNewLine]", 
     RowBox[{"Disk", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"x", "+", "1"}], ",", "z"}], "}"}], ",", "r"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"moveDiskLeft", "[", 
      RowBox[{"Disk", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x_", ",", "z_"}], "}"}], ",", "r_"}], "]"}], "]"}], " ", ":=",
      "\[IndentingNewLine]", 
     RowBox[{"Disk", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"x", "-", "1"}], ",", "z"}], "}"}], ",", "r"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"getDisk", "[", 
      RowBox[{"n_", ",", "run_"}], "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"run", "[", "\"\<CurrentDisks\>\"", "]"}], "[", "n", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"getDisk", "[", 
      RowBox[{
       RowBox[{"right", "[", "n_", "]"}], ",", "run_"}], "]"}], " ", ":=", 
     " ", 
     RowBox[{"moveDiskRight", "[", 
      RowBox[{"getDisk", "[", 
       RowBox[{"n", ",", "run"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"diskAndVisibleCopies", "[", 
      RowBox[{"Disk", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x_", ",", "z_"}], "}"}], ",", "r_"}], "]"}], "]"}], " ", ":=",
      " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Disk", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "z"}], "}"}], ",", "r"}], "]"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"x", "+", "r"}], ">", 
          RowBox[{"1", "/", "2"}]}], ",", 
         RowBox[{"moveDiskLeft", "[", 
          RowBox[{"Disk", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x", ",", "z"}], "}"}], ",", "r"}], "]"}], "]"}], ",", 
         RowBox[{"Nothing", "[", "]"}]}], "]"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"x", "-", "r"}], "<", 
          RowBox[{
           RowBox[{"-", "1"}], "/", "2"}]}], ",", 
         RowBox[{"moveDiskRight", "[", 
          RowBox[{"Disk", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x", ",", "z"}], "}"}], ",", "r"}], "]"}], "]"}], ",", 
         RowBox[{"Nothing", "[", "]"}]}], "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"nextRadius", "[", "run_", "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "highestZ", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"highestZ", "=", 
         RowBox[{"Max", "@", 
          RowBox[{"Map", "[", 
           RowBox[{"diskZ", ",", 
            RowBox[{"Values", "@", 
             RowBox[{"run", "[", "\"\<CurrentDisks\>\"", "]"}]}]}], "]"}]}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"run", "[", "\"\<Arena\>\"", "]"}], "[", 
          "\"\<rFunction\>\"", "]"}], "[", "highestZ", "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"nextDiskNumber", "[", "run_", "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"Max", "@", 
       RowBox[{"Keys", "[", 
        RowBox[{"run", "[", "\"\<CurrentDisks\>\"", "]"}], "]"}]}], "+", 
      "1"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"initializeChainRun", "[", "run_", "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nextR", ",", "extendedDisks", ",", "res"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"extendedDisks", "=", " ", 
         RowBox[{"run", "[", "\"\<CurrentDisks\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"nextR", "=", " ", 
         RowBox[{"nextRadius", "[", "run", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"disksMightOverlap", " ", "=", " ", 
         RowBox[{"Select", "[", 
          RowBox[{"extendedDisks", ",", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"diskX", "[", "#", "]"}], "+", "1"}], "<=", " ", 
             RowBox[{
              RowBox[{"1", "/", "2"}], "+", "nextR"}]}], " ", "&"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"disksMightOverlap", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Normal", "@", "extendedDisks"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"KeyValueMap", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"right", "[", "#1", "]"}], "->", " ", 
               RowBox[{"moveDiskRight", "[", "#2", "]"}]}], "&"}], ",", 
             "disksMightOverlap"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"rightPossible", "[", " ", 
          RowBox[{"n_", "->", " ", "d_Disk"}], "]"}], " ", ":=", " ", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", "f", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"f", "[", "x_", "]"}], " ", ":=", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"diskX", "[", 
                RowBox[{"x", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}], ">", 
               RowBox[{"diskX", "[", "d", "]"}]}], " ", "&&", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"diskRightX", "[", "d", "]"}], "+", 
                RowBox[{"2", "*", "nextR"}]}], " ", ">=", " ", 
               RowBox[{"diskLeftX", "[", 
                RowBox[{"x", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"n", ",", 
                 RowBox[{"First", "[", "#", "]"}]}], "}"}], "&"}], ",", 
              RowBox[{"Select", "[", " ", 
               RowBox[{"disksMightOverlap", ",", "f"}], "]"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"possibleOverlaps", " ", "=", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{"rightPossible", ",", "disksMightOverlap"}], "]"}], ",", 
           "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"res", "=", "run"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", "[", "\"\<CurrentOverlaps\>\"", "]"}], "=", " ", 
         "possibleOverlaps"}], ";", "\[IndentingNewLine]", "res"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"setGraphCoordinates", "[", "run_", "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"res", ",", "g", ",", "nxy"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"res", " ", "=", " ", "run"}], ";", "\[IndentingNewLine]", 
        RowBox[{"g", "=", " ", 
         RowBox[{"res", "[", "\"\<ContactGraph\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"nxy", "[", "n_", "]"}], " ", ":=", " ", 
         RowBox[{"diskXZ", "@", 
          RowBox[{"getDisk", "[", 
           RowBox[{"n", ",", "res"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"g", " ", "=", " ", 
         RowBox[{"Graph", "[", 
          RowBox[{"g", ",", 
           RowBox[{"VertexCoordinates", "->", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "->", 
                RowBox[{"nxy", "[", "#", "]"}]}], "&"}], ",", 
              RowBox[{"VertexList", "[", "g", "]"}]}], "]"}]}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"g", " ", "=", " ", 
         RowBox[{"Graph", "[", 
          RowBox[{"g", ",", 
           RowBox[{"PlotTheme", "\[Rule]", "\"\<Labeled\>\""}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", "[", "\"\<ContactGraph\>\"", "]"}], "=", "g"}], ";", 
        "\[IndentingNewLine]", "res"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"addNextDisk", "[", "run_", "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"next", ",", "path", ",", "n", ",", "g"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"next", "=", 
         RowBox[{"findNextDisk", "[", "run", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n", "=", " ", 
         RowBox[{"nextDiskNumber", "[", "run", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"res", "=", " ", "run"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", "[", "\"\<CurrentDisks\>\"", "]"}], " ", "=", " ", 
         RowBox[{"Append", "[", 
          RowBox[{
           RowBox[{"res", "[", "\"\<CurrentDisks\>\"", "]"}], ",", 
           RowBox[{"n", "->", 
            RowBox[{"next", "[", "\"\<Disk\>\"", "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", "[", "\"\<ActiveDisks\>\"", "]"}], " ", "=", " ", 
         RowBox[{"Append", "[", 
          RowBox[{
           RowBox[{"res", "[", "\"\<ActiveDisks\>\"", "]"}], ",", "n"}], 
          "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", "[", "\"\<CurrentChain\>\"", "]"}], " ", "=", " ", 
         RowBox[{"Append", "[", 
          RowBox[{
           RowBox[{"res", "[", "\"\<CurrentChain\>\"", "]"}], ",", "n"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", "[", "\"\<CurrentChain\>\"", "]"}], " ", "=", " ", 
         RowBox[{"SortBy", "[", 
          RowBox[{
           RowBox[{"res", "[", "\"\<CurrentChain\>\"", "]"}], " ", ",", 
           RowBox[{
            RowBox[{"diskX", "[", 
             RowBox[{"getDisk", "[", 
              RowBox[{"#", ",", "res"}], "]"}], "]"}], "&"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"g", " ", "=", " ", 
         RowBox[{"res", "[", "\"\<ContactGraph\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"path", "=", " ", 
         RowBox[{"FindShortestPath", "[", 
          RowBox[{"g", ",", 
           RowBox[{
            RowBox[{"next", "[", "\"\<RestsOn\>\"", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"next", "[", "\"\<RestsOn\>\"", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pathPairs", " ", "=", " ", 
         RowBox[{"Partition", "[", 
          RowBox[{"path", ",", "2", ",", "1"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"g", " ", "=", "  ", 
         RowBox[{"EdgeDelete", "[", 
          RowBox[{"g", ",", 
           RowBox[{"UndirectedEdge", "@@@", "pathPairs"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"g", "=", " ", 
         RowBox[{"EdgeAdd", "[", 
          RowBox[{"g", ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"next", "[", "\"\<RestsOn\>\"", "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], " ", "\[UndirectedEdge]", " ", 
              "n"}], ",", "\[IndentingNewLine]", 
             RowBox[{"n", " ", "\[UndirectedEdge]", " ", 
              RowBox[{
               RowBox[{"next", "[", "\"\<RestsOn\>\"", "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], " ", "}"}]}], "]"}]}], ";",
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", "[", "\"\<ContactGraph\>\"", "]"}], "=", "g"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"res", " ", "=", " ", 
         RowBox[{"setGraphCoordinates", "[", "res", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", "[", "\"\<CurrentOverlaps\>\"", "]"}], " ", "=", " ", 
         RowBox[{"Select", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"res", "[", "\"\<CurrentOverlaps\>\"", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Not", "[", " ", 
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{"path", ",", 
                RowBox[{"First", "[", "#", "]"}]}], "]"}], "&&", " ", 
              RowBox[{"MemberQ", "[", 
               RowBox[{"path", ",", 
                RowBox[{"Last", "[", "#", "]"}]}], "]"}]}], " ", "]"}], 
            "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", "[", "\"\<CurrentOverlaps\>\"", "]"}], "=", " ", 
         RowBox[{"Join", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"res", "[", "\"\<CurrentOverlaps\>\"", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"next", "[", "\"\<RestsOn\>\"", "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "n"}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"n", ",", 
               RowBox[{
                RowBox[{"next", "[", "\"\<RestsOn\>\"", "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "res"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"findNextDisk", "[", "run_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "nextR", ",", "locations", ",", "nextPair", ",", "nextCentre"}], "}"}],
       ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nextR", "=", " ", 
        RowBox[{"N", "@", 
         RowBox[{"nextRadius", "[", "run", "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"locations", " ", "=", " ", 
        RowBox[{"Association", "@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "->", 
             RowBox[{"overlapLocations", "[", 
              RowBox[{"#", ",", "nextR", ",", "run"}], "]"}]}], "&"}], ",", 
           RowBox[{"run", "[", "\"\<CurrentOverlaps\>\"", "]"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"locations", " ", "=", " ", 
        RowBox[{"DeleteMissing", "[", "locations", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"locations", "=", " ", 
        RowBox[{"List", "@@", 
         RowBox[{"First", "@", 
          RowBox[{"Normal", "@", 
           RowBox[{"Sort", "@", "locations"}]}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"nextPair", ",", "nextCentre"}], "}"}], "=", "locations"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<Disk\>\"", "->", 
           RowBox[{"Disk", "[", 
            RowBox[{"nextCentre", ",", "nextR"}], "]"}]}], ",", 
          RowBox[{"\"\<RestsOn\>\"", "->", "nextPair"}]}], "|>"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"overlapLocations", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n1_", ",", "n2_"}], "}"}], ",", "r_", ",", "run_"}], "]"}], 
     " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"diskdiskUpperTouchingPoint", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"getDisk", "[", 
            RowBox[{"n1", ",", "run"}], "]"}], ",", 
           RowBox[{"getDisk", "[", 
            RowBox[{"n2", ",", "run"}], "]"}]}], "}"}], ",", "r"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8595355232689533`*^9, 3.859535548507656*^9}, {
   3.8595355812605634`*^9, 3.8595356039837217`*^9}, 3.859535980427695*^9, {
   3.859537787961735*^9, 3.8595378166902814`*^9}, {3.8595378709849052`*^9, 
   3.8595378746659107`*^9}, {3.859548408766249*^9, 3.859548693435357*^9}, {
   3.8595487252177143`*^9, 3.8595487384123473`*^9}, {3.8595487837338943`*^9, 
   3.859548787225625*^9}, {3.8595491546797457`*^9, 3.8595494001917853`*^9}, {
   3.8595494501740446`*^9, 3.859549673906193*^9}, {3.8595497211610394`*^9, 
   3.859549803463643*^9}, {3.859549845328841*^9, 3.8595498883756323`*^9}, {
   3.859549930705818*^9, 3.8595499353586044`*^9}, {3.859550030796769*^9, 
   3.8595501741262956`*^9}, {3.8595502262812786`*^9, 3.859550412498247*^9}, {
   3.859550443832056*^9, 3.859550494098281*^9}, {3.8595505397155266`*^9, 
   3.859550547454463*^9}, {3.85955070979223*^9, 3.8595507836269436`*^9}, {
   3.8595508136598835`*^9, 3.8595509504636335`*^9}, {3.8595509811128488`*^9, 
   3.8595512599373693`*^9}, {3.859551304158172*^9, 3.8595513453854275`*^9}, {
   3.859551385384552*^9, 3.8595515088071985`*^9}, {3.8595515447332945`*^9, 
   3.8595515614999976`*^9}, {3.8595515950630026`*^9, 
   3.8595516578334994`*^9}, {3.8595516932079616`*^9, 
   3.8595517507798724`*^9}, {3.859551797128462*^9, 3.8595517976263065`*^9}, {
   3.8595518324398346`*^9, 3.859551880416995*^9}, {3.8595519137728386`*^9, 
   3.859551970693408*^9}, {3.85955213640696*^9, 3.859552186595783*^9}, 
   3.8595522234488077`*^9, {3.859552261174758*^9, 3.859552426402605*^9}, {
   3.859552457238233*^9, 3.859552487979121*^9}, {3.8595525499163485`*^9, 
   3.859552550868485*^9}, {3.859552597707198*^9, 3.8595530395370884`*^9}, {
   3.85955315670238*^9, 3.85955324310651*^9}, {3.859553337061211*^9, 
   3.8595535638123627`*^9}, {3.8595537406967225`*^9, 
   3.8595538067525034`*^9}, {3.8595542024270816`*^9, 
   3.8595542740313644`*^9}, {3.8595544170603085`*^9, 
   3.8595544261811695`*^9}, {3.859554462238783*^9, 3.8595545119539566`*^9}, {
   3.859554584195531*^9, 3.859554609389391*^9}, {3.8595546417929797`*^9, 
   3.859554644321248*^9}, {3.8595547473448496`*^9, 3.859554757465744*^9}, {
   3.8595547965785494`*^9, 3.859554908658832*^9}, {3.859554984163625*^9, 
   3.859555055178321*^9}, {3.859977168308877*^9, 3.8599772360124283`*^9}, {
   3.8599774858451896`*^9, 3.8599775182970247`*^9}, {3.859977556168625*^9, 
   3.859977558766972*^9}, {3.8599778958906813`*^9, 3.859977936298822*^9}, {
   3.859977986519406*^9, 3.859978066115001*^9}, {3.859978986338558*^9, 
   3.859979015515856*^9}, {3.8599790865231757`*^9, 3.8599791149053965`*^9}, {
   3.859979210488615*^9, 3.8599792209787817`*^9}, {3.8599803493924475`*^9, 
   3.859980369407977*^9}, 3.859981094869953*^9, {3.859981542769067*^9, 
   3.8599815542265873`*^9}, {3.8599816585624447`*^9, 3.859981737266111*^9}, {
   3.8599819412556067`*^9, 3.85998229214895*^9}, {3.8599824173074923`*^9, 
   3.8599824459186573`*^9}, {3.8599824792581797`*^9, 
   3.8599825127621636`*^9}, {3.8599826363795695`*^9, 3.859982648636608*^9}, {
   3.859984040220494*^9, 3.859984045941535*^9}, {3.861166531658287*^9, 
   3.861166534048344*^9}, {3.8611665847980003`*^9, 3.8611666058699408`*^9}, {
   3.8611670609268503`*^9, 3.861167067769003*^9}, {3.86116718145362*^9, 
   3.861167182451355*^9}, 3.8611672409243827`*^9, 3.8611673161922445`*^9, {
   3.8611674333273335`*^9, 3.861167452192051*^9}, {3.861167501164098*^9, 
   3.8611675022977824`*^9}, {3.861167619735695*^9, 3.8611676197825613`*^9}, {
   3.8614439267260885`*^9, 3.86144395904889*^9}, {3.8614440181464033`*^9, 
   3.861444084651805*^9}, {3.861444124088*^9, 3.8614441289374475`*^9}, {
   3.8614443330709553`*^9, 3.8614443461096983`*^9}, {3.861444471440876*^9, 
   3.8614444714628196`*^9}, {3.8614455922409363`*^9, 
   3.8614456567442904`*^9}, {3.8614457141066823`*^9, 3.861445771061937*^9}, {
   3.8614458461617503`*^9, 3.8614459098362207`*^9}, {3.8614461825111723`*^9, 
   3.8614463315295115`*^9}},ExpressionUUID->"c79fdebc-f9ae-4df7-a656-\
4383f6352b8d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"for", " ", "some", " ", "ics"}], ",", " ", 
    RowBox[{
     RowBox[{"couldn", "'"}], "t", " ", "guarantee", " ", "the", " ", "lower",
      " ", "one", " ", "is", " ", "discardable"}], ",", "\[IndentingNewLine]", 
    RowBox[{
    "but", " ", "should", " ", "be", " ", "provided", " ", "pattern", " ", 
     "is", " ", "a", " ", "dropped", " ", "coin", " ", "one"}]}], " ", "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"diskdiskUpperTouchingPoint", "[", 
      RowBox[{"pairDisks_", ",", "r_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", "lrPoints", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"lrPoints", "=", " ", 
         RowBox[{"diskdisktouchingPoint", "[", 
          RowBox[{"pairDisks", ",", "r"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MissingQ", "[", "lrPoints", "]"}], ",", 
          RowBox[{"Return", "[", "lrPoints", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Last", "[", 
         RowBox[{"SortBy", "[", 
          RowBox[{"lrPoints", ",", 
           RowBox[{
            RowBox[{"N", "@", 
             RowBox[{"Last", "[", "#", "]"}]}], "&"}]}], "]"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"diskdisktouchingPoint", "[", 
      RowBox[{"pairDisks_", ",", "r_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "xy1", ",", "xy2", ",", "r1", ",", "r2", ",", "interdisk", ",", 
         "sTriangle", ",", "triangle", "\[IndentingNewLine]", ",", 
         "rTrianglePT", ",", "lTrianglePT", ",", "transform"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"xy1", ",", "r1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"xy2", ",", "r2"}], "}"}]}], "}"}], "=", " ", 
         RowBox[{"List", "@@@", " ", "pairDisks"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"interdisk", " ", "=", " ", 
         RowBox[{"Norm", "[", 
          RowBox[{"xy1", "-", "xy2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"interdisk", " ", ">", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"r1", "+", "r"}], ")"}], " ", "+", 
            RowBox[{"(", " ", 
             RowBox[{"r2", " ", "+", " ", "r"}], ")"}]}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"Missing", "[", "]"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Off", "[", 
         RowBox[{"SSSTriangle", "::", "tri"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"sTriangle", " ", "=", 
         RowBox[{"SSSTriangle", "[", 
          RowBox[{
           RowBox[{"r", "+", "r2"}], ",", 
           RowBox[{"r", "+", "r1"}], ",", "interdisk"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"On", "[", 
         RowBox[{"SSSTriangle", "::", "tri"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "sTriangle", "]"}], "===", "SSSTriangle"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{"Missing", "[", "]"}], "]"}]}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Abort", "[", "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"triangle", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"List", "@", "sTriangle"}], ")"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"transform", " ", "=", 
         RowBox[{"Composition", "[", 
          RowBox[{
           RowBox[{"TranslationTransform", "[", "xy1", "]"}], ",", 
           RowBox[{"RotationTransform", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"triangle", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "-", 
               RowBox[{"triangle", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"xy2", "-", "xy1"}]}], "}"}], "]"}]}], 
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"rTrianglePT", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"transform", "[", "triangle", "]"}], ")"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"lTrianglePT", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"ReflectionTransform", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"RotationTransform", "[", 
               RowBox[{"90", " ", "Degree"}], "]"}], "[", 
              RowBox[{"xy2", "-", "xy1"}], "]"}], ",", "xy1"}], "]"}], ")"}], 
          "[", "rTrianglePT", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"rTrianglePT", ",", "lTrianglePT"}], "}"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.856890650008703*^9, 3.85689067286756*^9}, {
   3.8568920185899725`*^9, 3.8568920625893984`*^9}, {3.8571152866804256`*^9, 
   3.8571153034394283`*^9}, {3.8571171134824324`*^9, 
   3.8571171413767424`*^9}, {3.8571171853168*^9, 3.8571172283028445`*^9}, 
   3.8571269932151995`*^9, {3.857127151449848*^9, 3.857127168930334*^9}, {
   3.8571273299195204`*^9, 3.8571273327408686`*^9}, {3.8571273879771347`*^9, 
   3.8571274361429415`*^9}, {3.8571274968993864`*^9, 
   3.8571275846370783`*^9}, {3.8571277374939375`*^9, 3.857127777817645*^9}, {
   3.8595520546920843`*^9, 3.8595521077101665`*^9}},
 CellLabel->
  "In[965]:=",ExpressionUUID->"f84550c7-7952-4387-a527-80b00981d42e"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{718.5, 838.5},
WindowMargins->{{Automatic, -5.25}, {Automatic, 0}},
Magnification:>1.1 Inherited,
FrontEndVersion->"13.0 for Microsoft Windows (64-bit) (February 4, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"2cc5cbc0-b64c-4b9f-972e-d2d4fd863fe9"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 336, 10, 70, "Input",ExpressionUUID->"7d77eaad-7cce-48eb-b198-8dc4dd759adc",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[919, 34, 159, 3, 74, "Section",ExpressionUUID->"6ab48122-af17-4dcf-b0ec-7c9b2b450180"],
Cell[1081, 39, 22609, 530, 2445, "Input",ExpressionUUID->"c79fdebc-f9ae-4df7-a656-4383f6352b8d",
 InitializationCell->True],
Cell[23693, 571, 6234, 148, 720, "Input",ExpressionUUID->"f84550c7-7952-4387-a527-80b00981d42e",
 InitializationCell->True]
}, Open  ]]
}
]
*)

