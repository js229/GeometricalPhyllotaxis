(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     10925,        327]
NotebookOptionsPosition[      9456,        291]
NotebookOutlinePosition[     10165,        314]
CellTagsIndexPosition[     10122,        311]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"SetOptions", "[", 
  RowBox[{
   RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
   RowBox[{"AutoGeneratedPackage", "->", "Automatic"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.855708557192008*^9, 3.855708558082427*^9}},
 CellLabel->
  "In[596]:=",ExpressionUUID->"0c63ea52-7fb0-493b-bb7d-4edd448cd6cb"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
  "uses", " ", "the", " ", "_definitions", "_", " ", "in", " ", "the", " ", 
   "book", " ", "Mathematical", " ", 
   RowBox[{"Phyllotaxis", ".", " ", "Not"}], " ", "currently", " ", "the", 
   " ", "code", " ", "used", " ", "for", " ", "Figures", " ", 
   RowBox[{"there", " ", "!"}]}], "*)"}]], "Input",ExpressionUUID->"ce36aca0-\
840f-4319-97cb-06a09362bdd8"],

Cell[CellGroupData[{

Cell["Find winding number pairs", "Section",ExpressionUUID->"baa52565-2a69-4366-a1bc-dc70d7b3420b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"mpEuclideanQCoefficients", "[", 
     RowBox[{"{", 
      RowBox[{"m_", ",", "n_"}], "}"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"r", ",", "q", ",", "i", ",", "j"}], "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"i", "=", "0"}], ";", "\n", "\t", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"-", "1"}], "]"}], "=", "n"}], ";", " ", "\n", "\t", 
       RowBox[{
        RowBox[{"r", "[", "0", "]"}], " ", "=", " ", "m"}], ";", "\n", "\t", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"r", "[", "i", "]"}], " ", ">", " ", "0"}], "  ", ",", " ", 
         "\n", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"q", "[", "i", "]"}], " ", "=", " ", 
           RowBox[{"Floor", "[", 
            RowBox[{
             RowBox[{"r", "[", 
              RowBox[{"i", "-", "1"}], "]"}], "/", 
             RowBox[{"r", "[", "i", "]"}]}], "]"}]}], ";", "\n", "\t\t", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"i", "+", "1"}], "]"}], " ", "=", " ", 
           RowBox[{
            RowBox[{"r", "[", 
             RowBox[{"i", "-", "1"}], "]"}], " ", "-", " ", 
            RowBox[{
             RowBox[{"q", "[", "i", "]"}], "*", 
             RowBox[{"r", "[", "i", "]"}]}]}]}], ";", "\n", "\t\t", 
          RowBox[{"i", "++"}], ";"}]}], "\n", "\t", "]"}], ";", "\n", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"q", "[", "j", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "0", ",", 
           RowBox[{"i", "-", "1"}]}], "}"}]}], "]"}]}]}], "\n", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"mpEuclideanMatrixProduct", "[", "mn_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"q", ",", "res", ",", "eMatrix", ",", "sMatrix"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"eMatrix", " ", "=", " ", 
        RowBox[{"(", GridBox[{
           {"1", "1"},
           {"0", "1"}
          }], ")"}]}], ";", 
       RowBox[{"sMatrix", "=", 
        RowBox[{"(", GridBox[{
           {"0", "1"},
           {"1", "0"}
          }], ")"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"q", " ", "=", " ", 
        RowBox[{"mpEuclideanQCoefficients", "[", "mn", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"res", "=", " ", 
        RowBox[{"(", 
         RowBox[{"Map", "[", "  ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"MatrixPower", "[", 
              RowBox[{"eMatrix", ",", "#"}], "]"}], ".", " ", "sMatrix"}], 
            " ", "&"}], ",", "q"}], "]"}], ")"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"res", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "res", "]"}], ">", "0"}], ",", 
          RowBox[{"Dot", "@@", "res"}], ",", 
          RowBox[{"IdentityMatrix", "[", "2", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "res"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"mpWindingNumberPair", "[", "mn_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"m", ",", "n", ",", "u", ",", "v"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"n", ",", "v"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"m", ",", "u"}], "}"}]}], "}"}], "=", 
        RowBox[{"mpEuclideanMatrixProduct", "[", "mn", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"u", ",", "v"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"mpDelta", "[", "mn_", "]"}], ":=", " ", 
   RowBox[{
    RowBox[{"-", "1"}], " ", "*", " ", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"EvenQ", "[", 
       RowBox[{"Length", "[", 
        RowBox[{"mpEuclideanQCoefficients", "[", "mn", "]"}], "]"}], "]"}], 
      ",", "1", ",", 
      RowBox[{"-", "1"}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->
  True,ExpressionUUID->"f241a7d1-6e46-4348-9a35-11930f0cd914"],

Cell[BoxData[""], "Input",ExpressionUUID->"a84173c9-f0eb-46b4-9db7-ce90769b6f85"]
}, Open  ]],

Cell[CellGroupData[{

Cell["General renormalisation map", "Section",ExpressionUUID->"ef5f5ef8-d0d3-4b09-8ddb-0a53e9a8fc86"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "m", ",", "n", ",", "u", ",", "v", ",", "w", ",", "d0", ",", "h0"}], 
     "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"ComplexExpand", "@", 
    RowBox[{"ReIm", "@", 
     RowBox[{"ComplexExpand", "[", 
      RowBox[{
       RowBox[{"gmn", " ", "=", 
        FractionBox[
         RowBox[{" ", 
          RowBox[{
           RowBox[{"u", " ", "w"}], "-", " ", "v", " "}]}], 
         RowBox[{
          RowBox[{"m", " ", "w"}], " ", "-", " ", "n"}]]}], ";", 
       RowBox[{"gmn", " ", "/.", " ", 
        RowBox[{"w", "->", " ", 
         RowBox[{"(", 
          RowBox[{"d0", "+", " ", 
           RowBox[{"I", " ", "h0"}]}], ")"}]}]}]}], "]"}]}]}]}]}]], "Input",
 CellLabel->
  "In[627]:=",ExpressionUUID->"2a6ce253-755f-4b9c-9fc2-2f40970867f1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    FractionBox[
     RowBox[{
      SuperscriptBox["d0", "2"], " ", "m", " ", "u"}], 
     RowBox[{
      RowBox[{
       SuperscriptBox["h0", "2"], " ", 
       SuperscriptBox["m", "2"]}], "+", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"d0", " ", "m"}], "-", "n"}], ")"}], "2"]}]], "+", 
    FractionBox[
     RowBox[{
      SuperscriptBox["h0", "2"], " ", "m", " ", "u"}], 
     RowBox[{
      RowBox[{
       SuperscriptBox["h0", "2"], " ", 
       SuperscriptBox["m", "2"]}], "+", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"d0", " ", "m"}], "-", "n"}], ")"}], "2"]}]], "-", 
    FractionBox[
     RowBox[{"d0", " ", "n", " ", "u"}], 
     RowBox[{
      RowBox[{
       SuperscriptBox["h0", "2"], " ", 
       SuperscriptBox["m", "2"]}], "+", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"d0", " ", "m"}], "-", "n"}], ")"}], "2"]}]], "-", 
    FractionBox[
     RowBox[{"d0", " ", "m", " ", "v"}], 
     RowBox[{
      RowBox[{
       SuperscriptBox["h0", "2"], " ", 
       SuperscriptBox["m", "2"]}], "+", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"d0", " ", "m"}], "-", "n"}], ")"}], "2"]}]], "+", 
    FractionBox[
     RowBox[{"n", " ", "v"}], 
     RowBox[{
      RowBox[{
       SuperscriptBox["h0", "2"], " ", 
       SuperscriptBox["m", "2"]}], "+", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"d0", " ", "m"}], "-", "n"}], ")"}], "2"]}]]}], ",", 
   RowBox[{
    RowBox[{"-", 
     FractionBox[
      RowBox[{"h0", " ", "n", " ", "u"}], 
      RowBox[{
       RowBox[{
        SuperscriptBox["h0", "2"], " ", 
        SuperscriptBox["m", "2"]}], "+", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{"d0", " ", "m"}], "-", "n"}], ")"}], "2"]}]]}], "+", 
    FractionBox[
     RowBox[{"h0", " ", "m", " ", "v"}], 
     RowBox[{
      RowBox[{
       SuperscriptBox["h0", "2"], " ", 
       SuperscriptBox["m", "2"]}], "+", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"d0", " ", "m"}], "-", "n"}], ")"}], "2"]}]]}]}], 
  "}"}]], "Output",
 CellLabel->
  "Out[628]=",ExpressionUUID->"f84e0052-d541-4584-bdb9-0deab52a8435"]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{718.5, 825},
WindowMargins->{{-725.25, Automatic}, {-5.25, Automatic}},
TaggingRules->{
 "WelcomeScreenSettings" -> {"FEStarting" -> False}, 
  "CodeFormatter" -> {
   "ToolbarState" -> False, "ToolbarAccentColor" -> RGBColor["#2497b7"]}},
Magnification:>0.85,
FrontEndVersion->"13.3 for Microsoft Windows (64-bit) (July 24, 2023)",
StyleDefinitions->FrontEnd`FileName[{"Wolfram"}, "ProgrammingLabDefault.nb", 
  CharacterEncoding -> "UTF-8"],
ExpressionUUID->"f4b5020d-ead1-4307-a5d6-65537a21f51e"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 355, 8, 38, "Input",ExpressionUUID->"0c63ea52-7fb0-493b-bb7d-4edd448cd6cb",
 InitializationCell->True],
Cell[916, 30, 408, 8, 43, "Input",ExpressionUUID->"ce36aca0-840f-4319-97cb-06a09362bdd8"],
Cell[CellGroupData[{
Cell[1349, 42, 99, 0, 57, "Section",ExpressionUUID->"baa52565-2a69-4366-a1bc-dc70d7b3420b"],
Cell[1451, 44, 4529, 125, 523, "Input",ExpressionUUID->"f241a7d1-6e46-4348-9a35-11930f0cd914",
 InitializationCell->True],
Cell[5983, 171, 81, 0, 24, "Input",ExpressionUUID->"a84173c9-f0eb-46b4-9db7-ce90769b6f85"]
}, Open  ]],
Cell[CellGroupData[{
Cell[6101, 176, 101, 0, 57, "Section",ExpressionUUID->"ef5f5ef8-d0d3-4b09-8ddb-0a53e9a8fc86"],
Cell[CellGroupData[{
Cell[6227, 180, 870, 25, 99, "Input",ExpressionUUID->"2a6ce253-755f-4b9c-9fc2-2f40970867f1"],
Cell[7100, 207, 2328, 80, 87, "Output",ExpressionUUID->"f84e0052-d541-4584-bdb9-0deab52a8435"]
}, Open  ]]
}, Open  ]]
}
]
*)

