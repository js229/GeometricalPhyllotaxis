(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     30451,        767]
NotebookOptionsPosition[     29218,        735]
NotebookOutlinePosition[     29721,        754]
CellTagsIndexPosition[     29678,        751]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SetDirectory", "[", 
    RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}], 
  RowBox[{"(*", 
   RowBox[{"Get", "[", 
    RowBox[{"\"\<CoinStackingCode.m\>\"", ",", 
     RowBox[{"Path", "->", 
      RowBox[{"{", 
       RowBox[{"PersistentSymbol", "[", 
        RowBox[{"\"\<persistentGitHubPath\>\"", ",", "\"\<Local\>\""}], "]"}],
        "}"}]}]}], "]"}], "\[IndentingNewLine]", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Get", "[", 
   RowBox[{"\"\<LatticePhyllotaxis.m\>\"", ",", 
    RowBox[{"Path", "->", 
     RowBox[{"{", 
      RowBox[{"PersistentSymbol", "[", 
       RowBox[{"\"\<persistentGitHubPath\>\"", ",", "\"\<Local\>\""}], "]"}], 
      "}"}]}]}], "]"}], ";"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellFrameLabels->{{None, None}, {None, None}},
 CellLabel->"In[1]:=",ExpressionUUID->"9ea6b723-d3fd-40f4-a7e8-a833165f76e7"],

Cell[CellGroupData[{

Cell["temp not working", "Section",ExpressionUUID->"77434704-e7d2-4597-9345-fd0579a490c2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeCappedArena", "[", 
     RowBox[{"run_", ",", "runParameters_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "initialRadius", ",", "finalRadius", ",", "hBase", ",", "hStart", ",", 
        "hEnd", ",", "rOfH", ",", "arenaAssociation"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"initialRadius", "=", " ", 
        RowBox[{"smallestRadius", "[", "run", "]"}]}], " ", ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"hBase", "=", 
        RowBox[{"highestCentre", "[", "run", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"finalRadius", "=", " ", 
        RowBox[{"initialRadius", "/", 
         RowBox[{"runParameters", "[", "\"\<rScale\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"hStart", ",", "hEnd"}], "}"}], " ", "=", " ", 
        RowBox[{"hBase", " ", "+", " ", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"hRangeNeeded", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"initialRadius", ",", "finalRadius"}], "}"}], ",", 
             RowBox[{"runParameters", "[", "\"\<rSlope\>\"", "]"}]}], "]"}]}],
           "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"rOfH", " ", "=", 
        RowBox[{"linearInterpolator", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"hStart", ",", "hEnd"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"initialRadius", ",", 
            RowBox[{"-", 
             RowBox[{"runParameters", "[", "\"\<rSlope\>\"", "]"}]}]}], 
           "}"}]}], "]"}]}], " ", ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"bulgeFunction", " ", "=", " ", 
        RowBox[{"makeBulgeFunction", "[", 
         RowBox[{"finalRadius", ",", 
          RowBox[{"1", "/", "4"}], ",", "hEnd", ",", 
          RowBox[{"hEnd", "+", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"rFunction", " ", "=", " ", 
        RowBox[{"Piecewise", "[", " ", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"rOfH", ",", 
             RowBox[{"h", "<=", " ", "hEnd"}]}], "}"}], "\[IndentingNewLine]",
            ",", 
           RowBox[{"{", 
            RowBox[{"bulgeFunction", ",", "True"}], "}"}]}], 
          "\[IndentingNewLine]", "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"zMax", "=", 
        RowBox[{
         RowBox[{"runParameters", "[", "\"\<zMax\>\"", "]"}], "+", " ", 
         "1"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"arenaAssociation", "=", "runParameters"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"KeyMemberQ", "[", 
          RowBox[{"arenaAssociation", ",", "\"\<Lattice\>\""}], "]"}], ",", 
         RowBox[{"arenaAssociation", "=", 
          RowBox[{"KeyDrop", "[", 
           RowBox[{"arenaAssociation", ",", "\"\<Lattice\>\""}], "]"}]}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"arenaAssociation", " ", "=", " ", 
        RowBox[{"Append", "[", 
         RowBox[{"arenaAssociation", ",", "\[IndentingNewLine]", 
          RowBox[{"<|", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\"\<rFunction\>\"", "->", "rFunction"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"\"\<zMax\>\"", "->", "zMax"}], "\[IndentingNewLine]", 
            ",", 
            RowBox[{"\"\<rFixedBefore\>\"", "->", " ", "hStart"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"\"\<rFixedAfter\>\"", "->", " ", "hEnd"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"\"\<CylinderLU\>\"", "->", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"runParameters", "[", "\"\<zMax\>\"", "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "|>"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "arenaAssociation"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeBulgeFunction", "[", 
    RowBox[{"rMin_", ",", "rMax_", ",", "zMin_", ",", "zMax_"}], "]"}], " ", ":=",
    " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"zRange", ",", "bulgeScale"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bulgeScale", " ", "=", "  ", 
       RowBox[{
        RowBox[{"Cos", "[", 
         RowBox[{"ArcSin", "[", 
          RowBox[{"rMin", "/", "rMax"}], "]"}], "]"}], "/", "zMax"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"zRange", "=", 
       RowBox[{"zMax", "-", "zMin"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<rFunction\>\"", "->", 
         RowBox[{"Function", "[", 
          RowBox[{"z", ",", " ", 
           RowBox[{"Piecewise", "[", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"rMin", ",", 
                RowBox[{"z", "<=", "  ", "zMin"}]}], "}"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", " ", 
               RowBox[{
                FractionBox["rMin", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"ArcCos", "[", 
                   RowBox[{"bulgeScale", "*", 
                    RowBox[{"(", 
                    RowBox[{"z", "-", "zMin"}], ")"}]}], "]"}], "]"}]], ",", 
                RowBox[{"z", "<=", "zMax"}]}], "}"}], "\[IndentingNewLine]", 
              ",", 
              RowBox[{"{", 
               RowBox[{"rMax", ",", "True"}], "}"}]}], "\[IndentingNewLine]", 
             "}"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", ",", 
        RowBox[{"\"\<rMin\>\"", "->", "rMin"}], ",", 
        RowBox[{"\"\<rMax\>\"", "->", "rMax"}], ",", 
        RowBox[{"\"\<zMin\>\"", "->", "zMin"}], ",", 
        RowBox[{"\"\<zMax\>\"", "->", "zMax"}]}], "\[IndentingNewLine]", 
       "|>"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellLabel->"In[27]:=",ExpressionUUID->"f0e7d731-5762-4dec-b7a9-acbba387cd47"]
}, Open  ]],

Cell[CellGroupData[{

Cell["runmaking", "Section",ExpressionUUID->"13415d01-2298-4c71-8d57-6fb48f6fdeb5"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"doParameterRun", "[", "experimentParameter_", "]"}], " ", ":=", 
    " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "run", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"run", " ", "=", " ", 
        RowBox[{"makeRunFromParameter", "[", "experimentParameter", "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"run", "=", " ", 
        RowBox[{"CheckAbort", "[", 
         RowBox[{
          RowBox[{"executeRun", "[", "run", "]"}], ",", 
          RowBox[{"Missing", "[", "\"\<Aborted run\>\"", "]"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"debugLastRun", "=", " ", "run"}], ";", "\[IndentingNewLine]", 
       "run"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeRunFromParameter", "[", "experimentParameter_", "]"}], " ", 
     ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "lattice", ",", "run", ",", "arena", ",", "g", ",", "chainNumber"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"lattice", "=", 
         RowBox[{"experimentParameter", "[", "\"\<Lattice\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MissingQ", "[", "lattice", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"lattice", " ", "=", " ", 
           RowBox[{"latticeOrthogonal", "[", 
            RowBox[{"{", 
             RowBox[{"0", ",", "1"}], "}"}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"run", " ", "=", " ", 
         RowBox[{"runFromLattice", "[", "lattice", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MissingQ", "[", "run", "]"}], ",", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<mRFP Not implemented\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"run", "[", "\"\<Arena\>\"", "]"}], " ", "=", " ", 
         RowBox[{"makeArena", "[", 
          RowBox[{"run", ",", "experimentParameter"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "run"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"runFromRun", "[", "run_", "]"}], " ", ":=", "  ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"g", ",", "d", ",", "chain"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chain", " ", "=", " ", 
         RowBox[{"Last", "[", 
          RowBox[{"run", "[", "\"\<Chains\>\"", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"g", "=", " ", 
         RowBox[{"chain", "[", "\"\<Chain\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"d", " ", "=", " ", 
         RowBox[{"Map", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"<|", 
             RowBox[{"#", "->", 
              RowBox[{
               RowBox[{"run", "[", "\"\<DiskData\>\"", "]"}], "[", "#", 
               "]"}]}], "|>"}], "&"}], ",", 
           RowBox[{"VertexList", "[", "g", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<Arena\>\"", "->", 
           RowBox[{"run", "[", "\"\<Arena\>\"", "]"}]}], ",", 
          RowBox[{"\"\<ContactGraph\>\"", "->", "g"}], ",", 
          RowBox[{"\"\<DiskData\>\"", "->", "d"}]}], "|>"}]}]}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"runFromLattice", "[", "lattice_", "]"}], " ", ":=", "  ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"g", ",", "d"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"lattice", "[", "\"\<d\>\"", "]"}], "==", "0"}], " ", "&&",
              " ", 
             RowBox[{
              RowBox[{"lattice", "[", "\"\<h\>\"", "]"}], " ", "==", " ", 
              "1"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{"graphFromTCLattice", "[", "lattice", "]"}], "]"}]}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"g", "=", " ", 
         RowBox[{"Graph", "[", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"left", "[", "1", "]"}], "\[UndirectedEdge]", "1"}], ",", 
            RowBox[{"1", "\[UndirectedEdge]", 
             RowBox[{"right", "[", "1", "]"}]}]}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"d", " ", "=", " ", 
         RowBox[{"<|", 
          RowBox[{"1", "->", 
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<DiskNumber\>\"", "->", "1"}], ",", 
             RowBox[{"\"\<Disk\>\"", "->", 
              RowBox[{"Disk", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}], ",", "0.5"}], "]"}]}]}], 
            "|>"}]}], "|>"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<ContactGraph\>\"", "->", "g"}], ",", 
          RowBox[{"\"\<DiskData\>\"", "->", "d"}]}], "|>"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"graphFromTCLattice", "[", "lattice_", "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "m", ",", "n", ",", "r", ",", "disks", ",", "diskx", ",", "diskxy", 
         ",", "disknxy", ",", "disksOn", ",", "disksOf", ",", "diskData", ",",
          "g"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"m", ",", "n"}], "}"}], "=", 
         RowBox[{"First", "@", 
          RowBox[{"Keys", "[", 
           RowBox[{"lattice", "[", "\"\<parastichyNumbers\>\"", "]"}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"r", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"N", "@", 
           RowBox[{
            RowBox[{"lattice", "[", "\"\<parastichyNumbers\>\"", "]"}], "[", 
            RowBox[{"{", 
             RowBox[{"m", ",", "n"}], "}"}], "]"}]}], "]"}]}], " ", ";", 
        "\[IndentingNewLine]", 
        RowBox[{"disks", "=", " ", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Disk", "[", 
             RowBox[{"#", ",", 
              RowBox[{"r", "/", "2"}]}], "]"}], "&"}], ",", 
           RowBox[{"lattice", "[", "\"\<namedLatticePoints\>\"", "]"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"diskx", "[", 
          RowBox[{"Disk", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x_", ",", "_"}], "}"}], ",", "_"}], "]"}], "]"}], ":=", 
         "x"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"diskxy", "[", 
          RowBox[{"Disk", "[", 
           RowBox[{"xy_", ",", "_"}], "]"}], "]"}], ":=", "xy"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"disknxy", "[", "node_", "]"}], " ", ":=", " ", 
         RowBox[{"diskxy", "[", 
          RowBox[{"disks", "[", "node", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"disknxy", "[", 
          RowBox[{"left", "[", "node_", "]"}], "]"}], " ", ":=", " ", 
         RowBox[{
          RowBox[{"diskxy", "[", 
           RowBox[{"disks", "[", "node", "]"}], "]"}], "+", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "0"}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"disknxy", "[", 
          RowBox[{"right", "[", "node_", "]"}], "]"}], " ", ":=", " ", 
         RowBox[{
          RowBox[{"diskxy", "[", 
           RowBox[{"disks", "[", "node", "]"}], "]"}], "+", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"disksOn", "=", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"#", "\[DirectedEdge]", 
                RowBox[{"#", "-", "m"}]}], ",", 
               RowBox[{"#", "\[DirectedEdge]", 
                RowBox[{"#", "-", "n"}]}]}], "}"}], "&"}], ",", 
            RowBox[{"Keys", "[", 
             RowBox[{"lattice", "[", "\"\<namedLatticePoints\>\"", "]"}], 
             "]"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"disksOf", "[", 
          RowBox[{"a_", "\[DirectedEdge]", "b_"}], "]"}], " ", ":=", " ", 
         RowBox[{"Module", "[", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"d1", ",", "d2"}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"b", "<", "0"}], ",", 
              RowBox[{"Return", "[", 
               RowBox[{"Nothing", "[", "]"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"d1", "=", 
             RowBox[{"disks", "[", "a", "]"}]}], ";", 
            RowBox[{"d2", "=", 
             RowBox[{"disks", "[", "b", "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Abs", "[", 
                RowBox[{
                 RowBox[{"diskx", "[", "d2", "]"}], "-", 
                 RowBox[{"diskx", "[", "d1", "]"}]}], "]"}], " ", "<", 
               RowBox[{"1", "/", "2"}]}], ",", " ", 
              RowBox[{"Return", "[", 
               RowBox[{"a", "\[UndirectedEdge]", "b"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"diskx", "[", "d1", "]"}], ">", " ", "0"}], ",", 
              RowBox[{"Return", "[", 
               RowBox[{"a", "\[UndirectedEdge]", 
                RowBox[{"right", "[", "b", "]"}]}], "]"}], ",", " ", 
              RowBox[{"Return", "[", 
               RowBox[{"a", "\[UndirectedEdge]", 
                RowBox[{"left", "[", "b", "]"}]}], "]"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"g", "=", 
         RowBox[{"Graph", "[", 
          RowBox[{"Map", "[", 
           RowBox[{"disksOf", ",", "disksOn"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"g", "=", " ", 
         RowBox[{"Graph", "[", 
          RowBox[{"g", ",", 
           RowBox[{"VertexCoordinates", "->", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"disknxy", "[", "#", "]"}], "&"}], ",", 
              RowBox[{"VertexList", "[", "g", "]"}]}], "]"}]}], ",", 
           RowBox[{"VertexLabels", "->", "\"\<Name\>\""}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"diskData", " ", "=", " ", 
         RowBox[{"Association", "@", 
          RowBox[{"KeyValueMap", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#1", "->", 
              RowBox[{"<|", 
               RowBox[{
                RowBox[{"\"\<DiskNumber\>\"", "->", "#1"}], ",", 
                RowBox[{"\"\<Disk\>\"", "->", "#2"}]}], "|>"}]}], "&"}], ",", 
            "disks"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<ContactGraph\>\"", "->", "g"}], ",", 
          RowBox[{"\"\<DiskData\>\"", "->", "diskData"}]}], "|>"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"6579b71c-7c78-466e-8bdd-60f932470f18"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"smallestRadius", "[", "run_", "]"}], " ", ":=", " ", 
   RowBox[{"Min", "@", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"diskR", "[", 
        RowBox[{"getDiskFromRun", "[", 
         RowBox[{"run", ",", "#"}], "]"}], "]"}], "&"}], ",", 
      RowBox[{"Keys", "[", 
       RowBox[{"run", "[", "\"\<DiskData\>\"", "]"}], "]"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"highestCentre", "[", "run_", "]"}], " ", ":=", " ", 
    RowBox[{"Max", "@", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"diskZ", "[", 
         RowBox[{"getDiskFromRun", "[", 
          RowBox[{"run", ",", "#"}], "]"}], "]"}], "&"}], ",", 
       RowBox[{"Keys", "[", 
        RowBox[{"run", "[", "\"\<DiskData\>\"", "]"}], "]"}]}], "]"}]}]}], 
   ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeArena", "[", 
     RowBox[{"run_", ",", "runParameters_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "initialRadius", ",", "finalRadius", ",", "hBase", ",", "hStart", ",", 
        "hEnd", ",", "rOfH", ",", "arenaAssociation"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"initialRadius", "  ", "=", " ", "0.5"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"initialRadius", "=", " ", 
        RowBox[{"smallestRadius", "[", "run", "]"}]}], " ", ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"hBase", " ", "=", "1"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"hBase", "=", 
        RowBox[{"highestCentre", "[", "run", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"finalRadius", "=", " ", 
        RowBox[{"initialRadius", "/", 
         RowBox[{"runParameters", "[", "\"\<rScale\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"hStart", ",", "hEnd"}], "}"}], " ", "=", " ", 
        RowBox[{"hBase", " ", "+", " ", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"hRangeNeeded", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"initialRadius", ",", "finalRadius"}], "}"}], ",", 
             RowBox[{"runParameters", "[", "\"\<rSlope\>\"", "]"}]}], "]"}]}],
           "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"rOfH", " ", "=", 
        RowBox[{"linearInterpolator", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"hStart", ",", "hEnd"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"initialRadius", ",", 
            RowBox[{"-", 
             RowBox[{"runParameters", "[", "\"\<rSlope\>\"", "]"}]}]}], 
           "}"}]}], "]"}]}], " ", ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"arenaAssociation", "=", "runParameters"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"KeyMemberQ", "[", 
          RowBox[{"arenaAssociation", ",", "\"\<Lattice\>\""}], "]"}], ",", 
         RowBox[{"arenaAssociation", "=", 
          RowBox[{"KeyDrop", "[", 
           RowBox[{"arenaAssociation", ",", "\"\<Lattice\>\""}], "]"}]}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"arenaAssociation", " ", "=", " ", 
        RowBox[{"Append", "[", 
         RowBox[{"arenaAssociation", ",", "\[IndentingNewLine]", 
          RowBox[{"<|", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\"\<rFunction\>\"", "->", "rOfH"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"\"\<rFixedBefore\>\"", "->", " ", "hStart"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"\"\<rFixedAfter\>\"", "->", " ", "hEnd"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"\"\<CylinderLU\>\"", "->", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"runParameters", "[", "\"\<zMax\>\"", "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "|>"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "arenaAssociation"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"linearInterpolator", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"hStart_", ",", "hEnd_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"r_", ",", "rSlope_"}], "}"}]}], "]"}], " ", ":=", " ", 
    "\[IndentingNewLine]", 
    RowBox[{"Function", "[", 
     RowBox[{
      RowBox[{"{", "h", "}"}], ",", " ", 
      RowBox[{"r", "+", " ", 
       RowBox[{"Piecewise", "[", " ", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"h", "<", " ", "hStart"}]}], "}"}], "\[IndentingNewLine]",
           ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"h", "-", "hStart"}], ")"}], " ", "*", " ", "rSlope"}], 
            " ", ",", " ", 
            RowBox[{"h", "<", " ", "hEnd"}]}], "}"}], "\[IndentingNewLine]", 
          ",", " ", 
          RowBox[{"{", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"hEnd", "-", "hStart"}], ")"}], " ", "*", " ", 
             "rSlope"}], " ", ",", "True"}], "}"}]}], "\[IndentingNewLine]", 
         "}"}], "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"hRangeNeeded", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"rStart_", ",", "rEnd_"}], "}"}], ",", "rSlope_"}], "]"}], " ",
     ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "hSlopeRange", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"hSlopeRange", " ", "=", " ", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"(", 
           RowBox[{"rEnd", "-", "rStart"}], ")"}]}], "/", "rSlope"}]}], " ", 
       ";", "\[IndentingNewLine]", "hSlopeRange"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellFrameLabels->{{None, None}, {None, None}},
 CellLabel->"In[12]:=",ExpressionUUID->"3fa4f6d0-e10b-4851-ae09-6b0796ee143b"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"makeExperimentParameters", "[", 
      RowBox[{"rScaleRange_", ",", "rSlopeRange_", ",", "zMaxRange_"}], "]"}],
      " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "experimentParameters", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"experimentParameters", " ", "=", " ", 
         RowBox[{"Flatten", "@", 
          RowBox[{"Outer", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"<|", 
              RowBox[{
               RowBox[{"\"\<rScale\>\"", "->", "#1"}], ",", 
               RowBox[{"\"\<rSlope\>\"", "->", "#2"}], ",", 
               RowBox[{"\"\<zMax\>\"", "->", " ", "#3"}], ",", 
               RowBox[{"\"\<diskMax\>\"", "->", "\[Infinity]"}]}], "|>"}], 
             "&"}], ",", "rScaleRange", ",", "rSlopeRange", ",", 
            "zMaxRange"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"experimentParameters", " ", "=", " ", 
         RowBox[{"MapIndexed", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Append", "[", 
             RowBox[{"#1", ",", 
              RowBox[{"\"\<runNumber\>\"", "->", 
               RowBox[{"First", "[", "#2", "]"}]}]}], "]"}], "&"}], ",", 
           "experimentParameters"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "experimentParameters"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"runParameterSets", "[", "experimentParameters_", "]"}], " ", ":=",
     " ", "\[IndentingNewLine]", 
    RowBox[{"Map", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Monitor", "[", 
        RowBox[{
         RowBox[{"Append", "[", 
          RowBox[{"#", ",", 
           RowBox[{"\"\<Results\>\"", "->", 
            RowBox[{"doParameterRun", "[", "#", "]"}]}]}], "]"}], ",", "#"}], 
        "]"}], "&"}], ",", "experimentParameters"}], "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellLabel->"In[17]:=",ExpressionUUID->"8f6dc615-b126-41b4-97c8-697c4117cd6b"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{951, 523.75},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
TaggingRules-><|"TryRealOnly" -> False|>,
Magnification:>1. Inherited,
FrontEndVersion->"13.3 for Microsoft Windows (64-bit) (July 24, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"4c63b4ae-8efa-4b16-b17b-6f9f3ceaf210"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 937, 24, 121, "Input",ExpressionUUID->"9ea6b723-d3fd-40f4-a7e8-a833165f76e7",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1520, 48, 90, 0, 67, "Section",ExpressionUUID->"77434704-e7d2-4597-9345-fd0579a490c2"],
Cell[1613, 50, 6470, 150, 966, "Input",ExpressionUUID->"f0e7d731-5762-4dec-b7a9-acbba387cd47",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[8120, 205, 83, 0, 67, "Section",ExpressionUUID->"13415d01-2298-4c71-8d57-6fb48f6fdeb5"],
Cell[8206, 207, 12353, 303, 1205, "Input",ExpressionUUID->"6579b71c-7c78-466e-8bdd-60f932470f18",
 InitializationCell->True],
Cell[20562, 512, 6510, 168, 787, "Input",ExpressionUUID->"3fa4f6d0-e10b-4851-ae09-6b0796ee143b",
 InitializationCell->True],
Cell[27075, 682, 2127, 50, 254, "Input",ExpressionUUID->"8f6dc615-b126-41b4-97c8-697c4117cd6b",
 InitializationCell->True]
}, Open  ]]
}
]
*)

